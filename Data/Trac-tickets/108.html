<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      #108 (Defining a domain for a cell_method)
     – CF Metadata
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/trac/search" />
        <link rel="prev" href="./107.html" title="ticket #107" />
        <link rel="last" href="./176.html" title="ticket #176" />
        <link rel="help" href="/trac/wiki/TracGuide" />
        <link rel="alternate" href="./108?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" /><link rel="alternate" href="./108?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="./108?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" />
        <link rel="next" href="./109.html" title="ticket #109" />
        <link rel="start" href="/trac/wiki" />
        <link rel="stylesheet" href="/trac/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/trac/chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="./1.html" title="ticket #1" />
        <link rel="shortcut icon" href="/trac/chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="/trac/chrome/common/trac.ico" type="image/x-icon" />
    <style id="trac-noscript" type="text/css">.trac-noscript { display: none !important }</style>
      <link type="application/opensearchdescription+xml" rel="search" href="/trac/search/opensearch" title="Search CF Metadata" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="b8aeac20bf7fd49b63339caa";
      var comments_prefs={"comments_only":"false","comments_order":"oldest"};
    </script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/folding.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/wikitoolbar.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/resizer.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/auto_preview.js"></script>
    <script type="text/javascript">
      jQuery("#trac-noscript").remove();
      jQuery(document).ready(function($) {
        $(".trac-autofocus").focus();
        $(".trac-target-new").attr("target", "_blank");
        setTimeout(function() { $(".trac-scroll").scrollToTop() }, 1);
        $(".trac-disable-on-submit").disableOnSubmit();
      });
    </script>
    <script type="text/javascript" src="/trac/chrome/common/js/threaded_comments.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
      /*<![CDATA[*/
        $("#attachments").toggleClass("collapsed");
        $("#trac-up-attachments").click(function () {
          $("#attachments").removeClass("collapsed");
          return true;
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
        function setRevertHandler() {
          $("button.trac-revert").click(function() {
            var div = $("div", this);
            var field_name = div[0].id.substr(7);
            var field_value = div.text();
            var input = $("#propertyform *[name=field_" + field_name + "]");
            if (input.length > 0) {
              if (input.filter("input[type=radio]").length > 0) {
                input.val([field_value]);
              } else if (input.filter("input[type=checkbox]").length > 0) {
                input.val(field_value == "1" ? [field_value] : []);
              } else {
                input.val(field_value);
              }
            } else { // Special case for CC checkbox
              input = $("#propertyform input[name=cc_update]").val([]);
            }
            input.change();
            $(this).closest("li").remove();
            return false;
          });
        }
        setRevertHandler();
        var comment_focused = false;
        $("#comment").focus(function() { comment_focused = true; })
                     .blur(function() { comment_focused = false; });
        $("#propertyform").autoSubmit({preview: '1'}, function(data, reply) {
          var items = $(reply);
          // Update ticket box
          $("#ticket").replaceWith(items.filter('#ticket'));
          // Update changelog with original order
          $("#changelog").replaceWith(items.filter("#changelog"));
          // Reorder comments
          applyCommentsOrder(
            $('#prefs input[name="trac-comments-order"]:checked').val());
          // Show warning
          var new_changes = $("#changelog .trac-new");
          $("#trac-edit-warning").toggle(new_changes.length != 0);
          if (new_changes.length != 0)
            $("#changelog").parent().show().removeClass("collapsed");
          // Update view time
          $("#propertyform input[name='view_time']").replaceWith(items.filter("input[name='view_time']"));
          // Update preview
          var preview = $("#ticketchange").html(items.filter('#preview').children());
          var show_preview = preview.children().length != 0;
          $("#ticketchange").toggle(show_preview);
          setRevertHandler();
          // Collapse property form if comment editor has focus
          if (show_preview && comment_focused)
            $("#modify").parent().addClass("collapsed");
          // Execute scripts to load stylesheets
          items.filter("script").appendTo("head");
        }, "#ticketchange .trac-loading");
        $("#trac-comment-editor").autoSubmit({preview_comment: '1'}, function(data, reply) {
          var comment = $("#trac-comment-editor").next("div.comment").html(reply);
          comment.toggle(comment.children().length != 0);
        }, "#changelog .trac-loading");
        /*]]>*/
      });
    </script>
  </head>
  <body>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
        <ul>
          <li class="first"><span>&larr; <a class="prev" href="./107.html" title="ticket #107">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="./109.html" title="ticket #109">Next Ticket</a> &rarr;</span></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
        <div id="ticket" class="trac-content ">
  <div class="date">
    <p>Opened <a class="timeline" href="/trac/timeline?from=2013-11-12T05%3A50%3A03-08%3A00&amp;precision=second" title="See timeline at 11/12/13 05:50:03">7 years ago</a></p>
    <p>Last modified <a class="timeline" href="/trac/timeline?from=2016-11-22T07%3A33%3A40-08%3A00&amp;precision=second" title="See timeline at 11/22/16 07:33:40">4 years ago</a></p>
  </div>
  <h2>
    <a href="./108.html" class="trac-id">#108</a>
    <span class="trac-status">
      <a href="/trac/query?status=new">new</a>
    </span>
    <span class="trac-type">
      <a href="/trac/query?status=!closed&amp;type=enhancement">enhancement</a>
    </span>
  </h2>
  <h1 id="trac-ticket-title" class="searchable">
    <span class="summary">Defining a domain for a cell_method</span>
  </h1>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable"><a href="/trac/query?status=!closed&amp;reporter=markh">markh</a></td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">cf-conventions@…</td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/trac/query?status=!closed&amp;priority=medium">medium</a>
        </td>
        <th id="h_milestone" class="missing">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="missing milestone"></a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/trac/query?status=!closed&amp;component=cf-conventions">cf-conventions</a>
        </td>
        <th id="h_version" class="missing">
          Version:
        </th>
        <td headers="h_version">
              <a href="/trac/query?status=!closed&amp;version="></a>
        </td>
    </tr><tr>
        <th id="h_keywords" class="missing">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              antonio.cofino@…
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
      <a href="./108?action=diff&amp;version=12" class="lastmod trac-diff" title="2016-11-22 15:33:40.340123+00:00">
        (last modified by cofino)
      </a>
    </h3>
    <div class="searchable">
      <h2 id="a1.Title">1. Title</h2>
<blockquote>
<p>
Defining the domain of operation as part of a cell_method definition.
</p>
</blockquote>
<h2 id="a2.Moderator">2. Moderator</h2>
<blockquote>
<p>
see comments
</p>
</blockquote>
<h2 id="a3.Requirement">3. Requirement</h2>
<blockquote>
<p>
The information contained within a data variable's coordinate may have value in defining a cell_method for a result data variable calculated from the initial data variable.
</p>
</blockquote>
<h2 id="a4.InitialStatementofTechnicalProposal">4. Initial Statement of Technical Proposal</h2>
<blockquote>
<p>
<a class="ext-link" href="http://cfconventions.org/cf-conventions/v1.6.0/cf-conventions.html#recording-spacing-original-data"><span class="icon">​</span>7.3.2 conventions reference</a>
</p>
</blockquote>
<blockquote>
<p>
<strong>7.3.2. Recording the spacing of the original data and other information</strong>
</p>
</blockquote>
<blockquote>
<p>
To indicate more precisely how the cell method was applied, extra information may be included in parentheses () after the identification of the method. This information includes standardized and non-standardized parts. <del>Currently the only standardized information is</del> <span class="underline">The interval spacing keyword is used</span> to provide the typical interval between the original data values to which the method was applied, in the situation where the present data values are statistically representative of original data values which had a finer spacing. The syntax is (interval: value unit), where value is a numerical value and unit is a string that can be recognized by UNIDATA's Udunits package [UDUNITS].  The unit will usually be dimensionally equivalent to the unit of the corresponding dimension, but this is not required (which allows, for example, the interval for a standard deviation calculated from points evenly spaced in distance along a parallel to be reported in units of length even if the zonal coordinate of the cells is given in degrees). Recording the original interval is particularly important for standard deviations. For example, the standard deviation of daily values could be indicated by cell_methods="time: standard_deviation (interval: 1 day)" and of annual values by cell_methods="time: standard_deviation (interval: 1 year)".
</p>
</blockquote>
<blockquote>
<p>
If the cell method applies to a combination of axes, they may have a common original interval e.g. cell_methods="lat: lon: standard_deviation (interval: 10 km)". Alternatively, they may have separate intervals, which are matched to the names of axes by position e.g. cell_methods="lat: lon: standard_deviation (interval: 0.1 degree_N interval: 0.2 degree_E)", in which 0.1 degree applies to latitude and 0.2 degree to longitude. 
</p>
</blockquote>
<blockquote>
<p>
<span class="underline">To explicitly define the domain over which the statistic was calculated, the syntax (domain: varname [varname]) may be used.  In this case, each 'varname' listed is the name of an ancillary variable, explicitly referenced by the data variable.  Each of the ancillary variables referenced contributes to the definition of the domain over which the cell_method operation was conducted.</span>
</p>
</blockquote>
<h2 id="a5.Benefits">5. Benefits</h2>
<blockquote>
<p>
The community will benefit by having enhanced capabilities for defining cell_methods for data variables calculated across complex domains.
</p>
</blockquote>
<blockquote>
<p>
<a class="wiki" href="/trac/wiki/aggregateExampleMH">aggregateExampleMH</a> presents a use case for this capability.
</p>
</blockquote>
<h2 id="a6.StatusQuo">6. Status Quo</h2>
<blockquote>
<p>
The capability to define complex domains for cell_methods will not be standardised.
</p>
</blockquote>

    </div>
  </div>
</div>
          

        <div>
          <div class="trac-noscript" style="position: relative">
            <form id="prefs" method="get" action="/trac/prefs" style="position: absolute; right: 0">
              <div id="trac-comments-order">
                <input type="radio" id="trac-comments-oldest" name="trac-comments-order" value="oldest" checked="checked" />
                <label for="trac-comments-oldest">Oldest first</label>
                <input type="radio" id="trac-comments-newest" name="trac-comments-order" value="newest" />
                <label for="trac-comments-newest">Newest first</label>
                <span id="trac-threaded-toggle" style="display: none">
                  <input type="radio" id="trac-comments-threaded" name="trac-comments-order" value="threaded" />
                  <label for="trac-comments-threaded">Threaded</label>
                </span>
              </div>
              <div>
                <input id="trac-comments-only-toggle" type="checkbox" />
                <label for="trac-comments-only-toggle">Comments only</label>
              </div>
            </form>
          </div>
          <h3 class="foldable">Change History <span class="trac-count">(12)</span></h3>
          <div id="changelog">
              <div class="change" id="trac-change-1-1384536565000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:1" class="cnum">
    <a href="#comment:1">comment:1</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:2" class="follow-up">↓ 2</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-11-15T09%3A29%3A25-08%3A00&amp;precision=second" title="See timeline at 11/15/13 09:29:25">7 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Mark
</p>
<p>
I feel this wording is not clear in its intention. For the usual case of a numerical coordinate, the domain over which the statistic is calculated is indicated by the cell bounds. Your intention is to provide the original coordinates, isn't it. That's a more detailed sort of information than the typical spacing.
</p>
<p>
I continue to think that a more economical and therefore better approach would be to give the dimension name for the uncollapsed coordinate variable(s), rather than naming the variables themselves. They must all have that dimension if they are in the file, so I think this is robust for the CF convention, which is formulated for single netCDF files. I agree that programs that process files have to be careful about this kind of thing, but there are many other parts of the convention which are similarly fragile. I know you've commented on this already on the email list, but I didn't quite follow your argument there, sorry to say.
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2-1384959677000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:2" class="cnum">
    <a href="#comment:2">comment:2</a>
  </span>
        in reply to:
    <a href="#comment:1">↑ 1</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-11-20T07%3A01%3A17-08%3A00&amp;precision=second" title="See timeline at 11/20/13 07:01:17">7 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./108#comment:1" title="Comment 1">jonathan</a>:
 
</p>
<blockquote class="citation">
<p>
I feel this wording is not clear in its intention. For the usual case of a numerical coordinate, the domain over which the statistic is calculated is indicated by the cell bounds. Your intention is to provide the original coordinates, isn't it. That's a more detailed sort of information than the typical spacing.
</p>
</blockquote>
<p>
Absolutely, the aim of the ticket is is enable the data creator to provide this level of detail in a specified manner where they deem it useful, such as in my use case. Perhaps: 
</p>
<p>
<span class="underline"><strong>For complex domains, cell bounds and interval definitions may be unable to properly define the domain the method was applied over.</strong>  
To explicitly define the domain over which the statistic was calculated, the syntax (domain: varname varname) may be used. Each 'varname' is the name of an ancillary variable, referenced by the data variable. Each of the ancillary variables referenced contributes to the definition of the domain over which the cell_method operation was conducted.</span>
 
</p>
<blockquote class="citation">
<p>
I continue to think that a more economical and therefore better approach would be to give the dimension name for the uncollapsed coordinate variable(s), rather than naming the variables themselves. They must all have that dimension if they are in the file, so I think this is robust for the CF convention, which is formulated for single netCDF files. I agree that programs that process files have to be careful about this kind of thing, but there are many other parts of the convention which are similarly fragile. I know you've commented on this already on the email list, but I didn't quite follow your argument there, sorry to say.
</p>
</blockquote>
<p>
The concern I have expressed with using the dimension name for the domain specification is that the named dimension is not used by the data variable, so any connection is fragile: that dimension is not in scope for the data variable.
</p>
<p>
I wonder if there are potential problems with data integrity wrapped up with this kind of referencing.  It is different from the current <em>name:dimension</em> cell_method reference, as currently I can just check that <em>dimension</em> is a data variable dimension and I know I have the relevant information in scope.
</p>
<p>
I can see that referencing the dimension name is a suitable way of delivering to the use case I have presented, and I do not pretend that referencing ancillary variables avoids all referencing problems.  I think it is a plausible solution.
</p>
<p>
I prefer the slightly longer notation, where each ancillary variable is named within the domain string, and each named ancillary variable must be in scope for the data variable, I think this lends itself better to compliance checking and provides information more clearly to the data consumer.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3-1386085432000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:3" class="cnum">
    <a href="#comment:3">comment:3</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:4" class="follow-up">↓ 4</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-12-03T07%3A43%3A52-08%3A00&amp;precision=second" title="See timeline at 12/03/13 07:43:52">7 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Mark
</p>
<p>
I'd like to put forward a different argument in support of your preference, namely that if we relied on the dimension name alone it would have to be assumed that all variables with that dimension were auxiliaries of the field before collapse. That is not necessary so; some such variables might be irrelevant. Looking at the issue that way, it now seems to me is that what we need to record is the coordinates and auxiliary coordinates of the field before collapse. This information is more complete than you can record with <tt>interval</tt>.
</p>
<p>
Here's a proposal for the new para along these lines:
</p>
<blockquote>
<p>
The original domain of the variable before the statistical operation was applied can be described completely using "<tt>dimension:</tt> <em>dimname</em> [<em>dimname</em> ...]" and <tt>coordinates:</tt> <em>varname</em> [<em>varname</em> ...]". The <em>dimname</em>s are the names of the netCDF dimensions for the affected axes in the original domain. This syntax implies that any 1D variable whose name is <em>dimname</em> is a coordinate variable of the original domain. The <em>varname</em>s are the names of auxiliary coordinate variables for the affected axes in the original domain. Before the statistical operation was carried out, these variables would have been named by the <tt>coordinates</tt> attribute of the original data variable.
</p>
</blockquote>
<p>
In addition, I think we would need to amend the opening para of 7.3.2
</p>
<blockquote>
<p>
To indicate more precisely how the cell method was applied, extra information may optionally be included in parentheses () after the identification of the method. This information includes standardized and non-standardized parts. The possible standardized parts begin with <tt>interval:</tt>, <tt>dimensions:</tt> and <tt>coordinates:</tt>.
</p>
</blockquote>
<blockquote>
<p>
To provide the typical interval between the original data values to which the method was applied, in the situation where the present data values are statistically representative of original data values which had a finer spacing, the syntax is ...
</p>
</blockquote>
<p>
and perhaps we might rename the section to a more general title.
</p>
<p>
New requirements in the conformance document for sect 7.3.2:
</p>
<ul><li>The names listed after <tt>dimensions:</tt> must all be names of netCDF dimensions, which must not be dimensions of the data variable.
</li></ul><ul><li>Any 1D variable whose name equals the name of one of the original dimensions is regarded as a coordinate variable of the original domain and therefore must be strictly monotonic (increasing or decreasing) and must not have the <tt>_FillValue</tt> or <tt>missing_value</tt> attributes.
</li></ul><ul><li>If there is a <tt>coordinates:</tt> list for a <tt>cell_methods</tt> entry there must also be a <tt>dimensions:</tt> list for the same entry.
</li></ul><ul><li>The names listed after <tt>coordinates:</tt> must all be names of netCDF variables. These variables are regarded as auxiliary coordinate variables of the original domain. They must not have as dimensions any of the dimensions to which the <tt>cell_methods</tt> entry applies. Their dimensions must be a subset of the other dimensions of the data variable and the original dimensions named by this <tt>cell_methods</tt> entry. In addition, any label variable will have a trailing dimension for the maximum string length.
</li></ul><p>
What do you think?
</p>
<p>
Cheers
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4-1386850977000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:4" class="cnum">
    <a href="#comment:4">comment:4</a>
  </span>
        in reply to:
    <a href="#comment:3">↑ 3</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-12-12T04%3A22%3A57-08%3A00&amp;precision=second" title="See timeline at 12/12/13 04:22:57">7 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./108#comment:3" title="Comment 3">jonathan</a>:
</p>
<blockquote class="citation">
<p>
Dear Mark
</p>
<p>
I'd like to put forward a different argument in support of your preference, namely that if we relied on the dimension name alone it would have to be assumed that all variables with that dimension were auxiliaries of the field before collapse. That is not necessary so; some such variables might be irrelevant. 
</p>
</blockquote>
<p>
I agree, this risks problems.
</p>
<blockquote class="citation">
<p>
Looking at the issue that way, it now seems to me is that what we need to record is the coordinates and auxiliary coordinates of the field before collapse. This information is more complete than you can record with <tt>interval</tt>.
</p>
</blockquote>
<blockquote class="citation">
<p>
Here's a proposal for the new para along these lines:
</p>
<blockquote>
<p>
The original domain of the variable before the statistical operation was applied can be described completely using "<tt>dimension:</tt> <em>dimname</em> [<em>dimname</em> ...]" and <tt>coordinates:</tt> <em>varname</em> [<em>varname</em> ...]". The <em>dimname</em>s are the names of the netCDF dimensions for the affected axes in the original domain. This syntax implies that any 1D variable whose name is <em>dimname</em> is a coordinate variable of the original domain. The <em>varname</em>s are the names of auxiliary coordinate variables for the affected axes in the original domain. Before the statistical operation was carried out, these variables would have been named by the <tt>coordinates</tt> attribute of the original data variable.
</p>
</blockquote>
</blockquote>
<p>
This seems significantly more complex than the use of ancillary variables I have proposed.  I do not yet see where it adds particular extra value.
</p>
<p>
Using ancillary variables makes it a conscious choice which ex-coordinate variables and gives access to the dimensions, vis the ancillary variable.
</p>
<p>
I think that I find the ancillary approach neater than the dimname and varname you have suggested as an alternative.
</p>
<p>
I would be wary of adopting this alternative as it does not seem to me to add value, but it does add complexity.
</p>
<p>
Are there factors I am missing?
</p>
<p>
Would <a class="wiki" href="/trac/wiki/aggregateExampleMH">my example</a> benefit from the description of dimname and varname instead?
</p>
<p>
mark
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5-1406892210882105">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:5" class="cnum">
    <a href="#comment:5">comment:5</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-08-01T04%3A23%3A30-07%3A00&amp;precision=second" title="See timeline at 08/01/14 04:23:30">7 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-description">
      <strong class="trac-field-description">Description</strong>
        modified (<a href="./108?action=diff&amp;version=5">diff</a>)
    </li>
  </ul>

              </div>
              <div class="change" id="trac-change-6-1406892257879550">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:6" class="cnum">
    <a href="#comment:6">comment:6</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-08-01T04%3A24%3A17-07%3A00&amp;precision=second" title="See timeline at 08/01/14 04:24:17">7 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
This ticket is still open and awaiting further discussion. 
</p>
<p>
Please could interested parties reconsider this ticket in its current state and feed back thoughts.
</p>
<p>
The ticket description has been updated to reflect my latest position on this proposal
</p>
<p>
thank you
mark
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7-1407268094062666">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:7" class="cnum">
    <a href="#comment:7">comment:7</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-08-05T12%3A48%3A14-07%3A00&amp;precision=second" title="See timeline at 08/05/14 12:48:14">7 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Mark
</p>
<p>
My suggestion is not much more complex than yours. I would say that the main difference in our proposals is that I have written down more completely what would need to be changed, including in the conformance document, and that might make it appear more complicated. You propose to add <tt>domain:</tt><em>varname</em> [<em>varname</em> ...] to the <tt>cell_methods</tt> comment. I propose to add <tt>dimension:</tt><em>dimname</em> [<em>dimname</em> ...] and/or <tt>coordinates:</tt> <em>varname</em> [<em>varname</em> ...]. The difference between our proposals is that mine distinguishes between variables which were originally 1D (Unidata) coordinate variables of the original domain and variables which were originally auxiliary coordinate variables, whereas yours does not distinguish between these. It is not clear to me from your wording <em>Each of the ancillary variables referenced contributes to the definition of the domain over which the cell_method operation was conducted</em> whether these variables are coordinate or auxiliary coordinate variables of the original domain. You refer to them as <em>ancillary</em> variables, but I think that's not the right term, because they are not ancillary variables in the usual CF sense i.e. named by an <tt>ancillary_variables</tt> attribute, and containing per-gridbox metadata.
</p>
<p>
If you wish to record only 1D coordinate variables of the original domain, in my proposal you would do that by naming their dimensions. Their dimensions must exist in the file, and it is an obvious convention that the coordinate variables should have the same name as their dimensions, because that's the usual Unidata rule. Thus naming the dimensions is no less convenient than naming 1D coordinate variables - it's the same thing. If you wish to record only auxiliary coordinate variables, in my proposal you would name the these variables and their dimensions separately. I think it's more convenient to be told the names of the dimensions than to inspect the variables to find out what the dimensions are. Finally, I would argue that my proposal maps in an obvious way to the original definition of the domain e.g. a high-resolution grid-point data variable:
</p>
<pre class="wiki">  dimensions:
    oldx=720;
    oldx=960;
  variables:
    float oldx(oldx);
    float oldy(oldy);
    float temperature(oldy,oldx);
      temperature:cell_methods="oldx: oldy: point";
</pre><p>
is meaned into gridboxes 10x10 times larger, recording the original domain information:
</p>
<pre class="wiki">  dimensions:
    oldx=720;
    newx=72;
    oldx=960;
    newx=96;
  variables:
    float oldx(oldx);
    float newx(newx);
    float oldy(oldy);
    float newy(oldy);
    float temperature(newy,newx);
      temperature:cell_methods="newx: newy: mean (dimension: oldx oldy)";
</pre><p>
In your example, there are no 1D coordinate variables, but there are 1D auxiliary coordinate variables. In your proposal, you would encode <tt>domain: experiment_id source realization institution</tt>. The original dimension <tt>ensemble=21</tt> is renamed to <tt>member=21</tt> and you have a new dimension <tt>ensemble=1</tt>. In my proposal, you would encode <tt>dimension: member coordinates: experiment_id source realization institution</tt>.
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8-1407456661828593">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:8" class="cnum">
    <a href="#comment:8">comment:8</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:9" class="follow-up">↓ 9</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-08-07T17%3A11%3A01-07%3A00&amp;precision=second" title="See timeline at 08/07/14 17:11:01">7 years ago</a> by taylor13
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Jonathan and Mark,
</p>
<p>
I’m worried that this proposal will overburden cell_methods, making it too complicated for the casual user to understand.  Moreover, I’m not sure it is wise to start including in this way  information on the various datasets that might have been used in deriving the actual variable of interest.  Until now most of the metadata has been about characteristics of the data itself (what it represents), not how it was derived.  For example, we might note with cell_methods that some variable represents mean values, but we haven’t said much about how the means are computed (e.g., the details of weighting).  At least one exception to this general rule has been made already: in the cell_methods attribute, we can specify the “interval", which doesn’t directly describe the field stored in the file, but rather the field from which it was derived.  The question is do we want to extend cell_methods to describe further characteristics of the source datasets from which the stored variable was calculated?
</p>
<p>
If so, we should also ask what use will be made of this information.  Clearly, there is value in providing information on data has been derived, and humans reading netCDF metadata will benefit.  Will the information be made use of my computer codes too (other than perhaps reading the information and recording it or reformatting it and displaying it)?  
</p>
<p>
In this ticket we have been discussing an incremental addition to our capability to provide a more complete description of how data in our files are derived.  A specific way of doing that has been proposed, but I would prefer an approach that would be more general and allow for additional details concerning *how* the data appearing in a file were derived.   
</p>
<p>
I think the approach should be able to allow us to describe the following procedures used to produce commonly derived data products:
</p>
<p>
mean over a dimension not representing a numerical coordinate (e.g., multi-model mean -- this is what started this ticket)
difference fields (e.g., anomalies — we want to know anomalies relative to what?)
sums of fields (e.g., sum of sensible and latent heat)
divergences (e.g., what finite difference formula was used?)
filtering (e.g., band-pass filters)
transformations (e.g., indicating characteristics of the source data used to derived fourier coefficients)
change of units (.e.g., in calculating geopotential height, indicating the value assumed for gravity (g))
record the definitions (now only recorded in appendix D) used to translate from non-dimensional vertical coordinates to 
</p>
<blockquote>
<p>
dimensional coordinate values.
</p>
</blockquote>
<p>
.
.
</p>
<p>
I suggest for all of these we might define a new CF variable attribute: “formula” (or “method” or “procedure” or ???)
</p>
<p>
The information in “formula” would indicate how the variable had been calculated.  How prescriptive we are in specifying the structure and syntax for the formula would depend on how we think the information will be used. Do machines need to interpret it to do something useful, or do we expect that only humans will take an interest in it? 
</p>
<p>
We could record the formula with pseudo computer code, or in a specific computer language, or using the <a class="missing wiki">LaTex?</a> notation, or in a less prescriptive way left more-or-less up to the data writer.   No matter what we agree to as far as structure and syntax, I think it would be essential to allow references to variables actually included in the netCDF file.  Some of these variables might be “dummy” variables (i.e., variables defined in the file but not containing any data).
</p>
<p>
For example, if our variable is the sum of sensible and latent heat, we could record:
</p>
<p>
dimensions:
</p>
<blockquote>
<p>
lon=144 
lat=73 
</p>
</blockquote>
<p>
variables:
</p>
<blockquote>
<p>
float shpluslh(lat,lon)
</p>
<blockquote>
<p>
shpluslh:units=“W m-2”
shpluslh:formula=“shpluslh = sh + ln”
</p>
</blockquote>
<p>
character sh
</p>
<blockquote>
<p>
sh:standard_name=“surface_upward_sensible_heat_flux”
sh:type=“float”
</p>
</blockquote>
<p>
character lh
</p>
<blockquote>
<p>
lh:standard_name=“surface_upward_latent_heat_flux”
lh:type=“float”
</p>
</blockquote>
</blockquote>
<p>
Note that sh and lh are “dummy” variables because no data are stored in them, but we can make use of all of the cf attributes to describe them.  We can infer that they are “dummy” variables because of the presence of the “type” attribute, which we newly define here.  The “type” attribute would be required for any dummy variable and the actual variable type of all dummy variables is “character” (of length 1, perhaps set to ""). 
</p>
<p>
If we want to indicate the dimensions of a dummy variable, then we could introduce a “dimensions” attribute (again new to CF), which would list the dimensions.   For example, in the above we might include:
</p>
<blockquote>
<p>
sh dimensions=“lon, lat”
</p>
</blockquote>
<p>
As another example, consider how one would record the information in the example introduced by Mark at the beginning of this ticket.
</p>
<p>
dimensions:
</p>
<blockquote>
<p>
longitude = 144 ;
latitude = 73 ;
time = UNLIMITED ; <em> (120 currently)
time_bnd = 2 ;
m = 21 ;
string4 = 4 ;
string15 = 15 ;
string60 = 60 ;
</em></p>
</blockquote>
<p>
variables:
...
</p>
<blockquote>
<p>
int realization(m) ;
</p>
<blockquote>
<p>
realization:standard_name = "realization" ;
realization:long_name = "Number of the simulation in the ensemble" ;
</p>
</blockquote>
<p>
char experiment_id(m, string4) ;
</p>
<blockquote>
<p>
experiment_id:long_name = "Experiment identifier" ;
</p>
</blockquote>
<p>
char source(m, string60) ;
</p>
<blockquote>
<p>
source:long_name = "Method of production of the data" ;
</p>
</blockquote>
<p>
char institution(m, string15) ;
</p>
<blockquote>
<p>
institution:long_name = "Institution responsible for the forecast system" ;
</p>
</blockquote>
</blockquote>
<p>
...
</p>
<blockquote>
<p>
float hus_sd(time, latitude, longitude) ;
</p>
<blockquote>
<p>
hus_sd:units = "1" ;
hus_sd:standard_name = "specific_humidity" ;
hus_sd:cell_methods = "leadtime: mean (interval 6 h)" ;
hus_sd:formula = “hus_sd=mean_over_m(hus)”
</p>
</blockquote>
</blockquote>
<blockquote>
<p>
character hus
</p>
<blockquote>
<p>
hus:type = “float”
hus:dimensions = “m, time, latitude, longitude” ; 
hus:standard_name = "specific_humidity" ;
hus:coordinates = "experiment_id source realization institution" ;
</p>
</blockquote>
</blockquote>
<p>
As a third example, consider Example 4.3 of the current conventions.  We could make explicit the definition of the coordinate by adding the “formula” attribute:
</p>
<p>
float lev(lev) ;
</p>
<blockquote>
<p>
lev:long_name = "sigma at layer midpoints" ;
lev:positive = "down" ;
lev:standard_name = "atmosphere_sigma_coordinate" ;
lev:formula_terms = "sigma: lev ps: PS ptop: PTOP" ;
lev: formula = “[p(n,k,j,i)] = PTOP + lev[k] * (PS[n,j,i] - PTOP)”
</p>
</blockquote>
<p>
Note that to indicate which variables are not actually defined in the file, we use square brackets.  So it is clear that p(n,k,j,i), as well as the indices (i,j,k,n) cannot be found in this file.   We leave the formula_terms attribute in for backward compatibility.  
</p>
<p>
As a final example suppose we store the time-mean planetary albedo
</p>
<p>
dimensions:
</p>
<blockquote>
<p>
lon = 144 ;
lat = 73 ;
time = 1 ;
nv = 2
</p>
</blockquote>
<p>
variables:
</p>
<blockquote>
<p>
float albedo(lat, lon)
</p>
<blockquote>
<p>
albedo:standard_name = “planetary_albedo”
albedo:units = “1”
albedo:formula = “albedo(lat,lon) = rsut(time,lat,lon)/rsdt(time,lat,lon)” 
</p>
</blockquote>
</blockquote>
<blockquote>
<p>
character rsut
</p>
<blockquote>
<p>
rsut:dimensions=“time,lat,lon”
rsut: type=float
rsut: standard_name=“toa_outgoing_shortwave_flux”
rsut: cell_methods=“time: mean”
</p>
</blockquote>
</blockquote>
<blockquote>
<p>
character rsdt
</p>
<blockquote>
<p>
rsdt:dimensions=“time,lat,lon”
rsdt: type=float
rudt: standard_name=“toa_incoming_shortwave_flux”
rudt: cell_methods=“time: mean”
</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>
double time(time)
</p>
<blockquote>
<p>
time: standard_name=“time”
time: units = “days since 1999-01-01”
time: bounds = “time_bnds”
</p>
</blockquote>
<p>
double time_bnds(time,nv)
</p>
</blockquote>
</blockquote>
<p>
            
</p>
<p>
Note: It would have been incorrect to simply include cell_methods as an attribute of albedo, since we are not reporting the time-mean of albedo itself, but the ratio of the time-means of the two fluxes.
</p>
<p>
As a reminder, I am not yet proposing a specific structure/syntax for the “formulas”.  Perhaps we could initially leave that unspecified and see what users of the conventions come up with.  I am proposing to add the “formula”, “type” and “dimensions” attributes and have introduced the idea of “dummy” variables containing no actual data but enabling more precise definitions of how data in the file were derived.  The "type" and "dimensions" attributes would be permitted to be used only with "dummy" variables.
</p>
<p>
Hope someone is interested enough to improve on the above.
</p>
<p>
Best regards,
Karl
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9-1407938225033511">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:9" class="cnum">
    <a href="#comment:9">comment:9</a>
  </span>
        in reply to:
    <a href="#comment:8">↑ 8</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-08-13T06%3A57%3A05-07%3A00&amp;precision=second" title="See timeline at 08/13/14 06:57:05">7 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./108#comment:8" title="Comment 8">taylor13</a>:
</p>
<p>
Hell Karl,
</p>
<p>
I would suggest that the presence of a "dimensions" attribute could be enough to signify a dummy variable. The dummy variable may then be given a netCDF type in usual manner. I.e. your
</p>
<pre class="wiki"> character rsut
    rsut: dimensions="time lat lon";
    rsut: type="float";
    rsut: standard_name="toa_outgoing_shortwave_flux";
    rsut: cell_methods="time: mean";
</pre><p>
would become
</p>
<pre class="wiki"> float rsut
    rsut: dimensions="time lat lon";
    rsut: standard_name="toa_outgoing_shortwave_flux";
    rsut: cell_methods="time: mean";
</pre><p>
Scalar variables would be dealt with by assigning an empty string to the "dimensions" attribute:
</p>
<pre class="wiki"> double scalar_var
    scalar_var: dimensions="";
    scalar_var: standard_name="something_or_other";
    scalar_var: cell_methods="time: mean";
</pre><p>
This is essentially the approach that I have used in the <a class="ext-link" href="http://www.met.reading.ac.uk/~david/cfa/0.4/index.html"><span class="icon">​</span>"CFA-netCDF" conventions</a>, which describes the single file netCDF storage of datasets aggregated across multiple files - in many ways a fully generalised version NcML storage - and uses dummy netCDF variables.
</p>
<p>
Hope that helps,
</p>
<p>
All the best,
</p>
<p>
David
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10-1407948593528314">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:10" class="cnum">
    <a href="#comment:10">comment:10</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-08-13T09%3A49%3A53-07%3A00&amp;precision=second" title="See timeline at 08/13/14 09:49:53">7 years ago</a> by taylor13
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
o David, 
</p>
<blockquote>
<p>
[the "o" is to complete your email's truncated greeting ... together we can probably get it right]
</p>
</blockquote>
<p>
Your modification to my suggestion is simpler and clearer and thus better.  We need to check is whether you can declare a character variable without any dimensions (i.e., does netCDF assume the string length is 1?  If not, then the declaration of a dummy variable that is type scalar would have to be written:
</p>
<blockquote>
<p>
dimensions:
</p>
</blockquote>
<blockquote>
<blockquote>
<p>
string1=1  ;
</p>
</blockquote>
</blockquote>
<blockquote>
<p>
variables:
</p>
</blockquote>
<blockquote>
<blockquote>
<p>
character cdata(string1)
</p>
<blockquote>
<p>
cdata: dimensions "time"
</p>
</blockquote>
</blockquote>
</blockquote>
<p>
 
I don't really think we would ever want to store a dummy variable of type character, but we should check what the syntax would be in that case.  [By the way we certainly would have to have addressed this problem under my original proposal.]
</p>
<p>
best regards,
Karl
      
         
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11-1479827933602143">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:11" class="cnum">
    <a href="#comment:11">comment:11</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2016-11-22T07%3A18%3A53-08%3A00&amp;precision=second" title="See timeline at 11/22/16 07:18:53">4 years ago</a> by cofino
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-cc">
      <strong class="trac-field-cc">Cc</strong>
        <em>antonio.cofino@…</em> added
    </li><li class="trac-field-description">
      <strong class="trac-field-description">Description</strong>
        modified (<a href="./108?action=diff&amp;version=11">diff</a>)
    </li>
  </ul>

              </div>
              <div class="change" id="trac-change-12-1479828820340123">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:12" class="cnum">
    <a href="#comment:12">comment:12</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2016-11-22T07%3A33%3A40-08%3A00&amp;precision=second" title="See timeline at 11/22/16 07:33:40">4 years ago</a> by cofino
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-description">
      <strong class="trac-field-description">Description</strong>
        modified (<a href="./108?action=diff&amp;version=12">diff</a>)
    </li>
  </ul>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/trac/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="./108?format=rss" class="rss">RSS Feed</a>
        </li><li>
          <a rel="nofollow" href="./108?format=csv" class="csv">Comma-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="./108?format=tab" class="tab">Tab-delimited Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="https://trac.edgewall.org/"><img src="/trac/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/trac/about"><strong>Trac 1.0.20</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the CF Metadata home page at<br /><a href="http://cf-convention.github.io">http://cf-convention.github.io</a><br><font color="#0000ff" size="3"><b>The CF Metadata Trac issue tracker is read-only and will soon be shut down permanently</b></font></p>
    </div>
  </body>
</html>
