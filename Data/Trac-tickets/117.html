<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      #117 (add example to 5.7 for multi-time dimension data)
     – CF Metadata
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/trac/search" />
        <link rel="prev" href="./116.html" title="ticket #116" />
        <link rel="last" href="./176.html" title="ticket #176" />
        <link rel="help" href="/trac/wiki/TracGuide" />
        <link rel="alternate" href="./117?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" /><link rel="alternate" href="./117?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="./117?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" />
        <link rel="next" href="./118.html" title="ticket #118" />
        <link rel="start" href="/trac/wiki" />
        <link rel="stylesheet" href="/trac/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/trac/chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="./1.html" title="ticket #1" />
        <link rel="shortcut icon" href="/trac/chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="/trac/chrome/common/trac.ico" type="image/x-icon" />
    <style id="trac-noscript" type="text/css">.trac-noscript { display: none !important }</style>
      <link type="application/opensearchdescription+xml" rel="search" href="/trac/search/opensearch" title="Search CF Metadata" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="b8aeac20bf7fd49b63339caa";
      var comments_prefs={"comments_only":"false","comments_order":"oldest"};
    </script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/folding.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/wikitoolbar.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/resizer.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/auto_preview.js"></script>
    <script type="text/javascript">
      jQuery("#trac-noscript").remove();
      jQuery(document).ready(function($) {
        $(".trac-autofocus").focus();
        $(".trac-target-new").attr("target", "_blank");
        setTimeout(function() { $(".trac-scroll").scrollToTop() }, 1);
        $(".trac-disable-on-submit").disableOnSubmit();
      });
    </script>
    <script type="text/javascript" src="/trac/chrome/common/js/threaded_comments.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
      /*<![CDATA[*/
        $("#attachments").toggleClass("collapsed");
        $("#trac-up-attachments").click(function () {
          $("#attachments").removeClass("collapsed");
          return true;
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
        function setRevertHandler() {
          $("button.trac-revert").click(function() {
            var div = $("div", this);
            var field_name = div[0].id.substr(7);
            var field_value = div.text();
            var input = $("#propertyform *[name=field_" + field_name + "]");
            if (input.length > 0) {
              if (input.filter("input[type=radio]").length > 0) {
                input.val([field_value]);
              } else if (input.filter("input[type=checkbox]").length > 0) {
                input.val(field_value == "1" ? [field_value] : []);
              } else {
                input.val(field_value);
              }
            } else { // Special case for CC checkbox
              input = $("#propertyform input[name=cc_update]").val([]);
            }
            input.change();
            $(this).closest("li").remove();
            return false;
          });
        }
        setRevertHandler();
        var comment_focused = false;
        $("#comment").focus(function() { comment_focused = true; })
                     .blur(function() { comment_focused = false; });
        $("#propertyform").autoSubmit({preview: '1'}, function(data, reply) {
          var items = $(reply);
          // Update ticket box
          $("#ticket").replaceWith(items.filter('#ticket'));
          // Update changelog with original order
          $("#changelog").replaceWith(items.filter("#changelog"));
          // Reorder comments
          applyCommentsOrder(
            $('#prefs input[name="trac-comments-order"]:checked').val());
          // Show warning
          var new_changes = $("#changelog .trac-new");
          $("#trac-edit-warning").toggle(new_changes.length != 0);
          if (new_changes.length != 0)
            $("#changelog").parent().show().removeClass("collapsed");
          // Update view time
          $("#propertyform input[name='view_time']").replaceWith(items.filter("input[name='view_time']"));
          // Update preview
          var preview = $("#ticketchange").html(items.filter('#preview').children());
          var show_preview = preview.children().length != 0;
          $("#ticketchange").toggle(show_preview);
          setRevertHandler();
          // Collapse property form if comment editor has focus
          if (show_preview && comment_focused)
            $("#modify").parent().addClass("collapsed");
          // Execute scripts to load stylesheets
          items.filter("script").appendTo("head");
        }, "#ticketchange .trac-loading");
        $("#trac-comment-editor").autoSubmit({preview_comment: '1'}, function(data, reply) {
          var comment = $("#trac-comment-editor").next("div.comment").html(reply);
          comment.toggle(comment.children().length != 0);
        }, "#changelog .trac-loading");
        /*]]>*/
      });
    </script>
  </head>
  <body>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
        <ul>
          <li class="first"><span>&larr; <a class="prev" href="./116.html" title="ticket #116">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="./118.html" title="ticket #118">Next Ticket</a> &rarr;</span></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
        <div id="ticket" class="trac-content ">
  <div class="date">
    <p>Opened <a class="timeline" href="/trac/timeline?from=2014-07-14T15%3A43%3A36-07%3A00&amp;precision=second" title="See timeline at 07/14/14 15:43:36">7 years ago</a></p>
    <p>Last modified <a class="timeline" href="/trac/timeline?from=2015-12-02T08%3A01%3A26-08%3A00&amp;precision=second" title="See timeline at 12/02/15 08:01:26">5 years ago</a></p>
  </div>
  <h2>
    <a href="./117.html" class="trac-id">#117</a>
    <span class="trac-status">
      <a href="/trac/query?status=new">new</a>
    </span>
    <span class="trac-type">
      <a href="/trac/query?status=!closed&amp;type=enhancement">enhancement</a>
    </span>
  </h2>
  <h1 id="trac-ticket-title" class="searchable">
    <span class="summary">add example to 5.7 for multi-time dimension data</span>
  </h1>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable"><a href="/trac/query?status=!closed&amp;reporter=graybeal">graybeal</a></td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">cf-conventions@…</td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/trac/query?status=!closed&amp;priority=medium">medium</a>
        </td>
        <th id="h_milestone" class="missing">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="missing milestone"></a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/trac/query?status=!closed&amp;component=cf-conventions">cf-conventions</a>
        </td>
        <th id="h_version" class="missing">
          Version:
        </th>
        <td headers="h_version">
              <a href="/trac/query?status=!closed&amp;version="></a>
        </td>
    </tr><tr>
        <th id="h_keywords" class="missing">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
        <th id="h_cc" class="missing">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
In his post <a class="ext-link" href="http://mailman.cgd.ucar.edu/pipermail/cf-metadata/2006/001008.html"><span class="icon">​</span>http://mailman.cgd.ucar.edu/pipermail/cf-metadata/2006/001008.html</a>, Jonathan thoroughly summarizes possible scenarios that require multiple time axes in a CF file (for example, for handling both forecast (valid) times, and the run time of the forecast. 
</p>
<p>
He concludes with the proposal to add an example as described below.
</p>
<p>
From a look at section 5.7, it doesn't appear the example has been added. This ticket proposes adding it.
</p>
<p>
Reference also ticket <a class="closed ticket" href="./104.html" title="enhancement: Clarify the interpretation of scalar coordinate variables (closed: fixed)">#104</a>, though I don't believe the changes resulting from that ticket affect this one.
</p>
<blockquote class="citation">
<p>
I think what we need to do is add an example of structure (b), and here is one (an instance of case v) from the earlier discussion.
</p>
</blockquote>
<blockquote class="citation">
<blockquote class="citation">
<p>
20030101 12:00 analysis (at 00hr) and 12hr,36hr forecasts
20030101 00:00 analysis 6hr,12hr,18hr,24hr forecasts
20030101 06:00 analysis 6hr,18hr forecasts
</p>
</blockquote>
</blockquote>
<blockquote class="citation">
<p>
could be expressed as follows (ordering the time samples as they are above)
</p>
</blockquote>
<p>
variables:
</p>
<blockquote>
<p>
double reftime(record);
</p>
<blockquote>
<p>
time1:standard_name = "forecast_reference_time" ;
time1:units = "hours since 2003-01-01 00:00" ;
</p>
</blockquote>
<p>
double valtime(record);
</p>
<blockquote>
<p>
time2:standard_name = "time" ;
time2:units = "hours since 2003-01-01 00:00" ;
</p>
</blockquote>
<p>
float temp(record,level,lat,lon);
</p>
<blockquote>
<p>
temp:long_name = "Air temperature on model levels" ;
temp:standard_name = "air_temperature" ;
temp:units = "K" ;
temp:coordinates = "valtime reftime"
</p>
</blockquote>
</blockquote>
<p>
data:
</p>
<blockquote>
<p>
reftime = 12., 12., 12.,  0.,  0.,  0.,  0.,  6.,  6. ; 
valtime = 12., 24., 48.,  6., 12., 18., 24., 12., 24. ;
</p>
</blockquote>

    </div>
  </div>
</div>
          

        <div>
          <div class="trac-noscript" style="position: relative">
            <form id="prefs" method="get" action="/trac/prefs" style="position: absolute; right: 0">
              <div id="trac-comments-order">
                <input type="radio" id="trac-comments-oldest" name="trac-comments-order" value="oldest" checked="checked" />
                <label for="trac-comments-oldest">Oldest first</label>
                <input type="radio" id="trac-comments-newest" name="trac-comments-order" value="newest" />
                <label for="trac-comments-newest">Newest first</label>
                <span id="trac-threaded-toggle" style="display: none">
                  <input type="radio" id="trac-comments-threaded" name="trac-comments-order" value="threaded" />
                  <label for="trac-comments-threaded">Threaded</label>
                </span>
              </div>
              <div>
                <input id="trac-comments-only-toggle" type="checkbox" />
                <label for="trac-comments-only-toggle">Comments only</label>
              </div>
            </form>
          </div>
          <h3 class="foldable">Change History <span class="trac-count">(13)</span></h3>
          <div id="changelog">
              <div class="change" id="trac-change-1-1405378011158400">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:1" class="cnum">
    <a href="#comment:1">comment:1</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-07-14T15%3A46%3A51-07%3A00&amp;precision=second" title="See timeline at 07/14/14 15:46:51">7 years ago</a> by graybeal
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Modify the FAQ answer for "How can I describe a file with multiple time coordinates (e.g., run time AND valid or forecast time)" when this ticket is implemented in the standard.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2-1405498963203805">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:2" class="cnum">
    <a href="#comment:2">comment:2</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-07-16T01%3A22%3A43-07%3A00&amp;precision=second" title="See timeline at 07/16/14 01:22:43">7 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear John
</p>
<p>
Thanks you for bringing this subject back. It has often been asked about and I think it is sufficiently important to include it in the standard document as well as the FAQ. Section 5.7 is about scalar coord variables, so I don't think that's the right place for the new example about multiple-valued time coordinates. I would suggest that we add a new subsection 4.4.2. Here is some proposed text (drawing on your draft FAQ and the email discussion).
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>
<h1 id="a4.4.2.Timecoordinatesforforecastdata">4.4.2. Time coordinates for forecast data</h1>
<p>
In forecast applications, two kinds of time are distinguished: the time to which the forecast applies ("validity", "valid" or "forecast" time), and the time of the analysis from which the forecast was made ("analysis", "run", "data" or "reference" time). These kinds of time coordinate are recorded in separate variables, identified by <tt>standard_name</tt>. For the validity time, the <tt>standard_name</tt> of <tt>time</tt> is used, as is usual for the time coordinate of observed or simulated data. The <tt>standard_name</tt> for the analysis time is <tt>forecast_reference_time</tt>.
</p>
<p>
A single-valued analysis time or validity time can be stored in either a size-one coordinate variable or a scalar coordinate variable. If either the analysis time or the validity time is multiple-valued, but the other one is single-valued, it is recommended that there should be a coordinate variable (with dimension greater than one) for the multiple-valued one, and a size-one or a scalar coordinate variable for the other one. There could thus be two time dimensions for the data variable. Example 5.12 shows a case of multiple forecasts from a single analysis, where the analysis time is a scalar coordinate variable, and there is a dimension (of size greater than one) for validity time.
</p>
<p>
If both analysis time and validity time are multiple-valued, it is recommended to introduce a discrete axis (Section 4.5), and store both analysis time and validity time as one-dimensional auxiliary coordinate variables of this axis. This method is preferred because it is flexible, and can be used for the cases of multiple validity and analysis times where all combinations exist, multiple forecast periods from various analyses where all combinations exist, and multiple validity and analysis times where not all combinations exist. Example 4.7 illustrates the last of these cases. It is not recommended to have two multiple-valued time dimensions for the data variable.
</p>
<p>
Example 4.7. Multiple validity and analysis times
</p>
<pre class="wiki">dimensions:
    record=9;
variables:
    double reftime(record);
        time1:standard_name = "forecast_reference_time" ;
        time1:units = "hours since 2003-01-01 00:00" ;
    double valtime(record);
        time2:standard_name = "time" ;
        time2:units = "hours since 2003-01-01 00:00" ;
    double period(record);
        time2:standard_name = "forecast_period" ;
    float temp(record,level,lat,lon);
        temp:long_name = "Air temperature on model levels" ;
        temp:standard_name = "air_temperature" ;
        temp:units = "K" ;
        temp:coordinates = "valtime reftime"
data:
    reftime = 12., 12., 12., 0., 0., 0., 0., 6., 6. ;
    valtime = 12., 24., 48., 6., 12., 18., 24., 12., 24. ;
    period = 0., 12., 36., 6., 12., 18., 24., 6., 18. ;
</pre><p>
In this example, forecasts of air temperature have been made from analyses at 2003-01-01 12:00, 2003-01-01 00:00 and 2003-01-01 06:00. From the analysis of 2003-01-01 12:00, forecasts have been made for validity times of 2003-01-01 12:00 (i.e. the analysis time), 2003-01-02 00:00 (12 h later) and 2003-01-03 00:00 (36 h later). The example also includes an auxiliary coordinate variable of <tt>forecast_period</tt>, which is the difference between validity time and analysis time for each forecast. This information is redundant, but may be convenient.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3-1405504635468011">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:3" class="cnum">
    <a href="#comment:3">comment:3</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-07-16T02%3A57%3A15-07%3A00&amp;precision=second" title="See timeline at 07/16/14 02:57:15">7 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
I've noticed two omissions to the above.
</p>
<p>
(1) The forecast period should be named as an auxiliary coordinate variable:
</p>
<pre class="wiki">        temp:coordinates = "valtime reftime period" ;
</pre><p>
(2) Add the following to the conformance document:
</p>
<h1 id="a4.4.2.Timecoordinatesforforecastdata">4.4.2. Time coordinates for forecast data</h1>
<p>
Recommendations:
</p>
<ul><li>The data variable should not have more than one coordinate variable with dimension greater than one having any of the <tt>standard_name</tt>s of <tt>time</tt>, <tt>forecast_reference_time</tt> or <tt>forecast_period</tt>. It is recommended instead to have a single dimension, with auxiliary coordinates for these quantities all having this same dimension.
</li></ul><p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4-1405576826982680">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:4" class="cnum">
    <a href="#comment:4">comment:4</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-07-16T23%3A00%3A26-07%3A00&amp;precision=second" title="See timeline at 07/16/14 23:00:26">7 years ago</a> by graybeal
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Looks pretty good to me. Minor comments:
</p>
<p>
"It is not recommended to have two multiple-valued time dimensions for the data variable."  This sentence would be more useful if it ends ", because that &lt;does something bad&gt;."  The implicit reason as it stands is "because that isn't flexible", which seems a little weak.  There is a great power in always being able to find a 'time' coordinate, and it would be the natural choice for the naive. The argument for not organizing the file that way should be a strong one.
</p>
<p>
To avoid the odd <tt>standard_name</tt>s construct in 4.4.2 words, suggest the wording "having a <tt>standard_name</tt> of any of <tt>time</tt>, ...".
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5-1405685469991684">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:5" class="cnum">
    <a href="#comment:5">comment:5</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-07-18T05%3A11%3A09-07%3A00&amp;precision=second" title="See timeline at 07/18/14 05:11:09">7 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <blockquote class="citation">
<p>
It is not recommended to have two multiple-valued time dimensions for the data variable.
</p>
</blockquote>
<p>
I am concerned about this 'recommendation'.  Having a time dimension with a time(time) coordinate and a forecast_period dimension with a forecast_period(forecast_period) coordinate is a useful case which is common in many of our data sets.
</p>
<p>
In this case there is generally a 2D auxiliary coordinate of forecast_reference_time(time, forecast_period); this quite often degenerates to a single value.
</p>
<p>
Similarly we have numerous data sets which have a time dimension with a time(time) coordinate and a forecast_reference_time dimension with a forecast_reference_time(forecast_reference_time) coordinate.
</p>
<p>
In this case there is generally a 2D auxiliary coordinate of forecast_period(time, forecast_reference_time).
</p>
<p>
Both of these cases are deemed practical and are in widespread use in the communities I am in contact with.  There are a number of data analysis processes which are assisted by the data sets being structured in this way.
</p>
<p>
What is the intent of 'not recommended'?
</p>
<p>
Is this proposal intending to tell users not to encode their data sets in this way?
</p>
<p>
Is this proposal intending to have a validation rule for CF to indicate that this is invalid?
</p>
<p>
mark
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6-1406220680672968">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:6" class="cnum">
    <a href="#comment:6">comment:6</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:8" class="follow-up">↓ 8</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-07-24T09%3A51%3A20-07%3A00&amp;precision=second" title="See timeline at 07/24/14 09:51:20">7 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear John and Mark
</p>
<p>
You have both commented on the recommendation to use a discrete axis in the case where both forecast time and analysis time are multivalued. First let me say thhat this is proposed only as a <em>recommendation</em>, not as a <em>requirement</em>. Stating it like this means it is not invalid to do things in the other ways which Mark describes. It means that the CF checker, for instance, would give a warning, but not an error.
</p>
<p>
Cases like the ones which Mark mentions are considered in the CF email which John refers to, from many years ago! The case with multiple validity and analysis times, where all combinations exist, is case (iii) in the list from 2006, which reports a discussion from 2003. But the outcome of the discussion wasn't adopted into the convention at that time so it's not surprising data has been written in other ways since then.
</p>
<p>
I agree with Mark that the structure with <tt>time</tt> and <tt>forecast_period</tt> dimensions, for forecasts for a set of validity times each made with various forecast periods, could be convenient. That one is not in the list from 2006, which does on the other hand include forecasts made from a set of analysis times for a set of forecast periods. I don't follow why the <tt>forecast_reference_time</tt> in Mark's case often degenerates to a single value. Wouldn't it be more obvious to treat this case as a single set of forecasts from a single analysis with a range of different validity times (and corresponding forecast periods)? This is then not a case which needs two multivalued time dimensions.
</p>
<p>
There is no reason for the proposed recommendation except that it makes life easier for data-users if the number of cases they have to be able to deal with is minimised. The case with the discrete axis is the only way to handle situations where there are missing combinations. For instance, you may have a "triangular" set, with forecasts from a range of analysis times, for a given validity time and later. Forecasts from earlier analysis times will have validity times going less far into the future (if the forecast system uses the same set of forecast periods on each run). Or you might just have randomly missing combinations or ones you were not interested in. Hence the data-analyst has to be able to deal with this case (v in the list from 2006). This structure will also work for the cases which could be represented by two multivalued axes, but it would be easier if the data-analyst doesn't have to be prepared to deal with all three of those possible cases (iii and iv in the list from 2006, and the case Mark describes).
</p>
<p>
In summary: there is no justification other than that this appears to be the simplest convention which is sufficiently flexible. Other conventions make life more complicated for data-users, but they are not prohibited. What do you and others think?
</p>
<p>
Your wording change is fine with me, John. Thanks.
</p>
<p>
Cheers
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7-1406228268351080">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:7" class="cnum">
    <a href="#comment:7">comment:7</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-07-24T11%3A57%3A48-07%3A00&amp;precision=second" title="See timeline at 07/24/14 11:57:48">7 years ago</a> by taylor13
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear all,
</p>
<p>
I agree that the proposed change is a flexible and simple approach to handling forecasts, but if there are conventional ways of doing this that involve two coordinates, perhaps we should recommend that they be used for common special cases.  For example, for the SPECS Project, which focuses on seasonal to decadal prediction, they require two time variables as described in their data specifications document (authored by Pierre-Antoine Bretonniere). Here is an excerpt:
</p>
<hr />
<p>
One of the novelties of the SPECS conventions is the requirement for two time variables: one being called time(time) which corresponds to the verification time of the forecast and one called leadtime.  Both of these variables are mandatory in the files and must have the following
</p>
<p>
double time(time) ;
time:units = "days since 1850-01-01" ;
time:bounds = "time_bnds" ;
time:long_name = "Verification time of the forecast" ;
time:standard_name = "time" ;
time:axis = "T"
double leadtime(time) ;
leadtime:units = "days" ;
leadtime:long_name = "Time elapsed since the start of the forecast" ;
leadtime:standard_name = "forecast_period" ;
</p>
<hr />
<p>
Note that they also store the forecast_reference_time as a global attribute or it can be calculated as the difference between "time" and "leadtime".
</p>
<p>
I recall there was much discussion about how to do this some time ago, and I will write to Pierre-Antoine and Paco Doblas-Reyes to see why they preferred this approach rather than doing something along the lines that Jonathan suggested above (i.e., using a single time dimension with standard name "time" to indicate verification time and a singleton dimension to indicate the forecast_reference_time).
</p>
<p>
[sorry that I haven't reviewed the emails from 2003 and 2006, which might contain the answer.]
</p>
<p>
cheers,
Karl
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8-1406717088395259">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:8" class="cnum">
    <a href="#comment:8">comment:8</a>
  </span>
        in reply to:
    <a href="#comment:6">↑ 6</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-07-30T03%3A44%3A48-07%3A00&amp;precision=second" title="See timeline at 07/30/14 03:44:48">7 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./117#comment:6" title="Comment 6">jonathan</a>:
</p>
<p>
Thank you for you comments Jonathan, a few thoughts:
 
</p>
<blockquote class="citation">
<p>
You have both commented on the recommendation to use a discrete axis in the case where both forecast time and analysis time are multivalued. First let me say thhat this is proposed only as a <em>recommendation</em>, not as a <em>requirement</em>. Stating it like this means it is not invalid to do things in the other ways which Mark describes. It means that the CF checker, for instance, would give a warning, but not an error.
</p>
</blockquote>
<p>
I find it odd that these cases would return a warning from a cf checker.  If this is the intent of a recommendation then I think that this proposal is too restrictive in approach.  I would like data sets with two temporal dimensions to be recognised as valid CF-netCDF, not reported on with warning of potential bad practice.
</p>
<blockquote class="citation">
<p>
I agree with Mark that the structure with <tt>time</tt> and <tt>forecast_period</tt> dimensions, for forecasts for a set of validity times each made with various forecast periods, could be convenient. That one is not in the list from 2006, which does on the other hand include forecasts made from a set of analysis times for a set of forecast periods. I don't follow why the <tt>forecast_reference_time</tt> in Mark's case often degenerates to a single value. Wouldn't it be more obvious to treat this case as a single set of forecasts from a single analysis with a range of different validity times (and corresponding forecast periods)? This is then not a case which needs two multivalued time dimensions.
</p>
</blockquote>
<p>
You are right, I don't think the degenerate case helps the discussion here.
</p>
<p>
mark
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9-1406728517692762">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:9" class="cnum">
    <a href="#comment:9">comment:9</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2014-07-30T06%3A55%3A17-07%3A00&amp;precision=second" title="See timeline at 07/30/14 06:55:17">7 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Mark and Karl
</p>
<p>
I don't feel strongly about limiting the number of structures. That we agreed on this years ago isn't a crucial argument, since we didn't put it in the convention then. The CF convention should be as simple as possible, but no simpler!
</p>
<p>
If the case with forecast_period and validity time axes is recommended elsewhere (by SPECS) that's an argument for including it, with an example like the one Karl gave. The 2D case with forecast_period and analysis time axes is equally natural and it would be inconsistent to deprecate one and not the other. What about the case with axes of analysis time and validity time? It seems to me that you are less likely to have all possible combinations in that case: some of the validity times will be too far into the future or will be already in the past for some of the analyses, given that it would be usual to use a consistent set of forecast periods.
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10-1448983078376101">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:10" class="cnum">
    <a href="#comment:10">comment:10</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2015-12-01T07%3A17%3A58-08%3A00&amp;precision=second" title="See timeline at 12/01/15 07:17:58">5 years ago</a> by martin.juckes
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hello All,
</p>
<p>
I've come to this ticket after it was mentioned in a recent correspondence. While it makes perfect sense to have recommended approach to dealing with arbitrary combinations of reference time and forecast period coordinate values, I feel that this is not a good solution for the case of a block which can be expressed as the product of two linear coordinates. That is, we might have data for a set of reference times and validation times (all forecasts for a given day for a range of lead times), or for a set of reference times and lead times or, conceivably, for a set of lead times and validation times. In each case users may reasonably expect to find two independent dimensions on the data array. I would prefer to see a recommendation for dealing with such regular cases. E.g.
</p>
<pre class="wiki">dimensions:
    t1=9;
    t2=8;
variables:
    double t1(t1);
        t1:standard_name = "&lt;sn1&gt;" ;
        t1:units = "&lt;un1&gt;" ;
    double t2(t2);
        t2:standard_name = "&lt;sn2&gt;" ;
        t2:units = "&lt;un2&gt;" ;
    double t3(t1,t2);
        t3:standard_name = "&lt;sn3&gt;" ;
        t3:units = "&lt;un3&gt;" ;
    float temp(t1,t2,level,lat,lon);
        temp:long_name = "Air temperature on model levels" ;
        temp:standard_name = "air_temperature" ;
        temp:units = "K" ;
        temp:coordinates = "t3"
</pre><p>
where {(sn1, un1)} etc can have any permutation of the following:
</p>
<pre class="wiki">     (time, hours since 2003-01-01 00:00)
     (forecast_reference_time, hours since 2003-01-01 00:00)
     (forecast_period, hours)
</pre><p>
Regards,
Martin
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11-1448993636279811">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:11" class="cnum">
    <a href="#comment:11">comment:11</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2015-12-01T10%3A13%3A56-08%3A00&amp;precision=second" title="See timeline at 12/01/15 10:13:56">5 years ago</a> by caron
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Funny this topic comes up now, as Ive been meaning to propose a new conventions that is exactly this topic, and indeed fits precisely into martin's proposal.
</p>
<p>
The gist of the issue is when we combine model output from multiple runs, then we have both a reftime and a set of time offsets from each reference time. The common case is that each reftime has the same set of offsets, which can be expressed succinctly as:
</p>
<pre class="wiki">    double reftime(reftime);
        time1:standard_name = "forecast_reference_time" ;
        time1:units = "hours since 2003-01-01 00:00" ;
    double offset(offset);
        offset:long_name= "time offset from reference" ;
        offset:units = "hours" ;
</pre><p>
and data values can then use:
</p>
<pre class="wiki">    float temp(reftime,offset,level,lat,lon);
</pre><p>
There are two big advantages of this over the recomendation here of adding a single dimension that lists all the coordinates in a 1D array.
</p>
<ol><li>its easy to understand what set of coordinates are possible, namely {reftime} x {offset}
</li></ol><ol start="2"><li>the set of coordinates is m + n instead of m x n. Ive been dealing with very large datasets, eg reanalysis that have upward of 100,000 reference times and 10-100 offsets. 
</li></ol><p>
So the additional convention needed is to create a new type of time coordinate which has units of time (not datetime), and can only be used in conjunction with a reference time:
</p>
<pre class="wiki">    double offset(offset);
        offset:standard_name = "forecast_offset_time" ;
        offset:long_name= "time offset from reference" ;
        offset:units = "hours" ;
</pre><p>
Then the "forecast time" is a simple calculation from the offset time and reference time coordinates.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12-1449041596280706">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:12" class="cnum">
    <a href="#comment:12">comment:12</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2015-12-01T23%3A33%3A16-08%3A00&amp;precision=second" title="See timeline at 12/01/15 23:33:16">5 years ago</a> by martin.juckes
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hello John,
</p>
<p>
I think that the standard name "forecast_period" can be used as an offset time in the forecast context, but I agree that it would be good to have an option for a generic "offset_time" for other applications,
</p>
<p>
regards,
Martin
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13-1449072086202332">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:13" class="cnum">
    <a href="#comment:13">comment:13</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2015-12-02T08%3A01%3A26-08%3A00&amp;precision=second" title="See timeline at 12/02/15 08:01:26">5 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear John
</p>
<p>
As Martin says, the existing <tt>forecast_period</tt> standard name is your time offset. I would not be in favour of a generic name, unless a generic use-case comes up which requires it - being more specific is generally more informative.
</p>
<p>
I agree that two time dimensions is an more efficient way to handle this situation if all combinations are present. We could have examples of this too. However, in a separate email discussion, I think (if I have understood correctly - not having read the emails very carefully) it's been suggested that some software would be upset by having more than one multivalued time dimension. The arrangement with a single time dimension and multiple auxiliary coordinate variables is more flexible, and especially it can deal with the case of missing combinations, so I think we should add it (the main purpose of this ticket).
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/trac/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="./117?format=rss" class="rss">RSS Feed</a>
        </li><li>
          <a rel="nofollow" href="./117?format=csv" class="csv">Comma-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="./117?format=tab" class="tab">Tab-delimited Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="https://trac.edgewall.org/"><img src="/trac/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/trac/about"><strong>Trac 1.0.20</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the CF Metadata home page at<br /><a href="http://cf-convention.github.io">http://cf-convention.github.io</a><br><font color="#0000ff" size="3"><b>The CF Metadata Trac issue tracker is read-only and will soon be shut down permanently</b></font></p>
    </div>
  </body>
</html>
