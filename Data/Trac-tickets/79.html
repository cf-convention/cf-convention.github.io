<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      #79 (Handling and formatting of vector quantities in CF)
     – CF Metadata
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/trac/search" />
        <link rel="prev" href="./78.html" title="ticket #78" />
        <link rel="last" href="./176.html" title="ticket #176" />
        <link rel="help" href="/trac/wiki/TracGuide" />
        <link rel="alternate" href="./79?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" /><link rel="alternate" href="./79?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="./79?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" />
        <link rel="next" href="./80.html" title="ticket #80" />
        <link rel="start" href="/trac/wiki" />
        <link rel="stylesheet" href="/trac/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/trac/chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="./1.html" title="ticket #1" />
        <link rel="shortcut icon" href="/trac/chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="/trac/chrome/common/trac.ico" type="image/x-icon" />
    <style id="trac-noscript" type="text/css">.trac-noscript { display: none !important }</style>
      <link type="application/opensearchdescription+xml" rel="search" href="/trac/search/opensearch" title="Search CF Metadata" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="b8aeac20bf7fd49b63339caa";
      var comments_prefs={"comments_only":"false","comments_order":"oldest"};
    </script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/folding.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/wikitoolbar.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/resizer.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/auto_preview.js"></script>
    <script type="text/javascript">
      jQuery("#trac-noscript").remove();
      jQuery(document).ready(function($) {
        $(".trac-autofocus").focus();
        $(".trac-target-new").attr("target", "_blank");
        setTimeout(function() { $(".trac-scroll").scrollToTop() }, 1);
        $(".trac-disable-on-submit").disableOnSubmit();
      });
    </script>
    <script type="text/javascript" src="/trac/chrome/common/js/threaded_comments.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
      /*<![CDATA[*/
        $("#attachments").toggleClass("collapsed");
        $("#trac-up-attachments").click(function () {
          $("#attachments").removeClass("collapsed");
          return true;
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
        function setRevertHandler() {
          $("button.trac-revert").click(function() {
            var div = $("div", this);
            var field_name = div[0].id.substr(7);
            var field_value = div.text();
            var input = $("#propertyform *[name=field_" + field_name + "]");
            if (input.length > 0) {
              if (input.filter("input[type=radio]").length > 0) {
                input.val([field_value]);
              } else if (input.filter("input[type=checkbox]").length > 0) {
                input.val(field_value == "1" ? [field_value] : []);
              } else {
                input.val(field_value);
              }
            } else { // Special case for CC checkbox
              input = $("#propertyform input[name=cc_update]").val([]);
            }
            input.change();
            $(this).closest("li").remove();
            return false;
          });
        }
        setRevertHandler();
        var comment_focused = false;
        $("#comment").focus(function() { comment_focused = true; })
                     .blur(function() { comment_focused = false; });
        $("#propertyform").autoSubmit({preview: '1'}, function(data, reply) {
          var items = $(reply);
          // Update ticket box
          $("#ticket").replaceWith(items.filter('#ticket'));
          // Update changelog with original order
          $("#changelog").replaceWith(items.filter("#changelog"));
          // Reorder comments
          applyCommentsOrder(
            $('#prefs input[name="trac-comments-order"]:checked').val());
          // Show warning
          var new_changes = $("#changelog .trac-new");
          $("#trac-edit-warning").toggle(new_changes.length != 0);
          if (new_changes.length != 0)
            $("#changelog").parent().show().removeClass("collapsed");
          // Update view time
          $("#propertyform input[name='view_time']").replaceWith(items.filter("input[name='view_time']"));
          // Update preview
          var preview = $("#ticketchange").html(items.filter('#preview').children());
          var show_preview = preview.children().length != 0;
          $("#ticketchange").toggle(show_preview);
          setRevertHandler();
          // Collapse property form if comment editor has focus
          if (show_preview && comment_focused)
            $("#modify").parent().addClass("collapsed");
          // Execute scripts to load stylesheets
          items.filter("script").appendTo("head");
        }, "#ticketchange .trac-loading");
        $("#trac-comment-editor").autoSubmit({preview_comment: '1'}, function(data, reply) {
          var comment = $("#trac-comment-editor").next("div.comment").html(reply);
          comment.toggle(comment.children().length != 0);
        }, "#changelog .trac-loading");
        /*]]>*/
      });
    </script>
  </head>
  <body>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
        <ul>
          <li class="first"><span>&larr; <a class="prev" href="./78.html" title="ticket #78">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="./80.html" title="ticket #80">Next Ticket</a> &rarr;</span></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
        <div id="ticket" class="trac-content ">
  <div class="date">
    <p>Opened <a class="timeline" href="/trac/timeline?from=2012-02-22T02%3A40%3A12-08%3A00&amp;precision=second" title="See timeline at 02/22/12 02:40:12">9 years ago</a></p>
    <p>Last modified <a class="timeline" href="/trac/timeline?from=2013-04-15T06%3A16%3A28-07%3A00&amp;precision=second" title="See timeline at 04/15/13 06:16:28">8 years ago</a></p>
  </div>
  <h2>
    <a href="./79.html" class="trac-id">#79</a>
    <span class="trac-status">
      <a href="/trac/query?status=reopened">reopened</a>
    </span>
    <span class="trac-type">
      <a href="/trac/query?status=!closed&amp;type=enhancement">enhancement</a>
    </span>
  </h2>
  <h1 id="trac-ticket-title" class="searchable">
    <span class="summary">Handling and formatting of vector quantities in CF</span>
  </h1>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable"><a href="/trac/query?status=!closed&amp;reporter=lavergne">lavergne</a></td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">cf-conventions@…</td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/trac/query?status=!closed&amp;priority=medium">medium</a>
        </td>
        <th id="h_milestone" class="missing">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="missing milestone"></a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/trac/query?status=!closed&amp;component=cf-conventions">cf-conventions</a>
        </td>
        <th id="h_version" class="missing">
          Version:
        </th>
        <td headers="h_version">
              <a href="/trac/query?status=!closed&amp;version="></a>
        </td>
    </tr><tr>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
              <a href="/trac/query?status=!closed&amp;keywords=~vector">vector</a>
        </td>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              <a href="/trac/query?status=!closed&amp;cc=~markh">markh</a>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <h2 id="a1.Title">1. Title</h2>
<p>
Handling and formatting of vector quantities in CF
</p>
<h2 id="a2.Moderator">2. Moderator</h2>
<ol class="upperalpha" start="20"><li>Lavergne (Norwegian Met Institute - MET.NO)
</li></ol><h2 id="a3.Requirement">3. Requirement</h2>
<p>
As of writing this proposal, the CF convention allows for defining datasets/variables that are components of 2D (or 3D) vectors. For example, a CF file might contain a <tt>wind_speed</tt> and a <tt>wind_direction</tt> variables.
</p>
<p>
It, however, lacks the capability to indicate that the two variables above are truly the components of a higher-dimension <strong>vector</strong> (the wind vector, that in that case would be 2D). Such a capability would be quite useful for:
</p>
<ul><li>Allowing a single <tt>status_flag</tt> to apply for the vector as a whole, that is to both its components. Such a flag variable should have <tt>wind_vector status_flag</tt> as its <tt>standard_name</tt> (if the vector object was given the standard name <tt>wind_vector</tt>).
</li><li>Enable third-party software (such as map plotting software) to identify that there is a vector object in the file, and that it can thus be displayed with arrows (or barbs).
</li><li>Generally easing any vector-based operations such as rotation/scaling of components when changing Earth-mapping projection.
</li></ul><p>
If feasible, the implementation of this proposal should be made backward compatible.
</p>
<h2 id="a4.InitialStatementofTechnicalProposal">4. Initial Statement of Technical Proposal</h2>
<p>
The requirements above can be implemented using an <em>umbrella</em> variable for the vector variable. Such a variable would hold no data, have no dimension, and be of arbitrary type, just like the <em>grid mapping variable</em> (5.6. Horizontal Coordinate Reference Systems, Grid Mappings, and Projections).
</p>
<p>
The (proposed) <em>vector variable</em> would hold only two string attributes: a <tt>standard_name</tt> and a <tt>components</tt> one. It can hold others such as <tt>long_name</tt> if relevant.
</p>
<p>
The <tt>standard_name</tt> identifies what the vector quantity is about, and allows for later cross-referencing (e.g. in the <tt>status_flag</tt> example above).
</p>
<p>
The <tt>components</tt> attribute is a space-separated list of variable names that are all components of the <em>vector variable</em>. It is noteworthy that components is intended as any decomposition of the vector along some axis (e.g. speed/dir, x/y, u/v, north/east, etc...). To be valid, a <em>vector variable</em> shall have <strong>at least</strong> as many components as the dimensionality of the vector. A 2D wind vector shall thus list at least 2 components (e.g. u and v) but we allow for the <tt>speed</tt> to also be in the file, and listed as a component.
</p>
<p>
As the case now, each component variable shall define its <tt>dimensions</tt>, <tt>units</tt>, <tt>standard_name</tt>, <tt>grid_mapping</tt>, etc... The <em>vector variable</em> only holds the necessary attributes to find what the components are.
</p>
<p>
Note that all the components variables named by the <em>vector variable</em> must have the same set of coordinate axes, identified by the <tt>standard_name</tt>s of their coordinate variables, although they do not have to have the same sets of coordinate values. This is to exclude, for instance, one component variable having time-latitude-longitude and another time-altitude-latitude-longitude as coordinate variables, but it does permit components to be on an Arakawa C-grid.
</p>
<p>
It should probably not be allowed to list two variables in the <tt>components</tt> attribute that both have the same 'standard_name'. The <em>vector variable</em> would then have two (possibly different) directions.  
</p>
<p>
The proposal could be implemented as a section "3.6 Vector quantities".
</p>
<h2 id="a5.Example">5. Example</h2>
<p>
Example in the case of an sea ice drift dataset:
</p>
<pre class="wiki">// The two X and Y datasets and the direction.
float dX(time, yc, xc) ;
 dX:long_name = "component of the displacement along the x axis of the grid" ;
 dX:standard_name = "sea_ice_x_displacement" ;
 dX:units = "km" ;
 dX:_FillValue = -1.e+10f ;
 dX:coordinates = "lat lon" ;
 dX:grid_mapping = "Polar_Stereographic_Grid" ;

float dY(time, yc, xc) ;
 dY:long_name = "component of the displacement along the y axis of the grid" ;
 dY:standard_name = "sea_ice_y_displacement" ;
 dY:units = "km" ;
 dY:_FillValue = -1.e+10f ;
 dX:coordinates = "lat lon" ;
 dX:grid_mapping = "Polar_Stereographic_Grid" ;

float dir(time, yc, xc) ;
 dY:long_name = "direction of the displacement" ;
 dY:standard_name = "direction_of_sea_ice_displacement" ;
 dY:units = "degrees" ;
 dY:_FillValue = -1.e+10f ;
 dX:coordinates = "lat lon" ;
 dX:grid_mapping = "Polar_Stereographic_Grid" ;

// The new vector variable:

int ice_drift_vector;
 drift_vector:standard_name = "sea_ice_displacement_vector" ;
 drift_vector:long_name = "sea ice drift vector" ;
 drift_vector:components = "dX dY dir" ;

// A status flag for the vector:

byte status_flag(time, yc, xc) ;
 status_flag:standard_name = "sea_ice_displacement_vector status_flag" ;
 status_flag:long_name = "rejection and quality level flag" ;
 status_flag:valid_min = 0b ;
 status_flag:valid_max = 30b ;
 status_flag:grid_mapping = "Polar_Stereographic_Grid" ;
 status_flag:coordinates = "lat lon" ;
 status_flag:flag_values = 0b, 1b,..., 22b, 30b ;
 status_flag:flag_meanings = "missing_input_data over_land ... interpolated nominal_quality" ;

</pre><h2 id="a6.Benefits">6. Benefits</h2>
<p>
This proposal will ease the use of any vector quantities so winds, currents, sea ice motion, etc... 
</p>
<p>
It enables the data producer to document that there are some vector quantities hosted in this file. This should greatly help e.g. third-party software to locate the vectors and act specifically for them (plot with arrows, rotate them, etc...)
</p>
<h2 id="a7.StatusQuoandotherapproaches">7. Status Quo and other approaches</h2>
<p>
This proposal stems from a discussion on the main CF list, originally posted as "[CF-metadata] Proposal for better handling vector quantities in CF" on Nov 24th 2011. The discussion contains both PROS and CONS to the proposal, as well as some alternative approaches. We will not summarize these discussions here, but let us nonetheless list the alternatives:
</p>
<ul><li>Extensive use of <tt>ancillary_variables</tt>;
</li><li>Define a <tt>vector</tt> <strong>dimension</strong>;
</li><li>Introduce Groups (Common Data Model-2) in CF;
</li><li>Introduce Compound Data Types (HDF5) in CF.
</li></ul>
    </div>
  </div>
</div>
          

        <div>
          <div class="trac-noscript" style="position: relative">
            <form id="prefs" method="get" action="/trac/prefs" style="position: absolute; right: 0">
              <div id="trac-comments-order">
                <input type="radio" id="trac-comments-oldest" name="trac-comments-order" value="oldest" checked="checked" />
                <label for="trac-comments-oldest">Oldest first</label>
                <input type="radio" id="trac-comments-newest" name="trac-comments-order" value="newest" />
                <label for="trac-comments-newest">Newest first</label>
                <span id="trac-threaded-toggle" style="display: none">
                  <input type="radio" id="trac-comments-threaded" name="trac-comments-order" value="threaded" />
                  <label for="trac-comments-threaded">Threaded</label>
                </span>
              </div>
              <div>
                <input id="trac-comments-only-toggle" type="checkbox" />
                <label for="trac-comments-only-toggle">Comments only</label>
              </div>
            </form>
          </div>
          <h3 class="foldable">Change History <span class="trac-count">(69)</span></h3>
          <div id="changelog">
              <div class="change" id="trac-change-1-1330095503000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:1" class="cnum">
    <a href="#comment:1">comment:1</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:5" class="follow-up">↓ 5</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-02-24T06%3A58%3A23-08%3A00&amp;precision=second" title="See timeline at 02/24/12 06:58:23">9 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Thomas
</p>
<p>
Thank you for writing this proposal, which I support. Following the discussion on the email list, I like this solution best because it is lightweight, flexible and backwards-compatible. I agree with what you have written, except
</p>
<ul><li>I think we should be more precise about which CF attributes are allowed on the umbrella variable. Looking at Appendix A, I would suggest that it could have any of these ones: <tt>standard_name</tt>, <tt>long_name</tt>, (the new att) <tt>components</tt>, <tt>ancillary_variables</tt>, <tt>comment</tt>, <tt>history</tt>, <tt>institution</tt>, <tt>references</tt>, <tt>source</tt>. It doesn't make sense for it to have any of the attributes that describe data values or coordinates. Rather than listing the allowed attributes in a new section, I suggest that we should add a new symbol <strong>U</strong> in the <strong>Use</strong> column of Appendix A to define which CF attributes are permitted on umbrella variables. (Of course, since CF always allows other non-standardised attributes, without giving them an interpretation, it would not be an error to have other attributes, but it could deserve a warning.)
</li></ul><ul><li> I don't think we need to impose a restriction of a minimum number of components. This would not be possible to check unless we defined that minimum number for each umbrella standard name. Since the application using the data has to inspect the components to find out what decomposition is being used, I think we can leave it up to the application to give an error if it can't find what it needs, rather than making it a defect of the file.
</li></ul><ul><li>I suggest that in your example the umbrella variable should have an <tt>ancillary_variables</tt> attribute pointing to the status flag variable. This is not mandatory, but it is a courtesy.
</li></ul><p>
I like your two proposed restrictions, that the components should have axes with the same standard names, and that all the components should be distinct.
</p>
<p>
I think it is a part of the proposal, isn't it, that we will be introducing a new class of standard name, which can only be used for umbrella variables. This will require a flag in the standard name table.
</p>
<p>
I agree that a new section 3.6 would be a logical place to introduce this new feature. An amendment to section 3.3 would be needed as well. In order for us to agree it, we need a proposal of exactly the text to be added to the conventions document and the changes to be made to the conformance document.
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2-1331216443000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:2" class="cnum">
    <a href="#comment:2">comment:2</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-03-08T06%3A20%3A43-08%3A00&amp;precision=second" title="See timeline at 03/08/12 06:20:43">9 years ago</a> by mgschultz
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Thomas,
</p>
<blockquote>
<p>
I am also in favour of your suggestion. However, I am not sure if I like "A 2D wind vector shall thus list at least 2 components (e.g. u and v) but we allow for the speed to also be in the file, and listed as a component." In this example, wind can be fully described by either u and v or speed and direction. A "component" should in my view be limited to specifying the components that are required to construct the vector. Additional "related" variables should carry some other attribute that can refer to the vector, but do you think we need the association in the reverse direction (from vector to additional quantities)?
</p>
</blockquote>
<p>
Best,
</p>
<p>
Martin
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3-1331224779000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:3" class="cnum">
    <a href="#comment:3">comment:3</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:6" class="follow-up">↓ 6</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-03-08T08%3A39%3A39-08%3A00&amp;precision=second" title="See timeline at 03/08/12 08:39:39">9 years ago</a> by ngalbraith
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Allowing speed <strong>and direction</strong> in addition to x and y vectors makes this proposal much more useful to me. We often store/serve all of these, because they're generated differently within an instrument. For example, speed is often under-reported when wind is provided only as a pair of vectors.
</p>
<p>
So, I'd like to suggest amending the above:
</p>
<blockquote>
<p>
A 2D wind vector shall thus list at least 2 components (e.g. u and v) but we allow for the speed <em>and/or direction</em> to also be in the file, and listed as <em>components</em>. 
</p>
</blockquote>
<p>
I'm not sure if there's another existing convention to specify this relationship, but also don't see how allowing nominally redundant components lessens the usefulness of the vector "container variable".  
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4-1331225961000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:4" class="cnum">
    <a href="#comment:4">comment:4</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:7" class="follow-up">↓ 7</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-03-08T08%3A59%3A21-08%3A00&amp;precision=second" title="See timeline at 03/08/12 08:59:21">9 years ago</a> by mgschultz
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Just to clarify: I have no objections whatsoever to include additional quantities in the file. I would just think that the concept of defining a "vector" shall allow a data processing application to identify the situation when it needs more than one quantity to produce a plot (e.g. wind vector plot, wind vanes or whatever). This would become difficult if there are "optional" additional fields listed in the components. If the reference is made only in the reverse direction, then a program that analyses for example "wind_speed" would have a chance to find out that it could use the vector quantities "u" and "v" instead. 
</p>
<p>
If you can explain to me why the additional fields shall be listed in the components, then I would be happy with that, provided that we can somehow draw this distinction between "mandatory" and "optional" components.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5-1331715456000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:5" class="cnum">
    <a href="#comment:5">comment:5</a>
  </span>
        in reply to:
    <a href="#comment:1">↑ 1</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-03-14T01%3A57%3A36-07%3A00&amp;precision=second" title="See timeline at 03/14/12 01:57:36">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:1" title="Comment 1">jonathan</a>:
</p>
<p>
Good point with identifying which attributes are valid for a vector variable in Appendix A. I would however propose we use the letter <strong>V</strong> (vector) rather than U (umbrella). The concept of umbrella variable was handy to introduce what I wanted, but we should now probably use the concept of <em>vector</em> and <em>component</em> variable.
</p>
<blockquote class="citation">
<p>
I think it is a part of the proposal, isn't it, that we will be introducing a new class of standard name, which can only be used for umbrella variables. This will require a flag in the standard name table.
</p>
</blockquote>
<p>
Yes, this is my understanding. I will be happy to propose/request a new standard name for sea ice motion vectors. Others will later request the standard names required by their application.
</p>
<blockquote class="citation">
<p>
I agree that a new section 3.6 would be a logical place to introduce this new feature. An amendment to section 3.3 would be needed as well. In order for us to agree it, we need a proposal of exactly the text to be added to the conventions document and the changes to be made to the conformance document.
</p>
</blockquote>
<p>
Yes. It was not clear to me whether the trac ticket should directly start with an "official" text or with a general message introducing the proposal. I'll try to work on a text in the coming weeks.
</p>
<p>
Thomas
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6-1331716303000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:6" class="cnum">
    <a href="#comment:6">comment:6</a>
  </span>
        in reply to:
    <a href="#comment:3">↑ 3</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-03-14T02%3A11%3A43-07%3A00&amp;precision=second" title="See timeline at 03/14/12 02:11:43">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:3" title="Comment 3">ngalbraith</a>:
</p>
<blockquote class="citation">
<p>
Allowing speed <strong>and direction</strong> in addition to x and y vectors makes this proposal much more useful to me. We often store/serve all of these, because they're generated differently within an instrument. For example, speed is often under-reported when wind is provided only as a pair of vectors.
</p>
</blockquote>
<p>
Yes. This was only given as an example to make the point that we do not require all the possible components/decompositions of a given vector field to be specified in the file. It is valid (although maybe not very smart) to omit the <em>direction</em>. We want to allow any number of components for a given vector field, just like the case now (one can have both x, y, speed, direction, u, and v in the same CF file as of today). 
</p>
<p>
The only new thing this proposal would bring is that we now link and unite all these datasets and identify them as <em>components</em> of a single vector field. 
</p>
<blockquote class="citation">
<p>
So, I'd like to suggest amending the above:
</p>
<blockquote>
<p>
A 2D wind vector shall thus list at least 2 components (e.g. u and v) but we allow for the speed <em>and/or direction</em> to also be in the file, and listed as <em>components</em>. 
</p>
</blockquote>
</blockquote>
<p>
As I mentioned above in an answer to Jonathan, we could drop the "at least 2 components" part. The file containing only <em>x</em> for describing the full wind vector would be a valid CF file, but most applications would fail and report missing information.
</p>
<blockquote class="citation">
<p>
I'm not sure if there's another existing convention to specify this relationship, but also don't see how allowing nominally redundant components lessens the usefulness of the vector "container variable".  
</p>
</blockquote>
<p>
We could drop that requirement too (although Jonathan supports it). But I still would like to make the user aware that if he has 2 <em>speed</em> datasets in the same file, which have not identical values, and that he claims are both the components of a unique vector field, this user has an issue with his file.
</p>
<p>
Thomas
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7-1331716901000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:7" class="cnum">
    <a href="#comment:7">comment:7</a>
  </span>
        in reply to:
    <a href="#comment:4">↑ 4</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-03-14T02%3A21%3A41-07%3A00&amp;precision=second" title="See timeline at 03/14/12 02:21:41">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:4" title="Comment 4">mgschultz</a>:
</p>
<blockquote class="citation">
<p>
If you can explain to me why the additional fields shall be listed in the components, then I would be happy with that, provided that we can somehow draw this distinction between "mandatory" and "optional" components.
</p>
</blockquote>
<p>
I do not think there are such things as "mandatory" or "optional" components. This proposal was not meant to decide which types of components are more useful than others. The only thing we want is to unite all the components variables in a given file and associate them to a vector field.
</p>
<p>
Yes, there might be redundancy, and I have other ideas on how to limit it but I do not think it is the scope of this first proposal.  
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8-1331733763000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:8" class="cnum">
    <a href="#comment:8">comment:8</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:9" class="follow-up">↓ 9</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-03-14T07%3A02%3A43-07%3A00&amp;precision=second" title="See timeline at 03/14/12 07:02:43">9 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
I think this is a very useful extension to the CF standard and I support its inclusion.
</p>
<p>
I feel that the 'umbrella variable' approach provides sufficient scope for defining vector quantities made up of components.
</p>
<p>
A vector quantity differs from a scalar in that it has magnitude and direction.  The direction requires a little care in definition.
</p>
<p>
I wonder if we should constrain the behaviour to either have components of the vector, or magnitude and direction, but not both.  The example of defining 2 components and a direction in a components attribute does not seem correct to me.  However, I am not sure that this can be tested for compliance.
</p>
<p>
I certainly agree that one should be able to either define magnitude and direction, or components.  
</p>
<p>
Perhaps we could have three attributes available for the vector variable:
</p>
<ul><li>components: a space separated list of variable names
</li><li>magnitude: a single variable name
</li><li>direction: a space separated list of variable names 
</li></ul><blockquote>
<blockquote>
<p>
This could be defined as 'any of the above' but it may be constrained to 'magnitude and direction' or 'components' but not both if that was deemed valuable.
</p>
</blockquote>
</blockquote>
<p>
To define direction we need to be careful how the grid_mapping attribute is interpreted.
</p>
<p>
As such I wonder whether the vector umbrella variable should be allowed to have a grid_mapping attribute. Is this attribute only inferred from the components?
</p>
<blockquote>
<p>
I think there should be a limitation that components of a vector should not have different grid_mapping attributes, otherwise it may not be possible to correctly combine the components to define the vector.
</p>
</blockquote>
<blockquote>
<p>
This could be achieved by providing a capability for a grid_mapping attribute on the vector variable and requiring consistency with all components referenced.
</p>
</blockquote>
<p>
Replying to <a class="ticket" href="./79#comment:1" title="Comment 1">jonathan</a>:
</p>
<blockquote class="citation">
<ul><li> I don't think we need to impose a restriction of a minimum number of components. This would not be possible to check unless we defined that minimum number for each umbrella standard name. Since the application using the data has to inspect the components to find out what decomposition is being used, I think we can leave it up to the application to give an error if it can't find what it needs, rather than making it a defect of the file.
</li></ul></blockquote>
<p>
This could be addressed for an individual variable by requiring that the vector variable defines it's dimensionality: it could be defined as a two vector or a three vector.  If 'dimensionality' was a required attribute, with an integer value, then this could be used to ensure sufficient components (d) or directional components (d-1) are defined.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9-1331809536000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:9" class="cnum">
    <a href="#comment:9">comment:9</a>
  </span>
        in reply to:
    <a href="#comment:8">↑ 8</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-03-15T04%3A05%3A36-07%3A00&amp;precision=second" title="See timeline at 03/15/12 04:05:36">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:8" title="Comment 8">markh</a>:
Dear Mark,
</p>
<p>
Thank you for your support.
</p>
<blockquote class="citation">
<p>
I wonder if we should constrain the behaviour to either have components of the vector, or magnitude and direction, but not both.  The example of defining 2 components and a direction in a components attribute does not seem correct to me.  However, I am not sure that this can be tested for compliance.
</p>
<p>
I certainly agree that one should be able to either define magnitude and direction, or components.
</p>
</blockquote>
<p>
In today's CF, one can define both magnitude (e.g. speed), directions, and the x/y (or u/v) components in a file. We do not want to break or amend this. This proposal solely aims at uniting all the components variables (that pre-exist in todays CF file) under a single vector "object" (umbrella variable). 
</p>
<blockquote class="citation">
<p>
Perhaps we could have three attributes available for the vector variable:
</p>
<ul><li>components: a space separated list of variable names
</li><li>magnitude: a single variable name
</li><li>direction: a space separated list of variable names
</li></ul></blockquote>
<p>
I tend to <strong>not</strong> support this. First, I want to precise that <em>magnitude</em> and <em>direction</em> are to me not different from 'x', 'y', 'u' or 'v'. Magnitude and direction are just regular <em>components</em>... on a polar base. Second - and it is one of the strength of the umbrella variable approach - each of the component variables have standard names that describe what they are (a magnitude, a direction, a x, a y, etc...). So we do not need the umbrella variable to document this. To find the direction of the vector field, a user/software just needs to go through the list of ':components' variables listed by the umbrella, and check their ':standard_name' until the direction is found.
</p>
<blockquote class="citation">
<blockquote>
<p>
I think there should be a limitation that components of a vector should not have different grid_mapping attributes, otherwise it may not be possible to correctly combine the components to define the vector.
</p>
</blockquote>
</blockquote>
<p>
Yes. Such a limitation is included in the proposal (although maybe not directly on the grid_mapping, but on the dimensions). I would tend to say it achieves the same goal.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10-1331832651000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:10" class="cnum">
    <a href="#comment:10">comment:10</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:23" class="follow-up">↓ 23</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-03-15T10%3A30%3A51-07%3A00&amp;precision=second" title="See timeline at 03/15/12 10:30:51">9 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Thomas
</p>
<p>
I agree with your view that we should not distinguish the functions of the "components" or between mandatory and optional. I see this proposal simply as way to group related quantities. If there is redundancy, that is fine. I would be concerned about redundancy in <em>metadata</em>, but redundancy in data is a normal situation. It is already permissible in a CF-conforming file to provide u, v, direction and speed. This proposal does not change that at all; it just provides a means to indicate that these quantities are related. I wonder if Martin can agree to that.
</p>
<p>
<strong>V</strong> for <em>vector</em> might be too restrictive, since this proposal also applies to tensors. Could we use <strong>T</strong>?
</p>
<p>
Cheers
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11-1334231745000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:11" class="cnum">
    <a href="#comment:11">comment:11</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:14" class="follow-up">↓ 14</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-04-12T04%3A55%3A45-07%3A00&amp;precision=second" title="See timeline at 04/12/12 04:55:45">9 years ago</a> by jonblower
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Just a note that people are working on ways of representing uncertain data in NetCDF (called "NetCDF-U") and have come up with a similar approach of an "umbrella variable" (which they call a "concept without values" variable) to group variables together.  For example, the mean and variance of a field are grouped to indicate they form a single "concept".
</p>
<p>
It would probably be a good idea to harmonize the syntax in some way, or think about whether there could be a generic means to group 2 or more variables in a semantic fashion, which would handle vectors, uncertainties and perhaps other use cases.
</p>
<p>
HTH,
Jon
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12-1342101712000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:12" class="cnum">
    <a href="#comment:12">comment:12</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:21" class="follow-up">↓ 21</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-07-12T07%3A01%3A52-07%3A00&amp;precision=second" title="See timeline at 07/12/12 07:01:52">9 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Following investigations with implementing analyses using such vector/tensor umbrella variables we have identified two limitations within this proposal:
</p>
<ul><li>How to identify the dimensionality of a vector
<ul><li>this information is important for many operations, e.g. curl of a 2d vector and curl of a 3d vector are very different calculations.
</li></ul></li><li>How to identify which component a variable listed in 'components' is with respect to the vector quantity:
<ul><li>standard_name is optional and complex to parse, making this a fragile approach to component identification
</li></ul></li></ul><p>
Also of note:
Replying to <a class="ticket" href="./79#comment:6" title="Comment 6">lavergne</a>:
</p>
<blockquote class="citation">
<p>
We could drop that requirement too (although Jonathan supports it). But I still would like to make the user aware that if he has 2 <em>speed</em> datasets in the same file, which have not identical values, and that he claims are both the components of a unique vector field, this user has an issue with his file.
</p>
</blockquote>
<p>
To address these issues I propose two amendments:
</p>
<ol><li>A new attribute for vector variables: Dimensionality:
<ul><li>Dimensionality: an integer defining the order of the vector or tensor quantity
</li></ul></li><li>Explicit statement of the components relationship to the vector field:
<ul><li>providing identification of a components relationship to the vector field
</li><li>enforcing the requirement that a component must not be stated multiple times for a vector field
</li><li>available components:
<ul><li>x_component
</li><li>y_component
</li><li>z_component
</li><li>magnitude
</li><li>xy_direction 
</li><li>z_direction
</li></ul></li></ul></li></ol><ol start="2"><li>could be implemented either as a list of fixed name attributes or a complex string, with key value pairs.  
</li></ol><p>
This would alter the propsed example to:
</p>
<pre class="wiki">// The new vector variable:

int ice_drift_vector;
 drift_vector:standard_name = "sea_ice_displacement_vector" ;
 drift_vector:long_name = "sea ice drift vector" ;
 drift_vector:dimensionality = 2 ;
 drift_vector:components = "x_component:dX y_component:dY xy_direction:dir" ;
</pre>
    </div>

              </div>
              <div class="change" id="trac-change-13-1342105916000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:13" class="cnum">
    <a href="#comment:13">comment:13</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:22" class="follow-up">↓ 22</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-07-12T08%3A11%3A56-07%3A00&amp;precision=second" title="See timeline at 07/12/12 08:11:56">9 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-cc">
      <strong class="trac-field-cc">Cc</strong>
        <em>markh</em> added
    </li>
  </ul>
    <div class="comment searchable">
      <p>
I have also given further consideration to the definition of a grid_mapping, and I think that it would be useful to enable a vector quantity to define a grid_mapping attribute
</p>
<p>
The extension to the grid_mapping attribute syntax agreed in <a class="closed ticket" href="./70.html" title="enhancement: Connecting coordinates to Grid Mapping variables (closed: fixed)">#70</a> enables a data variable to define multiple grid_mappings. As such it may be necessary to be explicit the grid mapping which the vector quantity is with respect to.
</p>
<p>
I wonder whether it is useful to always define a grid_mapping, to explicitly define the meaning of x, y and z within the scope of the vector variable.  This may help with conformance checking, ensuring that data variables defined as components are not stating different grid_mappings. 
</p>
<p>
As such, the definition of a grid_mapping could be mandated for spatial vectors, if it is felt that would be necessary.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-14-1342542727000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:14" class="cnum">
    <a href="#comment:14">comment:14</a>
  </span>
        in reply to:
    <a href="#comment:11">↑ 11</a>
        ;
          <span>follow-ups:</span>
    <a href="#comment:15" class="follow-up">↓ 15</a>
    <a href="#comment:20" class="follow-up">↓ 20</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-07-17T09%3A32%3A07-07%3A00&amp;precision=second" title="See timeline at 07/17/12 09:32:07">9 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:11" title="Comment 11">jonblower</a>:
</p>
<blockquote class="citation">
<p>
Just a note that people are working on ways of representing uncertain data in NetCDF (called "NetCDF-U") and have come up with a similar approach of an "umbrella variable" (which they call a "concept without values" variable) to group variables together.  For example, the mean and variance of a field are grouped to indicate they form a single "concept".
</p>
<p>
It would probably be a good idea to harmonize the syntax in some way, or think about whether there could be a generic means to group 2 or more variables in a semantic fashion, which would handle vectors, uncertainties and perhaps other use cases.
</p>
<p>
HTH,
Jon
</p>
</blockquote>
<p>
I have looked into the proposal for NetCDF-U, as posted here:  
<a class="ext-link" href="http://mailman.cgd.ucar.edu/pipermail/cf-metadata/2011/049494.html"><span class="icon">​</span>http://mailman.cgd.ucar.edu/pipermail/cf-metadata/2011/049494.html</a>
but mailman doesn't keep hold of the attahcments.
</p>
<p>
The use of umbrella variables is pretty generic: they use the ancillary_variables attribute on a data variable with no data array payload to indicate some grouping taking place.  It is left up to the user to infer meaning from this grouping based on uncertML concepts, no further semantics are implied by the linking NetCDF metadata as far as i can make out.
</p>
<p>
I think this is quite different from the case of vector component definitions, where a particular set of semantics are to be explicitly defined within the metadata.
</p>
<p>
It is my view that this proposal can provide the required semantics.  It may be that encoding of uncertainty could use a similar approach, rather than ancillary data, but it may be that there are too many disperate cases so it is better to retain much more flexibility.
</p>
<p>
I would not be in favour of adopting the approach used for uncertainty in NetCDF for vector quantity definitions, I think the requirements are for a focussed and specialist approach, as advocated here.
</p>
<p>
I think it is also worth noting that NetCDF-U was (is?) put forward as consistent with CF, not part of CF.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-15-1342544210000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:15" class="cnum">
    <a href="#comment:15">comment:15</a>
  </span>
        in reply to:
    <a href="#comment:14">↑ 14</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-07-17T09%3A56%3A50-07%3A00&amp;precision=second" title="See timeline at 07/17/12 09:56:50">9 years ago</a> by jonblower
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:14" title="Comment 14">markh</a>:
</p>
<blockquote class="citation">
<p>
I would not be in favour of adopting the approach used for uncertainty in NetCDF for vector quantity definitions, I think the requirements are for a focussed and specialist approach, as advocated here.
</p>
</blockquote>
<p>
Sure.  I was actually thinking the other way around, that NetCDF-U could follow a similar approach to this proposal for vectors, which would involve using stronger names for NetCDF attributes than the generic "ancillary_variables".  But this is a different discussion of course.
</p>
<blockquote class="citation">
<p>
It may be that encoding of uncertainty could use a similar approach, rather than ancillary data, but it may be that there are too many disperate cases
</p>
</blockquote>
<p>
As far as I understand, I think there are only really three structural cases in NetCDF-U: distributions, summary statistics and samples.  Each of these has the concept of something like "components", although the meaning of the "component" is different in each case.
</p>
<blockquote class="citation">
<p>
I think it is also worth noting that NetCDF-U was (is?) put forward as consistent with CF, not part of CF.
</p>
</blockquote>
<p>
Yes, although people will undoubtedly try to use them together so I'd like to try to ensure that this can be done relatively cleanly.  (No doubt there will be use cases for recording vector components as uncertain quantities at some point...)
</p>
<p>
Anyway, I don't want to distract from the core discussion in this ticket, just wanted to make sure that opportunities aren't missed for spotting related work.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-16-1345226956000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:16" class="cnum">
    <a href="#comment:16">comment:16</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:17" class="follow-up">↓ 17</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-17T11%3A09%3A16-07%3A00&amp;precision=second" title="See timeline at 08/17/12 11:09:16">9 years ago</a> by rhorne@…
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Folks:
</p>
<p>
I saw an email the other day saying the review period is over, and there have been no objections.  Be aware that I am working the GOES-R program and this system includes level 1b space weather products where the data values are associated with directional field of views.  My goal is, using the fundamental building block CF constructs of coordinate variables, cells, etc., extend the conventions to support the construction of level 1b space weather products that are self-describing and standards-based.
</p>
<p>
This relates to this vector enhancement because unit vectors are a simple and convenient mechanism to define the location of the level 1b space weather data.  The problem is that the CF vector extension as defined here falls short of what is needed to support these level 1b space weather products.  For example these field of views, whose boresight (center) angle can be expressed as a three-dimensional unit vector, have a 3D angular extent around this boresight angle that is needed to completes the definition of the field of view (associated with product data values).  An example field of view pattern is a circular cone.  This angular extent can be conceptualized as being specified with a boundary variable (cell construct), but the vector construct as currently proposed does not provide the capability for the vector, as a singular entity to be associated with a boundary variable.  There are even case where a level 1b space weather product data value is associated with a directional field of view that is moving.  In this case, there are two "levels" of cells:  (1) one for the range that accounts for the center angle of the directional field of view moving, and (2) one for the angular extent associated with the field of view pattern (e.g. circular cone).
</p>
<p>
I don't want to gum up the works and slow down the evolution of the CF conventions, but, at the same time, I wanted to let you'll know about the on-going effort to come up with a CF metadata conventions "like" approach to defining self-describing and standards-based level 1b space weather products.
</p>
<p>
Please advise.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-17-1345470599000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:17" class="cnum">
    <a href="#comment:17">comment:17</a>
  </span>
        in reply to:
    <a href="#comment:16">↑ 16</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:19" class="follow-up">↓ 19</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-20T06%3A49%3A59-07%3A00&amp;precision=second" title="See timeline at 08/20/12 06:49:59">9 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:16" title="Comment 16">rhorne@excaliburlabs.com</a>:
</p>
<blockquote class="citation">
<p>
Folks:
</p>
<p>
I saw an email the other day saying the review period is over, and there have been no objections.  
</p>
</blockquote>
<p>
Hello Randy
</p>
<p>
I do not think the review period is over for this ticket, you may be referring to my post regarding <a class="closed ticket" href="./89.html" title="enhancement: standard names for vector components (closed: fixed)">#89</a>, which is somewhat related to this ticket, but definitely a serarate issue.
</p>
<p>
I am hoping that Thomas will return to this ticket soon and attempt to assimilate the comments to date.  
</p>
<p>
I feel there is some discussion still required before this ticket is finalised; driving this from a perspective of real use is very powerful.
</p>
<p>
What alterations would you propose to this vector specification to enable you to store your data and metadata effectively?
</p>
<p>
Are you confident that the data types you are interested in are vectors, datasets with magnitude and direction across a sampling feature?  
</p>
<p>
Could these 1b space weather datasets be a different type, which happens to use a vector as part of their definition?
</p>
<p>
I don't think this is 'gummin up the works' at all; I'd like to see if these space weather data types need to be in scope, and if so, how to accomodate them.
</p>
<p>
all the best
mark
</p>

    </div>

              </div>
              <div class="change" id="trac-change-18-1345472241000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:18" class="cnum">
    <a href="#comment:18">comment:18</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-20T07%3A17%3A21-07%3A00&amp;precision=second" title="See timeline at 08/20/12 07:17:21">9 years ago</a> by rhorne@…
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
There are some more pertinent details on these level 1b space weather products....
</p>
<p>
unlike the use of vectors above which ses vectors to define the data elements in the products (i.e. the data variables) ...
</p>
<p>
The use of vectors for level 1b space weather is solely to locate the data in space (i.e. coordinate variables).  In this case the vector is a 3D unit vector in a celestial coordinate system (i.e. J2000 ECI).  This unit vector specifies a direction, and magnitude is irrelevant.  This unit vector defines the boresight angle for the instrument's aperture.
</p>
<p>
To fully specify the location associated with the data here requires more than just a unit vector.  There is also a need to specify additional information to make it clear what the entire field of view is.  The field of view is an angular range.  For example, a field of view angular range might be 30 degrees (with the unit vector being the centerline).
</p>
<p>
The 3D unit vector requires three coordinate variables.  Although, conceptually, the 30 degrees is related to the CF cell construct (i.e. the use of the "bounds" attribute), there is no CF convention that allows a cell to be associated with a vector.  Also note that there is no CF convention for angular bounds.
</p>
<p>
Note that there are other fields of view that are more complicated that the circular cone identified in the previous paragraph.  Some space weather instruments have rectangular frustum and elliptical cone fields of view.
</p>
<p>
I am currently working on some strawman CF conventions that will work for these level 1b space weather products.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-19-1345533121000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:19" class="cnum">
    <a href="#comment:19">comment:19</a>
  </span>
        in reply to:
    <a href="#comment:17">↑ 17</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-21T00%3A12%3A01-07%3A00&amp;precision=second" title="See timeline at 08/21/12 00:12:01">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:17" title="Comment 17">markh</a>:
</p>
<blockquote class="citation">
<p>
Replying to <a class="ticket" href="./79#comment:16" title="Comment 16">rhorne@excaliburlabs.com</a>:
</p>
<blockquote class="citation">
<p>
Folks:
</p>
<p>
I saw an email the other day saying the review period is over, and there have been no objections.  
</p>
</blockquote>
<p>
Hello Randy
</p>
<p>
I do not think the review period is over for this ticket, you may be referring to my post regarding <a class="closed ticket" href="./89.html" title="enhancement: standard names for vector components (closed: fixed)">#89</a>, which is somewhat related to this ticket, but definitely a serarate issue.
</p>
<p>
I am hoping that Thomas will return to this ticket soon and attempt to assimilate the comments to date.  
</p>
</blockquote>
<p>
Hi all,
</p>
<p>
Good news for this ticket: Thomas is back in business. I will answer/follow on the recent comments and tentatively propose a text later this week.
</p>
<p>
Cheers,
</p>

    </div>

              </div>
              <div class="change" id="trac-change-20-1345534358000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:20" class="cnum">
    <a href="#comment:20">comment:20</a>
  </span>
        in reply to:
    <a href="#comment:14">↑ 14</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-21T00%3A32%3A38-07%3A00&amp;precision=second" title="See timeline at 08/21/12 00:32:38">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:14" title="Comment 14">markh</a>:
</p>
<blockquote class="citation">
<p>
Replying to <a class="ticket" href="./79#comment:11" title="Comment 11">jonblower</a>:
</p>
<blockquote class="citation">
<p>
Just a note that people are working on ways of representing uncertain data in NetCDF (called "NetCDF-U") and have come up with a similar approach of an "umbrella variable" (which they call a "concept without values" variable) to group variables together.  For example, the mean and variance of a field are grouped to indicate they form a single "concept".
</p>
<p>
It would probably be a good idea to harmonize the syntax in some way, or think about whether there could be a generic means to group 2 or more variables in a semantic fashion, which would handle vectors, uncertainties and perhaps other use cases.
</p>
<p>
HTH,
Jon
</p>
</blockquote>
<p>
I have looked into the proposal for NetCDF-U, as posted here:  
<a class="ext-link" href="http://mailman.cgd.ucar.edu/pipermail/cf-metadata/2011/049494.html"><span class="icon">​</span>http://mailman.cgd.ucar.edu/pipermail/cf-metadata/2011/049494.html</a>
but mailman doesn't keep hold of the attahcments.
</p>
<p>
The use of umbrella variables is pretty generic: they use the ancillary_variables attribute on a data variable with no data array payload to indicate some grouping taking place.  It is left up to the user to infer meaning from this grouping based on uncertML concepts, no further semantics are implied by the linking NetCDF metadata as far as i can make out.
</p>
</blockquote>
<p>
Hi Mark and Jon,
</p>
<p>
I had myself a look at the netCDF-U documents (mainly slides from workshops). I first agreed with Jon that the definition of a generic umbrella variable with only "ancillary_variables" was meeting our needs. After all, our vector variable is purely a container. The semantic of, say, variable <em>dX</em> w.r.t. to variable <em>ice_drift_vector</em> is not to be specified by <em>ice_drift_vector</em>, but by <em>dX</em>, via its standard_name. 
</p>
<p>
But after some time, I now tend to follow Mark on this. Not because of pure semantic, but more for human readability. A human would expect a vector to contain <em>components</em> and will look for them. In fact, should the vector come with additional flag and/or uncertainties, then these two variables could be listed as <em>ancillary_variables</em>, but the <em>components</em> attribute would still be the place to look for... the components.
</p>
<p>
So I would advocate for keeping <em>components</em> for the vector/tensor.
</p>
<p>
Thomas
</p>

    </div>

              </div>
              <div class="change" id="trac-change-21-1345537161000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:21" class="cnum">
    <a href="#comment:21">comment:21</a>
  </span>
        in reply to:
    <a href="#comment:12">↑ 12</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-21T01%3A19%3A21-07%3A00&amp;precision=second" title="See timeline at 08/21/12 01:19:21">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:12" title="Comment 12">markh</a>:
</p>
<blockquote class="citation">
<p>
Following investigations with implementing analyses using such vector/tensor umbrella variables we have identified two limitations within this proposal:
</p>
<ul><li>How to identify the dimensionality of a vector
<ul><li>this information is important for many operations, e.g. curl of a 2d vector and curl of a 3d vector are very different calculations.
</li></ul></li><li>How to identify which component a variable listed in 'components' is with respect to the vector quantity:
<ul><li>standard_name is optional and complex to parse, making this a fragile approach to component identification
</li></ul></li></ul><p>
Also of note:
Replying to <a class="ticket" href="./79#comment:6" title="Comment 6">lavergne</a>:
</p>
<blockquote class="citation">
<p>
We could drop that requirement too (although Jonathan supports it). But I still would like to make the user aware that if he has 2 <em>speed</em> datasets in the same file, which have not identical values, and that he claims are both the components of a unique vector field, this user has an issue with his file.
</p>
</blockquote>
<p>
To address these issues I propose two amendments:
</p>
<ol><li>A new attribute for vector variables: Dimensionality:
<ul><li>Dimensionality: an integer defining the order of the vector or tensor quantity
</li></ul></li><li>Explicit statement of the components relationship to the vector field:
<ul><li>providing identification of a components relationship to the vector field
</li><li>enforcing the requirement that a component must not be stated multiple times for a vector field
</li><li>available components:
<ul><li>x_component
</li><li>y_component
</li><li>z_component
</li><li>magnitude
</li><li>xy_direction 
</li><li>z_direction
</li></ul></li></ul></li></ol><ol start="2"><li>could be implemented either as a list of fixed name attributes or a complex string, with key value pairs.  
</li></ol><p>
This would alter the propsed example to:
</p>
<pre class="wiki">// The new vector variable:

int ice_drift_vector;
 drift_vector:standard_name = "sea_ice_displacement_vector" ;
 drift_vector:long_name = "sea ice drift vector" ;
 drift_vector:dimensionality = 2 ;
 drift_vector:components = "x_component:dX y_component:dY xy_direction:dir" ;
</pre></blockquote>
<p>
Mark,
</p>
<p>
This is a good proposal, thanks for bringing it forward. Both the <em>dimensionality</em> and the identification of components (key/value pairs) are helping the readability. However, I am concerned they both introduce some redundancy.
</p>
<p>
For dimensionality: The definition text of the standard_name <em>sea_ice_velocity_vector</em> would probably start as "Sea ice velocity vector is a 2D vector defined at sea ice surface". The exact text is not important per se, but there are no <em>sea_ice_velocity_vector</em> that are 3D. The same for <em>wind_vector</em>: "Wind is defined as a two-dimensional (horizontal) air velocity vector, with no vertical component. (Vertical motion in the atmosphere has the standard name upward_air_velocity.)". So what I mean is that the dimensionality of a given standard name for vectors is (will be) embedded in its definition. In fact, in the Standard Name Table, the column "canonical unit" (or a new one) could read "2D vector", "3D vector".
</p>
<p>
The same for the identification of the type of component in a key/value list: each variable listed as a component will have its own standard, which will explicit if it is an x_ component or a xy_direction. Hence redundancy.
</p>
<p>
I am not sure redundancy is B.A.D. but at least the first proposal did not have any (I think). The redundancy you propose to introduce surely helps the human reader, but as far as a machine is concerned, it is not much harder to parse a list of key/value pairs than to read the standard_name attributes of each component variable. I have no definite answer here. Your proposal appeals to me for human readability, but I do not feel confident my comfort justifies redundancy.  
</p>
<p>
I can anyway start on a text including your two points, and we can remove them later if we feel they are not worth the redundancy. Or we can have them as optional, but again I am not sure what is W.O.R.S.E: options or redundancy!
</p>
<p>
Thomas
</p>
<p>
 
</p>

    </div>

              </div>
              <div class="change" id="trac-change-22-1345537571000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:22" class="cnum">
    <a href="#comment:22">comment:22</a>
  </span>
        in reply to:
    <a href="#comment:13">↑ 13</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-21T01%3A26%3A11-07%3A00&amp;precision=second" title="See timeline at 08/21/12 01:26:11">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:13" title="Comment 13">markh</a>:
</p>
<blockquote class="citation">
<p>
I have also given further consideration to the definition of a grid_mapping, and I think that it would be useful to enable a vector quantity to define a grid_mapping attribute
</p>
<p>
The extension to the grid_mapping attribute syntax agreed in <a class="closed ticket" href="./70.html" title="enhancement: Connecting coordinates to Grid Mapping variables (closed: fixed)">#70</a> enables a data variable to define multiple grid_mappings. As such it may be necessary to be explicit the grid mapping which the vector quantity is with respect to.
</p>
<p>
I wonder whether it is useful to always define a grid_mapping, to explicitly define the meaning of x, y and z within the scope of the vector variable.  This may help with conformance checking, ensuring that data variables defined as components are not stating different grid_mappings. 
</p>
<p>
As such, the definition of a grid_mapping could be mandated for spatial vectors, if it is felt that would be necessary.
</p>
</blockquote>
<p>
Mark,
</p>
<p>
Again a very good point, thank you. I bumped on this myself when having to re-grid/re-project my vector fields. How do I tell the user if my vector components are still aligned with the old x/y axis, or if they have been rotated to the new grid?
</p>
<p>
But I think this is a lack in CF that was there prior my will to gather the components under an umbrella variable. I would say the best place to specify this grid_mapping would be at component variable level, not at vector level. And maybe the best thing to do would be to open a new trac ticket where we could start a new, focused discussion on this? I would follow you there :) What do you think? 
</p>
<p>
Thomas
</p>

    </div>

              </div>
              <div class="change" id="trac-change-23-1345537943000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:23" class="cnum">
    <a href="#comment:23">comment:23</a>
  </span>
        in reply to:
    <a href="#comment:10">↑ 10</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-21T01%3A32%3A23-07%3A00&amp;precision=second" title="See timeline at 08/21/12 01:32:23">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:10" title="Comment 10">jonathan</a>:
</p>
<blockquote class="citation">
<p>
Dear Thomas
</p>
<p>
I agree with your view that we should not distinguish the functions of the "components" or between mandatory and optional. I see this proposal simply as way to group related quantities. If there is redundancy, that is fine. I would be concerned about redundancy in <em>metadata</em>, but redundancy in data is a normal situation. It is already permissible in a CF-conforming file to provide u, v, direction and speed. This proposal does not change that at all; it just provides a means to indicate that these quantities are related. I wonder if Martin can agree to that.
</p>
</blockquote>
<p>
See! Jonathan is "concerned about redundancy in <em>metadata</em>". That sheds a new light on my latest answers to Mark.
 
</p>
<blockquote class="citation">
<p>
<strong>V</strong> for <em>vector</em> might be too restrictive, since this proposal also applies to tensors. Could we use <strong>T</strong>?
</p>
</blockquote>
<p>
I am not used to work with Tensors quantities. It might be they are more frequent than I expect and that <strong>T</strong> is a better letter. Or use <strong>V</strong> and define it as <em>vectors and tensors</em>. It might be that what Randy is looking at for his l1b unit vectors are tensors? 
</p>
<p>
Thomas 
</p>
<blockquote class="citation">
<p>
Cheers
</p>
<p>
Jonathan
</p>
</blockquote>

    </div>

              </div>
              <div class="change" id="trac-change-24-1345548181000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:24" class="cnum">
    <a href="#comment:24">comment:24</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:33" class="follow-up">↓ 33</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-21T04%3A23%3A01-07%3A00&amp;precision=second" title="See timeline at 08/21/12 04:23:01">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-resolution">
      <strong class="trac-field-resolution">Resolution</strong>
        set to <em>worksforme</em>
    </li><li class="trac-field-status">
      <strong class="trac-field-status">Status</strong>
        changed from <em>new</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      <p>
<strong>Proposed implementation of <a class="reopened ticket" href="./79.html" title="enhancement: Handling and formatting of vector quantities in CF (reopened)">#79</a> in CF document:</strong>
</p>
<p>
<strong>Note to Mark: I went for the minimum implementation, that is with as little metadata redundancy as possible.</strong> 
</p>
<p>
<strong>Note to Jonathan: The Arakawa-C grid fell out of this proposal (see first comments). Could you post an example CDL description of how you were thinking this? Then we could amend the proposal to include that case as well?</strong> 
</p>
<p>
Add section "3.5 Vectors and Tensors".
</p>
<h2 id="a3.5.VectorsandTensors">3.5. Vectors and Tensors</h2>
<p>
Many geophysical quantities are <em>vectors</em> (e.g. a wind vector, a sea ice velocity 
vector, etc...) or <em>tensors</em>. As multi-dimensional objects, both vectors and tensors 
have a set of <em>components</em> that can be used on their own (e.g. a wind speed) or be applied 
a set of multi-dimensional operations (e.g. divergence, curl, etc...). A vector (or tensor) 
<em>field</em> has <em>fields</em> of component variables, that are variables that take values on a grid.
</p>
<p>
In CF, a <em>vector</em> (or <em>tensor</em>) field variable is a variable of arbitrary type since it contains 
no data (similar to the <em>grid mapping variable</em> defined in section 5.6). Its role is to act 
as a container for the attributes that describe the vector field. Vector variables shall
have (at least) two string attributes: <em>standard_name</em>, and <em>components</em> (see Appendix A).
</p>
<p>
The standard_name of a vector (or tensor) variable is as any other standard_name in CF, and
can noticeably be used in standard name modifiers constructs. The <em>components</em> attribute
takes a space-separated list of variable names, each of them being henceforth recorded as 
name of a component of the vector/tensor. 
The component variables are regular CF data variables, and thus have a <em>standard_name</em>. A
user or application looking for the xy_direction component of a vector variable can thus
browse through the list of its <em>components</em> and identify the requested data variable
using the latter's standard name.
</p>
<p>
Note that all the data variables listed in <em>components</em> shall have the same set of 
dimensions. This is to exclude, for instance, one component 
variable having dimension (time,lat,lon) and another (time,level,lat,lon) as for the same 
vector/tensor field. It is not allowed to list two variables in the <em>components</em> attribute 
that both have the same 'standard_name'.
</p>
<p>
Example 3.6: A sea ice drift vector field:
</p>
<pre class="wiki">// NOTE: the dimensions, grid_mapping and axis variables are not
//    included here to keep focus on the vector variable

// The two X and Y datasets and the direction.
float dX(time, yc, xc) ;
 dX:long_name = "component of the displacement along the x axis of the grid" ;
 dX:standard_name = "sea_ice_x_displacement" ;
 dX:units = "km" ;
 dX:_FillValue = -1.e+10f ;
 dX:coordinates = "lat lon" ;
 dX:grid_mapping = "Polar_Stereographic_Grid" ;

float dY(time, yc, xc) ;
 dY:long_name = "component of the displacement along the y axis of the grid" ;
 dY:standard_name = "sea_ice_y_displacement" ;
 dY:units = "km" ;
 dY:_FillValue = -1.e+10f ;
 dX:coordinates = "lat lon" ;
 dX:grid_mapping = "Polar_Stereographic_Grid" ;

float dir(time, yc, xc) ;
 dY:long_name = "direction of the displacement" ;
 dY:standard_name = "direction_of_sea_ice_displacement" ;
 dY:units = "degrees" ;
 dY:_FillValue = -1.e+10f ;
 dX:coordinates = "lat lon" ;
 dX:grid_mapping = "Polar_Stereographic_Grid" ;

// The vector variable:
int ice_drift_vector;
 drift_vector:standard_name = "sea_ice_displacement_vector" ;
 drift_vector:long_name = "sea ice drift vector" ;
 drift_vector:components = "dX dY dir" ;
 drift_vector:ancillary_variables = "status_flag" ;

// A status flag for the vector:
byte status_flag(time, yc, xc) ;
 status_flag:standard_name = "sea_ice_displacement_vector status_flag" ;
 status_flag:long_name = "rejection and quality level flag" ;
 status_flag:valid_min = 0b ;
 status_flag:valid_max = 30b ;
 status_flag:grid_mapping = "Polar_Stereographic_Grid" ;
 status_flag:coordinates = "lat lon" ;
 status_flag:flag_values = 0b, 1b,..., 22b, 30b ;
 status_flag:flag_meanings = "missing_input_data over_land ... interpolated nominal_quality" ;
</pre><h2 id="ApendixA.Attributes">Apendix A. Attributes</h2>
<p>
Introduction text:
</p>
<p>
The "Type" values are S for string, N for numeric, and D for the type of the data variable. 
The "Use" values are G for global, C for variables containing coordinate data, &lt;add&gt;<strong>V for vectors and tensors variables</strong>&lt;/add&gt; and D for variables containing non-coordinate data.  
</p>
<p>
In the table: 
</p>
<p>
1) add the line:
Attribute: 'components' / Type:S / Use:V / Links: Section 3.5, "Vectors and Tensors" / Description: "Space-separated list of names of data variables containing components values for the vector (tensor)".
</p>
<p>
2) add letter 'V' for in 'Use' column for: 
standard_name, long_name, ancillary_variables, comment, history, institution, references, source
</p>

    </div>

              </div>
              <div class="change" id="trac-change-25-1345548260000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:25" class="cnum">
    <a href="#comment:25">comment:25</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-21T04%3A24%3A20-07%3A00&amp;precision=second" title="See timeline at 08/21/12 04:24:20">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-resolution">
      <strong class="trac-field-resolution">Resolution</strong>
        <em>worksforme</em> deleted
    </li><li class="trac-field-status">
      <strong class="trac-field-status">Status</strong>
        changed from <em>closed</em> to <em>reopened</em>
    </li>
  </ul>
    <div class="comment searchable">
      <p>
Well... I surely did not want to CLOSE the ticket... re-opening it.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-26-1345664028000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:26" class="cnum">
    <a href="#comment:26">comment:26</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:29" class="follow-up">↓ 29</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-22T12%3A33%3A48-07%3A00&amp;precision=second" title="See timeline at 08/22/12 12:33:48">9 years ago</a> by ngalbraith
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Thanks for not actually closing this - are you sure that wasn't just meant to bring the lurkers out of the woodwork? 
</p>
<p>
My concern with the example above is that existing data servers would blithely return the direction variable with no indication that there's a status variable associated with it. Finding that connection requires too many steps, since there's nothing about any of the components themselves to indicate that they're members of a vector variable.
</p>
<p>
If I were writing this NetCDF file, I'd add the status_flag as an ancillary variable to all the component variables. But really, shouldn't each component also have some sort of attribute to indicate that it's a member of the vector group, so that at some point servers can check for that relationship and provide the appropriate info to the user?
</p>

    </div>

              </div>
              <div class="change" id="trac-change-27-1345734913000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:27" class="cnum">
    <a href="#comment:27">comment:27</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:28" class="follow-up">↓ 28</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-23T08%3A15%3A13-07%3A00&amp;precision=second" title="See timeline at 08/23/12 08:15:13">9 years ago</a> by jonblower
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Quick suggestion - would it be a good idea to consider using "vector_components" instead of just "components"?
</p>
<p>
(The idea is that there are other possible types of components - for example, NetCDF-U could propose "uncertainty_components" to contain groups of statistics.)
</p>

    </div>

              </div>
              <div class="change" id="trac-change-28-1345798602000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:28" class="cnum">
    <a href="#comment:28">comment:28</a>
  </span>
        in reply to:
    <a href="#comment:27">↑ 27</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:31" class="follow-up">↓ 31</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-24T01%3A56%3A42-07%3A00&amp;precision=second" title="See timeline at 08/24/12 01:56:42">9 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:27" title="Comment 27">jonblower</a>:
</p>
<blockquote class="citation">
<p>
Quick suggestion - would it be a good idea to consider using "vector_components" instead of just "components"?
</p>
<p>
(The idea is that there are other possible types of components - for example, NetCDF-U could propose "uncertainty_components" to contain groups of statistics.)
</p>
</blockquote>
<p>
I like this idea, in that it makes the umbrella variable concept available to be applied to many cases, one of which is vectors.
</p>
<p>
It seems to me that this suggestion is to have an umbrella variable concept, with a specialisation for vectors.  
</p>
<p>
A vector umbrella variable would be identified by the presence of an attribute:
</p>
<blockquote>
<p>
vector_components  
</p>
</blockquote>

    </div>

              </div>
              <div class="change" id="trac-change-29-1345799222000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:29" class="cnum">
    <a href="#comment:29">comment:29</a>
  </span>
        in reply to:
    <a href="#comment:26">↑ 26</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:30" class="follow-up">↓ 30</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-24T02%3A07%3A02-07%3A00&amp;precision=second" title="See timeline at 08/24/12 02:07:02">9 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:26" title="Comment 26">ngalbraith</a>:
</p>
<blockquote class="citation">
<p>
Thanks for not actually closing this - are you sure that wasn't just meant to bring the lurkers out of the woodwork? 
</p>
<p>
My concern with the example above is that existing data servers would blithely return the direction variable with no indication that there's a status variable associated with it. Finding that connection requires too many steps, since there's nothing about any of the components themselves to indicate that they're members of a vector variable.
</p>
<p>
If I were writing this NetCDF file, I'd add the status_flag as an ancillary variable to all the component variables. But really, shouldn't each component also have some sort of attribute to indicate that it's a member of the vector group, so that at some point servers can check for that relationship and provide the appropriate info to the user?
</p>
</blockquote>
<p>
I am wary about this approach. I think that this two way relationship between umbrella variables and data variables is fragile and prone to inconsistency.
</p>
<p>
I fear that subsetting or aggregating NetCDF files would be made more complex by this.
</p>
<p>
It would also require careful checking, putting a further onus on the conformance checker, and raising risks for the many users who do not use the checker.
</p>
<p>
I think that a component should be defined as a data variable, exactly as CF currently does.
</p>
<p>
The responsibility for grouping should lie with the umbrella variable only.  Software will need to be CF umbrella variable aware, to ensure that the correct metadata annd relationships propagate.  This feels very manageable to me.
</p>
<p>
I think this one way aggregation is consistent with the CF approach to coordinates referenced by data variables and bounds referenced by coordiantes.  I am concerned that making the relationship two way will bring more issues than it addresses.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-30-1345799806000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:30" class="cnum">
    <a href="#comment:30">comment:30</a>
  </span>
        in reply to:
    <a href="#comment:29">↑ 29</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-24T02%3A16%3A46-07%3A00&amp;precision=second" title="See timeline at 08/24/12 02:16:46">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:29" title="Comment 29">markh</a>:
</p>
<blockquote class="citation">
<p>
Replying to <a class="ticket" href="./79#comment:26" title="Comment 26">ngalbraith</a>:
</p>
</blockquote>
<p>
I tend to agree with Mark here and would propose to keep a one-way relationship.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-31-1345799984000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:31" class="cnum">
    <a href="#comment:31">comment:31</a>
  </span>
        in reply to:
    <a href="#comment:28">↑ 28</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:32" class="follow-up">↓ 32</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-24T02%3A19%3A44-07%3A00&amp;precision=second" title="See timeline at 08/24/12 02:19:44">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:28" title="Comment 28">markh</a>:
</p>
<blockquote class="citation">
<p>
Replying to <a class="ticket" href="./79#comment:27" title="Comment 27">jonblower</a>:
</p>
<blockquote class="citation">
<p>
Quick suggestion - would it be a good idea to consider using "vector_components" instead of just "components"?
</p>
<p>
(The idea is that there are other possible types of components - for example, NetCDF-U could propose "uncertainty_components" to contain groups of statistics.)
</p>
</blockquote>
<p>
I like this idea, in that it makes the umbrella variable concept available to be applied to many cases, one of which is vectors.
</p>
<p>
It seems to me that this suggestion is to have an umbrella variable concept, with a specialisation for vectors.  
</p>
<p>
A vector umbrella variable would be identified by the presence of an attribute:
</p>
<blockquote>
<p>
vector_components  
</p>
</blockquote>
</blockquote>
<p>
I must say I like the idea as well. Let's leave that open for more comments/inputs but I am ready to take it on board.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-32-1345800957000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:32" class="cnum">
    <a href="#comment:32">comment:32</a>
  </span>
        in reply to:
    <a href="#comment:31">↑ 31</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-24T02%3A35%3A57-07%3A00&amp;precision=second" title="See timeline at 08/24/12 02:35:57">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:31" title="Comment 31">lavergne</a>:
</p>
<blockquote class="citation">
<p>
Replying to <a class="ticket" href="./79#comment:28" title="Comment 28">markh</a>:
</p>
<blockquote class="citation">
<p>
Replying to <a class="ticket" href="./79#comment:27" title="Comment 27">jonblower</a>:
</p>
<blockquote class="citation">
<p>
Quick suggestion - would it be a good idea to consider using "vector_components" instead of just "components"?
</p>
<p>
(The idea is that there are other possible types of components - for example, NetCDF-U could propose "uncertainty_components" to contain groups of statistics.)
</p>
</blockquote>
<p>
I like this idea, in that it makes the umbrella variable concept available to be applied to many cases, one of which is vectors.
</p>
</blockquote>
</blockquote>
<p>
Well... I now remember Jonathan's point that this ticket could solve both vectors AND tensors... should we allow both tensor_components and vector_components? Are they just aliases? Or should a compliance checker send a warning if a vector uses <em>tensor_component</em>? 
</p>
<p>
Is human readability worth the extra burden?
</p>

    </div>

              </div>
              <div class="change" id="trac-change-33-1345812016000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:33" class="cnum">
    <a href="#comment:33">comment:33</a>
  </span>
        in reply to:
    <a href="#comment:24">↑ 24</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:35" class="follow-up">↓ 35</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-24T05%3A40%3A16-07%3A00&amp;precision=second" title="See timeline at 08/24/12 05:40:16">9 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:24" title="Comment 24">lavergne</a>:
</p>
<blockquote class="citation">
<p>
<strong>Proposed implementation of <a class="reopened ticket" href="./79.html" title="enhancement: Handling and formatting of vector quantities in CF (reopened)">#79</a> in CF document:</strong>
</p>
</blockquote>
<p>
I feel this proposal does not provide enough information to make the vector really useful to downstream software.
</p>
<p>
As previously stated, I would like to see:
</p>
<ul><li>explicit dimensionality of the vector
</li><li>identification of the individual components:
<ul><li>x-component, magnitude etc
</li></ul></li></ul><p>
as part of the vector variable attributes.  The list of component variables:
</p>
<blockquote>
<p>
drift_vector:components = "dX dY dir" ;
</p>
</blockquote>
<p>
does not provide sufficient information.
</p>
<p>
I do not think it is adequate to try and use standard_name to infer such information as:
</p>
<ul><li>standard_name is an optional field
</li><li>cross referencing and parsing standard names and aspects of their description is at best fragile, but I would suggest unworkable.
</li></ul>
    </div>

              </div>
              <div class="change" id="trac-change-34-1345847763000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:34" class="cnum">
    <a href="#comment:34">comment:34</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-24T15%3A36%3A03-07%3A00&amp;precision=second" title="See timeline at 08/24/12 15:36:03">9 years ago</a> by mcginnis
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Still reading through the comments, but I would just like to drop a quick comment
in favor of using just "components" regardless of what kind of bundle we're putting under the umbrella.  I can think of plenty of use cases where it would be nice to be able to treat something as a vector (or tensor, or whatever) even though it's not, and having to check for a bunch of different attribute names ending in "_components" would impede that.  Contrariwise, I'm having trouble coming up with a case where having different names for the component list is a big win.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-35-1345851286000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:35" class="cnum">
    <a href="#comment:35">comment:35</a>
  </span>
        in reply to:
    <a href="#comment:33">↑ 33</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-24T16%3A34%3A46-07%3A00&amp;precision=second" title="See timeline at 08/24/12 16:34:46">9 years ago</a> by mcginnis
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:33" title="Comment 33">markh</a>:
</p>
<blockquote class="citation">
<p>
Replying to <a class="ticket" href="./79#comment:24" title="Comment 24">lavergne</a>:
</p>
<blockquote class="citation">
<p>
<strong>Proposed implementation of <a class="reopened ticket" href="./79.html" title="enhancement: Handling and formatting of vector quantities in CF (reopened)">#79</a> in CF document:</strong>
</p>
</blockquote>
<p>
As previously stated, I would like to see:
</p>
<ul><li>explicit dimensionality of the vector
</li><li>identification of the individual components:
<ul><li>x-component, magnitude etc
</li></ul></li></ul><p>
as part of the vector variable attributes.  The list of component variables:
</p>
<blockquote>
<p>
drift_vector:components = "dX dY dir" ;
</p>
</blockquote>
<p>
does not provide sufficient information.
</p>
</blockquote>
<p>
I really like the idea of having umbrella variables to bundle together and define the relationships between different data variables, not just for vector components, so with that end in mind, I'd like to propose a framework that provides a solution to the Mark's need (which I agree with) to identify the components.
</p>
<p>
We can go from generic umbrella to specialized vector by adding a <tt>type</tt> attribute.  (Or maybe <tt>group_type</tt>, if <tt>type</tt> is confusing.)  The value of <tt>type</tt> not only tells you what you're dealing with, it also determines a list of other attributes to identify the components.  This is the same approach used for map projection metadata with the <tt>grid_mapping_name</tt> attribute.  It's easy to extend, so to add tensors, you just propose a new value for <tt>type</tt> and names for the tensor components.
</p>
<p>
For the two-dimensional vector case, as used in the example, we would have <tt>type="2d_vector"</tt>, and it would have two to four of the attributes <tt>x_component</tt>, <tt>y_component</tt>, <tt>magnitude</tt> and <tt>direction</tt> defined, each of which names another variable.  By declaring a list of dependent attributes, we then also have an appropriate place to discuss their meanings and to declare restrictions, like that if you only define two components, they must be the pair x and y or the pair magnitude and direction.
</p>
<p>
Rather than explicitly declaring dimensionality, I think it's better to define types with a specific dimensionality (i.e., 2-vectors and 3-vectors) because then we can choose the most sensible names for the components.  For example, the community might prefer to use "direction" for 2-vectors, but "azimuth" for 3-vectors.
</p>
<p>
Randy can then propose a new "viewfield" umbrella type for space weather products, and the NetCDF-U folks can propose a bunch of umbrella types for different statistical distributions, and all the umbrella types will have consistent forms, and they'll all have sensible names for their purpose.  In the meantime, for the purposes of this proposal, all we need to do is hash out the name of the type for 2-D vectors and the names and definitions of the dependent attributes.
</p>
<p>
So here's what the example would look like using this approach:
</p>
<pre class="wiki">char ice_drift_vector;
 drift_vector:standard_name = "sea_ice_displacement_vector" ;
 drift_vector:long_name = "sea ice drift vector" ;
 drift_vector:components = "dX dY dir" ;
 drift_vector:type = "2d_vector"
 drift_vector:x_component = "dX"
 drift_vector:y_component = "dY"
 drift_vector:direction = "dir"
 drift_vector:ancillary_variables = "status_flag" ;
</pre><p>
If this seems like a good solution, I'd suggest defining just the overall umbrella form and the specific details for 2-D vectors in this proposal, and splitting off 3-D vectors into a new proposal, since I think naming may be more complicated in that case.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-36-1346141212000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:36" class="cnum">
    <a href="#comment:36">comment:36</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-08-28T01%3A06%3A52-07%3A00&amp;precision=second" title="See timeline at 08/28/12 01:06:52">9 years ago</a> by bnl
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Just skimmed through the comments on this ...
</p>
<p>
I believe the last proposal introduced the concept of generic umbrella variables, and two levels of controlled vocabularies, specific umbrella variables, and then a further controlled vocabulary for what the relationship is between the variables under that specific umbrella.
</p>
<p>
(e.g. type="2d_vector" is a first level controlled term, and "x_component", "y_component" and "direction" are second level controlled ... )
</p>
<p>
(Whether these are the right terms is not my worry at the moment ... it's whether this is the right approach, and it feels right to me.)
</p>
<p>
So, I rather like this, since one of my reservations reading through was that without some specific guidance, one wouldn't really be guaranteed unambiguity when trying to sort out which variables were (say) direction, magnitude, and which were dx,dy (oh, I can see that for some cases one could do it via inspection but it all gets quite torturous).
</p>
<p>
We can then proceed with our usual method of handling only the cases for which we have specific use now, with the knowledge that we have have a mechanism for dealing with a wide range of future uses.
</p>
<p>
I appreciate that there is room for redundancy in metadata with this approach, but why on earth is that a problem, if it's possible to work out it's redundant, and it's contradictory, isn't that a good thing to know? If it's not possible to work out it's redundant easily, then perhaps it's helping avoid software errors?
</p>
<p>
(p.s. I vote for one-way too!)
</p>

    </div>

              </div>
              <div class="change" id="trac-change-37-1346773220000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:37" class="cnum">
    <a href="#comment:37">comment:37</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-04T08%3A40%3A20-07%3A00&amp;precision=second" title="See timeline at 09/04/12 08:40:20">9 years ago</a> by jonblower
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
I like these recent proposals and am happy with plain "components" supported by other attributes.
</p>
<p>
What becomes of "ancillary_variables"?  If we define "umbrella variables" we will also need to define better the use of existing "ancillary_variables" construct, as this is being used in existing data for a similar purpose.  The rule could be something like:
</p>
<ol><li>Use umbrella variables when there is a logical "contains" relationship (e.g. vector components, groups of related statistics).
</li><li>Use ancillary_variables when a variable is associated with another but is not "contained" by it (e.g. a quality flag).
</li></ol><p>
Thoughts?
</p>

    </div>

              </div>
              <div class="change" id="trac-change-38-1347223237000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:38" class="cnum">
    <a href="#comment:38">comment:38</a>
  </span>
          <span>follow-ups:</span>
    <a href="#comment:39" class="follow-up">↓ 39</a>
    <a href="#comment:43" class="follow-up">↓ 43</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-09T13%3A40%3A37-07%3A00&amp;precision=second" title="See timeline at 09/09/12 13:40:37">9 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear all
</p>
<p>
I like Thomas's proposal as he wrote it out on 21st August. I agree with the preference others have expressed for the one-way relationship; the data variables stand alone, and the umbrella is a new layer which points to them, but not the other way.
</p>
<p>
Mark commented that it wouldn't be adequate to rely on the standard_names of the component data variables to identify their roles in the group, because "the standard_name is an optional field, and cross-referencing and parsing standard names and aspects of their description is at best fragile." I'd suggest that the first of these is quite easy to deal with: we could make it <em>mandatory</em> for a data variable to have a standard_name if any umbrella variable points to it. This would be easy for the CF checker to verify.
</p>
<p>
The second point is more difficult. Seth has suggested the alternative of including more attributes in the umbrella variable, as well as the component list, in order to identify the roles of the components. This method would be using the umbrella variable to get round the fact of the standard_name being difficult to analyse, as Mark is right to say. But although it's hard to analyse, it is surely the case that eastward_wind is necessarily the x_component of a wind vector, isn't it. Hence Seth's and Mark's suggestion of identifying the role e.g x_component through an attribute name would be duplicating information which is already implicit in the standard_name.
</p>
<p>
Another alternative to meet this need would be to make it explicit in the <em>definition</em> of a standard_name if it could serve as a component in a vector and if so which component. Thomas's proposal already implies introducing new standard_names which may only be used for umbrella variables. That means we have to modify the format of the standard_name table in some way. The definition of each of these new standard_names could list the standard_names which are permissible for components of the group. At the same time, we could add to the definition of those standard_names the role that they would play in the group. So, for instance, the new standard_name for sea_ice_displacement_vector will identify itself as a vector/tensor standard_name, and it could list sea_ice_x_displacement and sea_ice_y_displacement among its permissible components. In addition, we would add to the definition of sea_ice_x_displacement that it is the x_component of a vector.
</p>
<p>
If the standard_name is mandatory for components of names by umbrella variables, and if the standard_name table is modified to say which components they are, I think Mark's need would be met with just the list of components in the component attribute, wouldn't it? The CDL would be as in Thomas's proposal, and there would not be any redundant metadata. The redundancy would be contained in the standard_name table itself, which would say explicitly that sea_ice_x_displacement is an x_component. Even though that is obvious to humans on inspection, it's not obvious to programs, so this redundancy is useful. It should be easy to keep under control, because it's all in one place within the definition of the standard_name, so unlikely to become inconsistent.
</p>
<p>
I support Seth's suggestion of a group_type attribute for the umbrella variable, to allow umbrellas to be used for other purposes in future. I'd suggest that the value of the group_type should appear in the definition of the group standard_name. If it is necessary to distinguish vectors and tensors of different dimensionality, that would mean we'd need different standard_names of e.g. wind_horizontal_vector and wind_3d_vector with different group_types of horizontal_vector and 3d_vector; eastward_wind is a possible component of both of these, but upward_air_velocity is not allowed for wind_horizontal_vector.
</p>
<p>
Partly answering Jon's and Nan's points: One of the advantages of umbrella variables is that they can have ancillaries that apply to <em>all</em> components at once. A new mechanism for this is needed because the ancillaries for individual components would require different standard_names e.g. "sea_ice_x_displacement status_flag" and "sea_ice_y_displacement status_flag". Therefore they'd have to be different variables, even if they had exactly the same contents! Ancillaries and umbrellas don't have the same purpose.
</p>
<p>
Thomas, I don't think it's necessary to include a description of grid-staggering e.g. Arakawa. That is extra information which could be added if people wanted it to be. In your proposal you write, "Note that all the data variables listed in components shall have the same set of dimensions." I think that should be clarified: "same" means "having the same standard_names". For instance, the components may each have a longitude and a latitude axis, but if they're on an Arakawa C-grid the dimensions and coordinates of the axes will be different for the two components. Would you agree with that?
</p>
<p>
Cheers
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-39-1347259865000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:39" class="cnum">
    <a href="#comment:39">comment:39</a>
  </span>
        in reply to:
    <a href="#comment:38">↑ 38</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-09T23%3A51%3A05-07%3A00&amp;precision=second" title="See timeline at 09/09/12 23:51:05">9 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Jonathan,
</p>
<p>
Replying to <a class="ticket" href="./79#comment:38" title="Comment 38">jonathan</a>:
</p>
<blockquote class="citation">
<p>
I like Thomas's proposal as he wrote it out on 21st August. I agree with the preference others have expressed for the one-way relationship; the data variables stand alone, and the umbrella is a new layer which points to them, but not the other way.
</p>
</blockquote>
<p>
Thanks for supporting the August 21st proposal. As you got from the comments, I was advocating for the simplest and most self-contained changeset, although I must agree that adding more attributes (Seth, Mark) is very appealing for a human reader/user. I still think a machine would be fine with the plain list of components and mandatory standard_name for the components variables.
</p>
<p>
I did not exactly get if you see the "group_type" information (as introduced by Seth) as an attribute to the umbrella variable (in addition to "components") of if you'd rather have the information explicit from the standard_name table.
</p>
<p>
Since this proposal is not about _any_ umbrella variable, I would implement your restrictions on standard_name as: "all variables appearing as components of a vector variable should have a standard_name", in the text of the new section.
</p>
<blockquote class="citation">
<p>
Thomas, I don't think it's necessary to include a description of grid-staggering e.g. Arakawa. That is extra information which could be added if people wanted it to be. In your proposal you write, "Note that all the data variables listed in components shall have the same set of dimensions." I think that should be clarified: "same" means "having the same standard_names". For instance, the components may each have a longitude and a latitude axis, but if they're on an Arakawa C-grid the dimensions and coordinates of the axes will be different for the two components. Would you agree with that?
</p>
</blockquote>
<p>
Yes,  I agree. The reason why I dropped reference to the "standard_name" for dimensions is embarrassingly enough because I was not up to date with the 'latitude' or 'grid_latitude' standard names. My files do not use them and this is why I did not think of them as appropriate in this case. Now that I am updated, I'll implement this in my files, and in the next version of the vector proposal.
</p>
<p>
Concerning <a class="reopened ticket" href="./79.html" title="enhancement: Handling and formatting of vector quantities in CF (reopened)">#79</a>, I propose we wait until the end of this week for concluding before I submit an updated proposal, based on the one from August 21st.
</p>
<p>
How/when in practise do you see the implementation of the change in the standard name table? Do we have to prepare something now, upfront of acceptance of this ticket, or do we take this when - <a class="reopened ticket" href="./79.html" title="enhancement: Handling and formatting of vector quantities in CF (reopened)">#79</a> being agreed upon - I ask for a first vector standard name (probably sea_ice_displacement_vector)?
</p>
<p>
Cheers Thomas
</p>

    </div>

              </div>
              <div class="change" id="trac-change-40-1347347757000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:40" class="cnum">
    <a href="#comment:40">comment:40</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:41" class="follow-up">↓ 41</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-11T00%3A15%3A57-07%3A00&amp;precision=second" title="See timeline at 09/11/12 00:15:57">9 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Thomas
</p>
<p>
Thanks for your point about <tt>group_type</tt>. Seth proposed this as an attribute of the umbrella variable. However, your point implies that this might not be necessary. If you and others agreed with the idea of putting vector/tensor and component tags into the standard_name table itself, it would be possible to deduce from the standard_name of the umbrella e.g. sea_ice_displacement, that it is a vector, by looking it up in the standard_name table. That would be using the standard_name table as a dictionary, which is coincidentally related to the thread which Martin Schultz has started on the email list. What do you and others think about this, I wonder?
</p>
<p>
How should we distinguish 2D and 3D vectors umbrellas? I wonder whether this distinction might be more convenient to make on the umbrella itself, so that we didn't have to have separate standard_names for 2D and 3D vectors.
</p>
<p>
I think that the proposal should specify the changes in principle to be made to the standard_name table, since the table is described by the conventions document, but the new contents of the table can be left out of this trac ticket, and proposed on the email list once the new format of the table has been agreed.
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-41-1347352592000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:41" class="cnum">
    <a href="#comment:41">comment:41</a>
  </span>
        in reply to:
    <a href="#comment:40">↑ 40</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:42" class="follow-up">↓ 42</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-11T01%3A36%3A32-07%3A00&amp;precision=second" title="See timeline at 09/11/12 01:36:32">9 years ago</a> by jonblower
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:40" title="Comment 40">jonathan</a>:
</p>
<p>
Personally I would prefer to have an explicit group_type attribute (or similar) on the umbrella variable, so it is easier for a software tool to deduce the type of the umbrella.  If this information is encoded in the standard_name it makes it much harder for software to make this inference, since it would not only need access to the standard name table but also the rules for constructing standard names.
</p>
<p>
A second reason is that umbrellas might be used for other purposes (for example, grouping uncertainty information) and it doesn't seem sensible to encode this in the standard_name, since you can have uncertainty information about anything at all.  But it would be very easy with an appropriate group_type attribute.
</p>
<p>
(Of course, the values of the group_type attribute must be selected from a controlled vocabulary of its own.)
</p>

    </div>

              </div>
              <div class="change" id="trac-change-42-1347399539000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:42" class="cnum">
    <a href="#comment:42">comment:42</a>
  </span>
        in reply to:
    <a href="#comment:41">↑ 41</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-11T14%3A38%3A59-07%3A00&amp;precision=second" title="See timeline at 09/11/12 14:38:59">9 years ago</a> by mcginnis
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:41" title="Comment 41">jonblower</a>:
</p>
<blockquote class="citation">
<p>
Replying to <a class="ticket" href="./79#comment:40" title="Comment 40">jonathan</a>:
</p>
</blockquote>
<p>
I'm opposed to the idea of putting vector component tags into the standard_name table.
</p>
<p>
I think Jon Blower's points are very god, and I have to agree with him. Checking the value of an attribute with a known name is easy; downloading and parsing the standard_name table is hard (maybe even effectively impossible, depending on the environment you're working in).  It also spreads the logic of the umbrella types out across different locations, making it easier for inconsistencies to sneak in and cluttering up the standard_name table.
</p>
<p>
Plus, it seems more in the spirit of CF to record structural information explicitly in the file itself, rather than implicitly in the spec.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-43-1347557592000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:43" class="cnum">
    <a href="#comment:43">comment:43</a>
  </span>
        in reply to:
    <a href="#comment:38">↑ 38</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-13T10%3A33%3A12-07%3A00&amp;precision=second" title="See timeline at 09/13/12 10:33:12">9 years ago</a> by ngalbraith
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:38" title="Comment 38">jonathan</a>:
</p>
<blockquote class="citation">
<p>
Partly answering Jon's and Nan's points: One of the advantages of umbrella variables is that they can have ancillaries that apply to <em>all</em> components at once. A new mechanism for this is needed because the ancillaries for individual components would require different standard_names e.g. "sea_ice_x_displacement status_flag" and "sea_ice_y_displacement status_flag". Therefore they'd have to be different variables, even if they had exactly the same contents! Ancillaries and umbrellas don't have the same purpose.
</p>
</blockquote>
<p>
By having the status flag, or other ancillary data, connected ONLY to the umbrella variable, you are making it much more difficult to find these important ancillary variables. It makes much more sense to me to allow both sea_ice_x_displacement and sea_ice_y_displacement to share an ancillary variable named "status_flag".  I realize that this is being discussed on ticket 74 too, but not in the context of vectors.
</p>
<p>
 
If you are moving the 'ancillary variable' attribute to the vector, and not attaching things like flag values directly to the data variable, it seems to me that you really should provide some indication on the member data variables to state that they are part of the vector, so the user can at least suspect that ancillary variables might be found there.
</p>
<p>
If, for example, I'm reading the wind speed data from a file, the only way I can find the ancillary variables is by inspecting every umbrella variable to see if wind speed is a member.  This seems completely counter-productive to me -  am I missing something?
</p>
<blockquote class="citation">
<p>
Mark commented that it wouldn't be adequate to rely on the standard_names of the component data variables to identify their roles in the group, because "the standard_name is an optional field, and cross-referencing and parsing standard names and aspects of their description is at best fragile." I'd suggest that the first of these is quite easy to deal with: we could make it <em>mandatory</em> for a data variable to have a standard_name if any umbrella variable points to it. This would be easy for the CF checker to verify.
</p>
</blockquote>
<p>
A mandatory standard name for any member of a vector group would be a problem for working files that contain, for example, variously treated directional components (rotated or not, height-adjusted or not, or something like wind relative to currents vs observed wind). We normally distinguish these by using a standard name for the variable that most correctly represents the concept as described by the standard name, and leaving off any standard name for "working versions" of the variable.
</p>
<p>
As far as I know, it's possible to have a CF-compliant file that includes some variables that have no standard name; this restriction (requiring a standard name for any variable that's part of a vector group) would make the vector concept less useful to some of us.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-44-1347966789000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:44" class="cnum">
    <a href="#comment:44">comment:44</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-18T04%3A13%3A09-07%3A00&amp;precision=second" title="See timeline at 09/18/12 04:13:09">9 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear all
</p>
<p>
Nan's first point is an argument against one of the motivations for this proposal, which is to provide a way for group of variables to share ancillary variables. She argues that they are found more easily if they are attached to the component variables. This problem could be got round by requiring the component variable to have a link to a particular ancillary variable if the umbrella variable does. The CF checker could verify that, but it makes me uncomfortable because it's redundant. Pointing both ways component&lt;&gt;umbrella is also redundant.
</p>
<p>
I wonder how important this motivation is for the proposal, compared with the more general motivation of providing a way to group components? In fact components can only share ancillary variables when they are on the same grid,which is not always the case (especially in models).
</p>
<p>
I take the point that it would be harder work to look at the standard name table to find out the role of a component. I guess we could provide software with APIs in many languages for parsing the standard name table, and perhaps we should do that anyway, but that's another story.
</p>
<p>
Going back to Seth's idea, then (and omitting the ancillary variables, which may be a different issue)
</p>
<pre class="wiki">
char ice_drift_vector;
 drift_vector:standard_name = "sea_ice_displacement_vector" ;
 drift_vector:long_name = "sea ice drift vector" ;
 drift_vector:components = "dX dY dir" ;
 drift_vector:type = "2d_vector";
 drift_vector:x_component = "dX";
 drift_vector:y_component = "dY";
 drift_vector:direction = "dir";

</pre><p>
I think it would be nicer if the components were not mentioned twice (once in the <tt>components</tt> atribute, and once in the attributes indicating roles). If we see this like the grid_mapping variables, then the type of umbrella implies which component attributes it can have. Is there a need then to list them all together as well? Nan's posting suggests that she might want to include "unofficial" components in the umbrella as well - ones which don't even have standard names, and several varieties of each. Generic software could not be expected to know what to do with all these. Maybe this could be addressed by providing an attribute which could list all the components of the vector which do not have a standardised purpose. Generic software would ignore these, but Nan's software would make use of them.
</p>
<p>
I also tend to think that the umbrella variable is becoming so different from a data variable that it should not have a <tt>standard_name</tt>. It is a new kind of construct. What do you think of this:
</p>
<pre class="wiki">
char ice_drift_vector;
 drift_vector:umbrella_name = "sea_ice_displacement_vector" ;
 drift_vector:long_name = "sea ice drift vector" ;
 drift_vector:type = "2d_vector";// see below
 drift_vector:x_component = "dX";
 drift_vector:y_component = "dY";
 drift_vector:direction = "dir";
 drift_vector:other="dX_rotated dY_rotated";

</pre><p>
where the <tt>other</tt> attribute is a blank-separated list of data variables which are non-standardised components. If we do something like this, we should have a new Appendix in the standard document, which lists for each umbrella type which components it is allowed to have (like the <tt>grid_mapping</tt> appendix F), and we should have another table which lists the legal values for the <tt>umbrella_name</tt> attribute. Should this table also specify the <tt>type</tt> of the umbrella variable? That would be redundant with the attribute, but they could be checked for consistency, in the way that the CF checker verifies that the units of a data variable are consistent with the canonical units for its <tt>standard_name</tt>.
</p>
<p>
Cheers
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-45-1347986559000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:45" class="cnum">
    <a href="#comment:45">comment:45</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:46" class="follow-up">↓ 46</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-18T09%3A42%3A39-07%3A00&amp;precision=second" title="See timeline at 09/18/12 09:42:39">9 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
I would like to echo 
</p>
<blockquote>
<p>
<a class="ticket" href="./79#comment:41" title="Comment 41">jonblower</a>:
</p>
</blockquote>
<blockquote>
<p>
<a class="ticket" href="./79#comment:42" title="Comment 42">mcginnis</a>:
</p>
</blockquote>
<p>
I would much prefer to have explicit components defined, and not have to cross reference a standard name.
</p>
<p>
Replying to <a class="ticket" href="./79#comment:38" title="Comment 38">jonathan</a>:
</p>
<blockquote class="citation">
<p>
Mark commented that it wouldn't be adequate to rely on the standard_names of the component data variables to identify their roles in the group, because "the standard_name is an optional field, and cross-referencing and parsing standard names and aspects of their description is at best fragile." I'd suggest that the first of these is quite easy to deal with: we could make it <em>mandatory</em> for a data variable to have a standard_name if any umbrella variable points to it. This would be easy for the CF checker to verify.
</p>
</blockquote>
<p>
I don't like the approach of a mandatory standard name: 
</p>
<ul><li>I feel that it is important to keep the flexibility not to have a standard_name for a variable, particularly in the cases where one does not exist:
</li><li>vector quantities may be derived from scalar fields, in general, so the potential for a vast array of different vector components exists:
<ul><li>valid standard names cannot be generated on the fly, so this would make most such derivations banned by CF, rather than just lacking a standard name for a component; 
</li></ul></li><li>a relational requirement would be introduced on data variables because they are referenced, which goes against the 'one way' relationship idea.
</li></ul><blockquote class="citation">
<p>
The second point is more difficult. ...
</p>
</blockquote>
<p>
I think the issue is that software should not have to analyse the standard_name of a component to make correct use of it within an umbrella context.  The fact that this is also hard compounds the issue, but even if it were easier I would counsel against it.
</p>
<p>
A vector quantity should identify it's components explicitly, so that any downstream user (human or machine) correctly interprets the interrelations between the component data variables.
</p>
<p>
I think standard names are already heavily loaded with capabilities, adding another one feels unwise to me.
</p>
<p>
I would instead put forward the perspective that by correctly defining an umbrella variable, with explicit components, the standard names for each component become secondary, and can be left off without losing information.  In many cases, the reason for having component standard names is to ensure that they can be used independently of the umbrella, for example, extracted singly from a file. Such duplication can be useful and should not be disallowed, but it is secondary to the umbrella definition of the vector.
</p>
<p>
In summary, I don't think this approach adequately meets our requirements for vector processing; I prefer the definition as exemplified in <a class="ticket" href="./79#comment:44" title="Comment 44">jonathan</a> .
</p>
<p>
Replying to <a class="ticket" href="./79#comment:44" title="Comment 44">jonathan</a>:
</p>
<blockquote class="citation">
<p>
I think it would be nicer if the components were not mentioned twice (once in the <tt>components</tt> atribute, and once in the attributes indicating roles).
</p>
</blockquote>
<p>
This makes sense to me, I think only the explicit attributes, such as x_component are required.
</p>
<blockquote class="citation">
<p>
I also tend to think that the umbrella variable is becoming so different from a data variable that it should not have a <tt>standard_name</tt>. It is a new kind of construct.
</p>
</blockquote>
<p>
I'm not sure about this, the standard_name vocabulary could be extended to include vectors, once we know how to represent them.  However standard names are currently only defining scalar quantities, I think. A new vocabulary would require management, could this become part of the remit of the standard name maintenance, even if they are not standard names?  I don't know how to call this one.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-46-1348068831000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:46" class="cnum">
    <a href="#comment:46">comment:46</a>
  </span>
        in reply to:
    <a href="#comment:45">↑ 45</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:51" class="follow-up">↓ 51</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-19T08%3A33%3A51-07%3A00&amp;precision=second" title="See timeline at 09/19/12 08:33:51">9 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Mark
</p>
<p>
I'm glad you are generally happy with <a class="ticket" href="./79#comment:44" title="Comment 44">this</a>.
</p>
<p>
I don't think we should see the invention of umbrellas as a reason for standard names to be left out. The proposal was to add an extra layer of information, not to make the existing data variable less self-describing. However I appreciate, as Nan also advocated, that you might want to include variables under the umbrella for quantities which do not have standard_names. So I'd like to propose a reduced requirement, that any data variable must have a <tt>standard_name</tt> if it is pointed to by an attribute of the umbrella apart from <tt>other</tt> (in my example) i.e. any of the attributes that are part of the definition of the umbrella type, such as <tt>x_component</tt>. This doesn't rule out including other variables, and it doesn't seem too much to expect. It would be reasonable, when a new umbrella name (or standard name for an umbrella) is introduced e.g. "wind", that we also make sure there are standard names for all the components it might have, in the expectation that they will be needed. What do you think?
</p>
<p>
The reason for suggesting that umbrella names should go in a new table is because umbrella variables are now quite different from data variables. They have a whole different set of new attributes, rather than (as originally proposed) a subset of the possible attributes of data variables (and one new one). But certainly this list of names could be maintained by the same "vocabulary" process as standard names, just like the lists for region names and area type names.
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-47-1348069646000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:47" class="cnum">
    <a href="#comment:47">comment:47</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-19T08%3A47%3A26-07%3A00&amp;precision=second" title="See timeline at 09/19/12 08:47:26">9 years ago</a> by jonblower
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Jonathan, all,
</p>
<blockquote class="citation">
<p>
It would be reasonable, when a new umbrella name (or standard name for an umbrella) is introduced e.g. "wind", that we also make sure there are standard names for all the components it might have, in the expectation that they will be needed. What do you think?
</p>
</blockquote>
<p>
I think this may work practically for vectors (they only have 2 or 3 components, and not all standard_names are inherently vector quantities) but won't be very practical for other types of grouping.
</p>
<p>
Apologies for going on about uncertainty again, but I think umbrellas could be a very good way of grouping statistics about a phenomenon or parameters of a probability density function (cf. UncertML).  If we followed your suggestion above (and if I've understood it!), we would need new standard names for every statistic of every measurable quantity (mean_of, standard_deviation_of, variance_of, kurtosis_of, etc.)
</p>
<p>
I'm not sure of the solution to this.  I thought that cell_methods may be an answer, but cell_methods seems to address a different problem (statistics over a cell, rather than statistics over a set of measurements).  What do you think?
</p>
<p>
Jon
</p>

    </div>

              </div>
              <div class="change" id="trac-change-48-1348071824000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:48" class="cnum">
    <a href="#comment:48">comment:48</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:52" class="follow-up">↓ 52</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-19T09%3A23%3A44-07%3A00&amp;precision=second" title="See timeline at 09/19/12 09:23:44">9 years ago</a> by pbentley
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Based on an admittedly cursory reading of this ticket it would seem that at least some of the functionality that is being proposed here (e.g. defining containers for variables) could be provided by features within the enhanced netCDF-4 data model. I'm thinking specifically of groups and user-defined data types. Have these been considered as a practicable solution to the original user requirement? It would seem a shame to devise an entirely new set of data structures and rules if the existing netCDF-4 features can do the job (though I suspect that some extra rules/semantics would still be required even in the case of netCDF-4).
</p>
<p>
Phil
</p>

    </div>

              </div>
              <div class="change" id="trac-change-49-1348072185000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:49" class="cnum">
    <a href="#comment:49">comment:49</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-19T09%3A29%3A45-07%3A00&amp;precision=second" title="See timeline at 09/19/12 09:29:45">9 years ago</a> by jonblower
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Phil - I had also wondered this and I guess it's the ideal solution in some ways, but I wonder if this is too big a leap for a lot of CF users.  I guess it's a chicken-and-egg thing, but I suppose we need to have the "big conversation" about NetCDF-4 at some point!
</p>
<p>
Jon
</p>

    </div>

              </div>
              <div class="change" id="trac-change-50-1348076055000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:50" class="cnum">
    <a href="#comment:50">comment:50</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-19T10%3A34%3A15-07%3A00&amp;precision=second" title="See timeline at 09/19/12 10:34:15">9 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Jon
</p>
<p>
Uncertainty measures like mean, standard_deviation, etc. are described in CF by <tt>cell_methods</tt>, not standard names. The fields which the umbrella points to should use <tt>cell_methods</tt> to distinguish these statistics. However, I agree that you might want to have such statistics for a quantity which does not itself have a standard_name. Although it's right to have an eye to future generalisation, could we for the moment discuss umbrella variables for the purpose originally proposed for vectors and tensors? I'd happily agree that my proposed requirement for standard names for components with an identified role only applies to the vectors and tensors, not to all kinds of umbrella that might be proposed (but haven't yet been proposed specifically).
</p>
<p>
Cheers
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-51-1348223688000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:51" class="cnum">
    <a href="#comment:51">comment:51</a>
  </span>
        in reply to:
    <a href="#comment:46">↑ 46</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:54" class="follow-up">↓ 54</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-21T03%3A34%3A48-07%3A00&amp;precision=second" title="See timeline at 09/21/12 03:34:48">9 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:46" title="Comment 46">jonathan</a>:
</p>
<blockquote class="citation">
<p>
Dear Mark
</p>
<p>
I'm glad you are generally happy with <a class="ticket" href="./79#comment:44" title="Comment 44">this</a>.
</p>
<p>
I'd like to propose a reduced requirement, that any data variable must have a <tt>standard_name</tt> if it is pointed to by an attribute of the umbrella apart from <tt>other</tt> (in my example) i.e. any of the attributes that are part of the definition of the umbrella type, such as <tt>x_component</tt>. This doesn't rule out including other variables, and it doesn't seem too much to expect. It would be reasonable, when a new umbrella name (or standard name for an umbrella) is introduced e.g. "wind", that we also make sure there are standard names for all the components it might have, in the expectation that they will be needed. What do you think?
</p>
</blockquote>
<p>
I'm afraid I do not see the value for this and I think there are costs which I do not like.  I think that a particular merit of this proposal is that all vector components are CF data variables in their own right.  The umbrella is merely a useful way of aggregating already well defined CF constructs.
</p>
<p>
As such, any constraints on these data variables, such as mandating a standard name, seems unwise to me.  It implies that a data variable needs to know if it is referenced by an umbrella variable in order to check it's validity.  I would suggest this is unhelpful.
</p>
<p>
I think the simple approach of 'all components are CF data variables', with all the freedoms and constraints currently in place, offers the best solution.
</p>
<p>
The responsibility for the aggregation lies solely with the aggregator: the vector variable.  This responsibility includes how a particular component is interpreted.
</p>
<p>
With this in mind, I propose a change of terminology for component labels, to use i,j,k rather than x,y,z:
</p>
<ul><li><del>x_component</del>   i_component
</li><li><del>y_component</del>   j_component
</li><li><del>z_component</del>   k_component
</li><li><del>x_x_direction</del>   i_j_direction
</li><li><del>z_direction</del>   k_direction
</li></ul><p>
This explicitly differentiates the basis vectors for the vector quantity from the standard names of the components.
</p>
<p>
This would enable the definition of an arbitrary 2D vector (with no standard name) where, e.g.:
</p>
<blockquote>
<p>
i_component =&gt; a y_wind component
</p>
</blockquote>
<blockquote>
<p>
j_component =&gt; an upward_air_velocity component
</p>
</blockquote>
<p>
and another arbitrary 2D vector  (with no standard name) where, e.g.:
</p>
<blockquote>
<p>
i_component =&gt; a data variable (with no standard name but a long name and unit)
</p>
</blockquote>
<blockquote>
<p>
j_component =&gt; another data variable (with no standard name but a long name and unit)
</p>
</blockquote>
<p>
Perhaps this distinction makes the different roles of standard name and vector component identification.
</p>
<blockquote class="citation">
<p>
The reason for suggesting that umbrella names should go in a new table is because umbrella variables are now quite different from data variables. They have a whole different set of new attributes, rather than (as originally proposed) a subset of the possible attributes of data variables (and one new one). But certainly this list of names could be maintained by the same "vocabulary" process as standard names, just like the lists for region names and area type names.
</p>
</blockquote>
<p>
I think I understand the logic, and I can see an appeal.  As long as there is an agreed maintenance approach, I think this is workable.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-52-1348224143000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:52" class="cnum">
    <a href="#comment:52">comment:52</a>
  </span>
        in reply to:
    <a href="#comment:48">↑ 48</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-21T03%3A42%3A23-07%3A00&amp;precision=second" title="See timeline at 09/21/12 03:42:23">9 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:48" title="Comment 48">pbentley</a>:
</p>
<blockquote class="citation">
<p>
Based on an admittedly cursory reading of this ticket it would seem that at least some of the functionality that is being proposed here (e.g. defining containers for variables) could be provided by features within the enhanced netCDF-4 data model. I'm thinking specifically of groups and user-defined data types. Have these been considered as a practicable solution to the original user requirement? It would seem a shame to devise an entirely new set of data structures and rules if the existing netCDF-4 features can do the job (though I suspect that some extra rules/semantics would still be required even in the case of netCDF-4).
</p>
</blockquote>
<p>
You make a valid point here Phil
</p>
<p>
As we do not have a CF data model we are forced to discuss concepts and encodings at the same time.  I am very keen to see the concepts described here available, hence we have to discuss encoding options.
</p>
<p>
I think there is a coherent activity for the CF community to adopt the NetCDF-4 features.  However, using them in this proposal explicitly disallows an encoding of such concepts using the NetCDF-3 concepts.  This may not be desirable.
</p>
<p>
I wonder whether we could manage this situation by having an open ticket on migrating CF to NetCDF-4.  If such a ticket were agreed before this ticket is concluded, then the options for encoding could change to make use of these features.  On the other hand, if no conclusion is reached and the vector concepts are agreed, they could be implemented using NetCDF-3 features and migrated to NetCDF-4 when the community adopts the extra features.
</p>
<p>
In this way we can decouple the two issues.
</p>
<p>
It may be that this ticket may provide a useful use case for the NetCDF-4 migration ticket.
</p>
<p>
My view is that these concepts are encoding independent.  If we can agree the concepts, and a particular encoding at this stage that would be an excellent result. 
</p>
<p>
Adapting the encoding in the future to take account of new features available should then be a relatively minor change.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-53-1348236626000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:53" class="cnum">
    <a href="#comment:53">comment:53</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-21T07%3A10%3A26-07%3A00&amp;precision=second" title="See timeline at 09/21/12 07:10:26">9 years ago</a> by Cathy Smith
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
I would advise against using the netCDF-4 model to handle vector quantities. First, as has been said, users often look at the parts separately (u wind, v wind, zonal momentum flux...). Having them in a group, different from all other variables, makes them non-standard and harder for the typical user to deal with. Second, vectors can be 3D and not just 2D. So, a user may look at the u,w vector or the vw one in addition to the more traditional 2D uv. So, the group would have to be set up to handle that but that makes the data harder to use in general. Incorporating wind speed or similar variables into this model would be hard, as well. Even those who go to netCDF-4 aren't necessarily using the group model; we certainly aren't here. 
</p>
<p>
A solution that used additional attributes to describe the relationship but otherwise used standard CF is probably most flexible being easier for the user while having enough information that automatic programs can interpret the information. I believe this has been one of the suggestions proposed.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-54-1348426418000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:54" class="cnum">
    <a href="#comment:54">comment:54</a>
  </span>
        in reply to:
    <a href="#comment:51">↑ 51</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2012-09-23T11%3A53%3A38-07%3A00&amp;precision=second" title="See timeline at 09/23/12 11:53:38">9 years ago</a> by jonblower
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:51" title="Comment 51">markh</a>:
</p>
<blockquote class="citation">
<p>
I think the simple approach of 'all components are CF data variables', with all the freedoms and constraints currently in place, offers the best solution.
</p>
</blockquote>
<p>
I agree with Mark here.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-55-1365065652000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:55" class="cnum">
    <a href="#comment:55">comment:55</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:59" class="follow-up">↓ 59</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-04T01%3A54%3A12-07%3A00&amp;precision=second" title="See timeline at 04/04/13 01:54:12">8 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
This ticket has been untouched in 6 months, but it was not clear at this point that there was agreement on the way forward.
</p>
<p>
I am really keen to see this enhancement agreed and implemented, I think it is a particularly useful feature with significant possibilities for CF.
</p>
<p>
I will present my feelings on where this proposal sits, in the hope that this will rekindle the discussion and move it to a resolution.
</p>
<p>
Explicit identification of components and their roles has been stated as important by me and others.
</p>
<p>
An umbrella_name has been suggested in preference to a standard_name, to highlight the difference between the umbrella variable and data or coordinate variables and to keep the standard name table from expanding further (which has to be a good thing).  This would suggest that umbrella variables may not have a standard_name attribute.
</p>
<h3 id="Proposal">Proposal</h3>
<p>
A new variable type is introduced to CF NetCDF: the Umbrella Variable.
</p>
<p>
An umbrella variable may have attributes but it must not have data associated with it and it must not be defined with respect to any NetCDF dimensions.
</p>
<p>
Umbrella variables do not inherit the ability to use any CF data variable attributes.
</p>
<p>
A new attribute:
</p>
<ul><li>umbrella_name
</li></ul><p>
is introduced, to be used only with umbrella variables.  This will be a new controlled vocabulary for CF.
</p>
<p>
A specific type of umbrella variable is defined for the purpose of defining vector quantities.
</p>
<p>
Only spatial vectors are supported.
</p>
<p>
The vector umbrella variable defines a set of attributes for the definition of components:
</p>
<ul><li>i_component
</li><li>j_component
</li><li>k_component
</li><li>i_j_direction
</li><li>k_direction
</li><li>magnitude
</li></ul><p>
Each of these attributes points to one and only one data variable within the dataset.  All referenced components are CF data variables which exist in the dataset.  
</p>
<p>
Components must be defined on the same domain as each other (all coord definitions must be the same), but the sampling regimes may be different.
</p>
<blockquote>
<p>
This is to exclude, for instance, one component variable having time-latitude-longitude and another time-altitude-latitude-longitude as coordinate variables, but it does permit components to be on an Arakawa C-grid. 
</p>
</blockquote>
<h3 id="Example">Example</h3>
<pre class="wiki">int ice_drift_vector;
 drift_vector:umbrella_name = "sea_ice_displacement_vector" ;
 drift_vector:long_name = "sea ice drift vector" ;
 drift_vector:i_component = "dX" ;
 drift_vector:j_component = "dY" ;
 drift_vector:i_j_direction = "dir" ;
</pre>
    </div>

              </div>
              <div class="change" id="trac-change-56-1365155558000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:56" class="cnum">
    <a href="#comment:56">comment:56</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:57" class="follow-up">↓ 57</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-05T02%3A52%3A38-07%3A00&amp;precision=second" title="See timeline at 04/05/13 02:52:38">8 years ago</a> by pbentley
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hi Mark,
</p>
<p>
I wonder, perhaps, if 'umbrella name/variable' is not really the right terminology here. Taken in isolation, the attribute <tt>umbrella_name</tt> suggests that its value is providing the name of an umbrella! Which clearly is not the intention ;-) I suspect that what you were wanting here is <tt>umbrella_variable_name</tt> or <tt>umbrella_quantity_name</tt>?
</p>
<p>
Personally, however, I'd prefer that the term 'umbrella' was dropped. Within the geoinformatics realm I think there are more commonly used terms which more accurately define the role being played by 'umbrella variable'. For example: parent, container, composite or aggregate (no doubt there are others).
</p>
<p>
A careful (re)analysis of the role/purpose of the proposed new construct is likely, I think, to lead to the selection of a more precise and meaningful term.
</p>
<p>
Alternatively, rather than targeting a (hazily-defined?) generic use-case, one could target the specific use-case suggested by the title of this ticket (i.e. vector quantities). Thus, one might have, say, <tt>vector_quantity_name</tt> in place of <tt>umbrella_name</tt>. (In which case it might also be useful to debate whether or not there is value in identifying a new CF <tt>featureType</tt> of <tt>vector</tt> to reinforce the intent.)
</p>
<p>
Regards,
</p>
<p>
Phil
</p>

    </div>

              </div>
              <div class="change" id="trac-change-57-1365168762000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:57" class="cnum">
    <a href="#comment:57">comment:57</a>
  </span>
        in reply to:
    <a href="#comment:56">↑ 56</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:58" class="follow-up">↓ 58</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-05T06%3A32%3A42-07%3A00&amp;precision=second" title="See timeline at 04/05/13 06:32:42">8 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:56" title="Comment 56">pbentley</a>:
</p>
<p>
Hi Phil
</p>
<blockquote class="citation">
<p>
(In which case it might also be useful to debate whether or not there is value in identifying a new CF <tt>featureType</tt> of <tt>vector</tt> to reinforce the intent.)
</p>
</blockquote>
<p>
I'm not sure that a new feature type definition is helpful here.  These containers may be used for different feature types, a structured grid may define a vector as may a trajectory or a time series, I think the concepts are independent.
</p>
<blockquote class="citation">
<p>
I wonder, perhaps, if 'umbrella name/variable' is not really the right terminology here. Taken in isolation, the attribute <tt>umbrella_name</tt> suggests that its value is providing the name of an umbrella! Which clearly is not the intention ;-) I suspect that what you were wanting here is <tt>umbrella_variable_name</tt> or <tt>umbrella_quantity_name</tt>?
</p>
</blockquote>
<p>
 
</p>
<blockquote class="citation">
<p>
Personally, however, I'd prefer that the term 'umbrella' was dropped. Within the geoinformatics realm I think there are more commonly used terms which more accurately define the role being played by 'umbrella variable'. For example: parent, container, composite or aggregate (no doubt there are others).
</p>
</blockquote>
<p>
I like the term container here, it seems quite intuitive to me; a marked improvement on umbrella.
</p>
<blockquote class="citation">
<p>
Alternatively, rather than targeting a (hazily-defined?) generic use-case, one could target the specific use-case suggested by the title of this ticket (i.e. vector quantities). Thus, one might have, say, <tt>vector_quantity_name</tt> in place of <tt>umbrella_name</tt>. 
</p>
</blockquote>
<p>
I think that the aim of this ticket should be to deliver the specific use case of vector quantities.  That said I think it is worth keeping an eye on the future and other uses for a container/umbrella so I think vector should be the first of a potential number of types, with scope for extension, not treated in complete isolation. Hence I propose the generic type and one explicit instance of that type.
</p>
<p>
Perhaps we could define the following to deliver to the scope of this ticket.
</p>
<ul><li>Container variable
<ul><li>a new type of CF variable
</li></ul></li><li>container_type 
<ul><li>an attribute on a Container variable
</li><li>a controlled vocabulary within CF, defined in the specification
</li><li>initially the only valid value is:
<ul><li>vector
</li></ul></li><li>the container type then defines a list of further container attributes for that type (as above)
</li></ul></li><li>container_name 
<ul><li>an attribute on a Container variable
</li><li>a controlled vocabulary within CF, maintained as a list like standard_names
</li><li>the container_name would be linked to a valid container type, e.g.:
<ul><li>container_name: "sea_ice_displacement", type: "vector" 
</li></ul></li></ul></li></ul><p>
what do you think?
</p>
<p>
mark
</p>

    </div>

              </div>
              <div class="change" id="trac-change-58-1365503515000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:58" class="cnum">
    <a href="#comment:58">comment:58</a>
  </span>
        in reply to:
    <a href="#comment:57">↑ 57</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-09T03%3A31%3A55-07%3A00&amp;precision=second" title="See timeline at 04/09/13 03:31:55">8 years ago</a> by pbentley
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:57" title="Comment 57">markh</a>:
</p>
<blockquote class="citation">
<p>
Perhaps we could define the following to deliver to the scope of this ticket.
</p>
</blockquote>
<ul><li>Container variable
...
</li><li>container_type 
...
</li><li>container_name 
...
</li></ul><blockquote class="citation">
<p>
what do you think?
</p>
</blockquote>
<p>
I think that your proposed scheme, or something close to it, would be workable. As I hinted at back in <a class="ticket" href="./79#comment:48" title="Comment 48">comment:48</a>, however, I do wonder to what extent we could - or should - exploit the basic machinery for handling groups of variables as provided by the netCDF-4 library (in combination with the enhanced data model). It would seem to make sense to exploit that capability, rather than retro-fit it to the netCDF-3 world.
</p>
<p>
If we were to endorse a netCDF-3 classic implementation - either exclusively, or as an option - then I can foresee a scenario whereby countless developers of netCDF client tools will each roll their own custom (and potentially incompatible) solutions for handling groups of variables.
</p>
<p>
From comments made earlier against this ticket, I realise that there is some resistance to going down the full netCDF-4 path. But if we are unwilling to adopt a feature as compelling as netCDF-4 groups to handle, erm, grouping of variables, then I wonder what, if anything, might prompt us to make the transition?
</p>
<p>
I realise that I have drifted off topic somewhat. Apologies for that. To reiterate: yes, I think the metadata/data model being proposed could be made to work using either the netCDF-3 or netCDF-4 data models. But if we were to endorse/support both approaches then I suspect that developers probably will only target the former.
</p>
<p>
Phil
</p>

    </div>

              </div>
              <div class="change" id="trac-change-59-1365507140000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:59" class="cnum">
    <a href="#comment:59">comment:59</a>
  </span>
        in reply to:
    <a href="#comment:55">↑ 55</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:60" class="follow-up">↓ 60</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-09T04%3A32%3A20-07%3A00&amp;precision=second" title="See timeline at 04/09/13 04:32:20">8 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:55" title="Comment 55">markh</a>:
</p>
<blockquote class="citation">
<p>
This ticket has been untouched in 6 months, but it was not clear at this point that there was agreement on the way forward.
</p>
</blockquote>
<p>
Mark,
</p>
<p>
I appreciate you re-open this issue.
</p>
<p>
If you remember correctly, I had proposed an implementation of the vectors/tensors in CF on 21st August (2012). This proposal was however deemed as difficult to use in practice by others, and the explicit definition of components attributes (i_component, ij_direction, magnitude,...) was proposed. Even Jonathan, that was first advocating against the implied redundancy of the attributes was convinced, and -I must admit- so was I.
</p>
<p>
So I do support your initiative to re-open the issue, following your idea. I am looking forward to comment/edit a text implementing this changeset into CF (main text and appendix).
</p>
<p>
The term "umbrella" was really one I found for clarifying my ideas, but I am not attached to it. "container" is better, although it is funny how the netCDF implementation will "contain" very little (no data, no link to dimensions, just plain text attributes). And I cannot foresee what other usage of "umbrella/container" will be later propose that do not fit the "container" realm.
</p>
<p>
Isn't a "umbrella/container" just a "gluer" or a "stitcher"? (now that's ugly :)
</p>
<p>
I support "container" when compared to "umbrella", but am still looking for a more generic term.
</p>
<p>
Cheers,
Thomas
</p>

    </div>

              </div>
              <div class="change" id="trac-change-60-1365514450000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:60" class="cnum">
    <a href="#comment:60">comment:60</a>
  </span>
        in reply to:
    <a href="#comment:59">↑ 59</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:61" class="follow-up">↓ 61</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-09T06%3A34%3A10-07%3A00&amp;precision=second" title="See timeline at 04/09/13 06:34:10">8 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:59" title="Comment 59">lavergne</a>:
</p>
<blockquote class="citation">
<p>
I support "container" when compared to "umbrella", but am still looking for a more generic term.
</p>
</blockquote>
<p>
Another idea that occurs to me, in the spirit of using existing functionality, might be to use the "cf_role" property, as is used for discrete sampling geometries. So your container variable could would have cf_role='vector'. Such a variable would then have vector_name='sea_ice_displacement'. A "vector_name" property in the absence of cf_role='vector' would not be treated in any special way.
</p>
<p>
Or something like that?
</p>
<p>
All the best,
</p>
<p>
David
</p>

    </div>

              </div>
              <div class="change" id="trac-change-61-1365529955000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:61" class="cnum">
    <a href="#comment:61">comment:61</a>
  </span>
        in reply to:
    <a href="#comment:60">↑ 60</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:62" class="follow-up">↓ 62</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-09T10%3A52%3A35-07%3A00&amp;precision=second" title="See timeline at 04/09/13 10:52:35">8 years ago</a> by ngalbraith
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:60" title="Comment 60">davidhassell</a>:
 
</p>
<blockquote class="citation">
<p>
Another idea that occurs to me, in the spirit of using existing functionality, might be to use the "cf_role" property, as is used for discrete sampling geometries. So your container variable could would have cf_role='vector'. Such a variable would then have vector_name='sea_ice_displacement'. A "vector_name" property in the absence of cf_role='vector' would not be treated in any special way.
</p>
</blockquote>
<p>
Using cf_role seems good because it's an existing concept. Could we also replace 'vector_name' with something like 'group_name' to make this easier to expand? Although we're starting with vectors, as the cf_role terms grow, the uses for this construct could be very broad. 
</p>
<p>
Going back to the example above, proposed in Sept '12,
</p>
<pre class="wiki">int ice_drift_vector;
 drift_vector:umbrella_name = "sea_ice_displacement_vector" ;
 drift_vector:long_name = "sea ice drift vector" ;
 drift_vector:i_component = "dX" ;
 drift_vector:j_component = "dY" ;
 drift_vector:i_j_direction = "dir" ;
</pre><p>
I find the attribute names i_component and j_component completely opaque. CF is supposed to be human-readable, and these don't really convey any information, at least nothing intuitive. Was the idea to specify the components individually that we needed to identify whether this was a 2-d or 3-d vector?  To me, a shared 'components' attribute would work just as well, and would be more flexible and concise.
</p>
<p>
Could it be simplified to:
</p>
<pre class="wiki">
int drift_vector;
 drift_vector:cf_role='vector';
 drift_vector:group_name='sea_ice_drift_vector';
 drift_vector:long_name = "sea ice drift vector" ;
 drift_vector: components = "dX, dY, dir" ;
</pre><p>
The variables dX, dY, and dir would then be responsible for identifying themselves fully as to their role in the vector. I've read through the comments above and I see the i_ and j_component being proposed, but not adopted, and I don't find the rationale behind this.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-62-1365536295000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:62" class="cnum">
    <a href="#comment:62">comment:62</a>
  </span>
        in reply to:
    <a href="#comment:61">↑ 61</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-09T12%3A38%3A15-07%3A00&amp;precision=second" title="See timeline at 04/09/13 12:38:15">8 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:61" title="Comment 61">ngalbraith</a>:
</p>
<blockquote class="citation">
<p>
Could it be simplified to:
</p>
<pre class="wiki">
int drift_vector;
 drift_vector:cf_role='vector';
 drift_vector:group_name='sea_ice_drift_vector';
 drift_vector:long_name = "sea ice drift vector" ;
 drift_vector: components = "dX, dY, dir" ;
</pre><p>
The variables dX, dY, and dir would then be responsible for identifying themselves fully as to their role in the vector. I've read through the comments above and I see the i_ and j_component being proposed, but not adopted, and I don't find the rationale behind this.
</p>
</blockquote>
<p>
Thank you, we are back where we started, 60 comments ago :)
</p>
<p>
This is exactly what I was advocating for in the text opening this ticket, and later in the implementation I proposed on August 21st (post <a class="closed ticket" href="./33.html" title="enhancement: cell_methods for statistical indices (closed: fixed)">#33</a>).
</p>
<p>
The reasons why many then advocated for introducing a more detailled listing of the components (like i_component, magnitude, etc...) are mainly:
1) it proves cumbersome to rely on parsing standard names for deciding if a component is a magnitude, a direction, or a x component;
2) standard_names are not mandatory and sometimes "under approval", and vectors could need a way to be defined with "non standard" components;
</p>
<p>
I did not fully buy the first argument, but I must say the second convinced me.
</p>
<p>
I am still puzzled on how we are going to check the validity of a vector variable that defines "sea_ice_x_displacement" as "ij_direction". How will a CF checker handle that? The only way I see is to introduce the link between component attributes and standar names in the standard name table: "sea_ice_x_displacement" can only appear as either a "i_component" or a "j_component", or a "k_component". And if we do that, argument 1) in my list above partly falls.
</p>
<p>
Thomas
</p>

    </div>

              </div>
              <div class="change" id="trac-change-63-1365712608000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:63" class="cnum">
    <a href="#comment:63">comment:63</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:64" class="follow-up">↓ 64</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-11T13%3A36%3A48-07%3A00&amp;precision=second" title="See timeline at 04/11/13 13:36:48">8 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Thomas
</p>
<p>
I prefer the simplicity of your original idea, recently reproposed by Nan. I do not think it is a good idea to store more information in the container variable than is necessary. It is not necessary to identify the components, amplitude, angle etc. of a vector, since they do that themselves with their standard names. You just want to provide a way to group them. The second argument
</p>
<blockquote>
<p>
standard_names are not mandatory and sometimes "under approval", and vectors could need a way to be defined with "non standard" components
</p>
</blockquote>
<p>
strikes me as an argument <em>against</em> using the container variable to indicate which is the x-component, which the y-component, etc. Providing this facility might mean that users of new quantities would not bother to request standard names for them, and thus the container variable would become an alternative to standard names for identifying these quantities. That would make the use of the CF standard more complicated for software trying to find what it wants in a file. Rather, I think that the variables the container points to should be required to have standard names - I'm sure that we have been through this before :-)
</p>
<p>
Your original use-case was to make it easier to identify the groups of variables that together form a vector. The simplest kind of container will fulfil that need.
</p>
<p>
Use of <tt>cf_role="vector"</tt> looks like a good idea to me. The term "container" might be slightly <em>too</em> general, though. We also call <tt>grid_mapping</tt> a container variable, but its purpose is different. "Group" could be a good term.
</p>
<p>
I still think it would be fine to have special standard names for these vector groups, but equally we could have a new controlled vocabulary. In either case, it should be stated in the vocabulary which standard names were allowed as components of a group with a particular group name.
</p>
<p>
So I would favour something like your original version and Nan's recent one
</p>
<pre class="wiki">
 int drift_vector;
   drift_vector:group_name = "sea_ice_displacement";
   drift_vector:cf_role="vector";
   drift_vector:components = "dX dY dir" ;

</pre><p>
Even more simply, if it has a <tt>group_name</tt> (rather than a <tt>standard_name</tt>), perhaps that identifies its purpose, and the <tt>cf_role</tt> could be omitted.
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-64-1365751551000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:64" class="cnum">
    <a href="#comment:64">comment:64</a>
  </span>
        in reply to:
    <a href="#comment:63">↑ 63</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:65" class="follow-up">↓ 65</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-12T00%3A25%3A51-07%3A00&amp;precision=second" title="See timeline at 04/12/13 00:25:51">8 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Jonathan,
</p>
<p>
Replying to <a class="ticket" href="./79#comment:63" title="Comment 63">jonathan</a>:
</p>
<blockquote class="citation">
<p>
Dear Thomas
I prefer the simplicity of your original idea, recently reproposed by Nan. 
</p>
</blockquote>
<blockquote class="citation">
<p>
[...]
</p>
</blockquote>
<blockquote class="citation">
<p>
Your original use-case was to make it easier to identify the groups of variables that together form a vector. The simplest kind of container will fulfil that need.
</p>
</blockquote>
<p>
Thanks again. I feel this trac ticket is going in an infinite loop modus, and I do not really see where (or how) to put a "break" and conclude. Do we have to reach 100% agreement? or have some voices more weight than others? How to we take the final decision in such a ticket?
</p>
<p>
If someone still feels the "simple" proposal is not enough, could I propose the following approach:
</p>
<ol><li>We finalize then close this ticket with the "simple" approach, introducing the new mechanisms for identifying a vector as a "group/umbrella/container" variable, that uses a mandatory "components" attributes listing the data variables. We thus require that components of the vector have standard name.
</li></ol><ol start="2"><li>Right after, or later in the lifetime of the project, when we see that the "simple" approach is not enough, we start a new ticket for enhancing the construct. This new ticket could, for example, introduce the "i_component", "magnitude", etc... attributes (but maybe we will come up with an even smarter solution?) and put the "components" one as optional. Data files that were built using the "simple" approach will still be CF compliant, but will lack some features, that -if critical enough- will prompt the re-converting of the files to the new approach.
</li></ol><p>
The other (cleaner, longer) way of getting out of this would be to forget what we have been debating in this ticket (namely HOW to implement vectors) and instead go back to the WHY we need vector constructs. Answers to this WHY should then help us pin-point why the "simple" approach is enough, or not. 
</p>
<p>
What to you think?
</p>
<p>
Replying to <a class="ticket" href="./79#comment:63" title="Comment 63">jonathan</a>:
</p>
<blockquote class="citation">
<p>
Even more simply, if it has a <tt>group_name</tt> (rather than a <tt>standard_name</tt>), perhaps that identifies its purpose, and the <tt>cf_role</tt> could be omitted.
</p>
</blockquote>
<p>
When it comes to the decision if such a construct should have a standard name or one from a new vocabulary: one of the arguments why I proposed a standard_name in the first place, is because it then opens all the additional things one can do with such names, e.g. standard name modifiers. One could for example refer a "status_flag" variable directly on the vector construct, in addition to that of the individual components. I do not say we cannot construct "group_name modifiers" if we need, but standard name modifiers are already there, so why not try to use them.
</p>
<p>
Thomas
</p>

    </div>

              </div>
              <div class="change" id="trac-change-65-1365762706000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:65" class="cnum">
    <a href="#comment:65">comment:65</a>
  </span>
        in reply to:
    <a href="#comment:64">↑ 64</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:66" class="follow-up">↓ 66</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-12T03%3A31%3A46-07%3A00&amp;precision=second" title="See timeline at 04/12/13 03:31:46">8 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:64" title="Comment 64">lavergne</a>:
</p>
<blockquote class="citation">
<p>
I do not really see where (or how) to put a "break" and conclude. Do we have to reach 100% agreement? or have some voices more weight than others? How to we take the final decision in such a ticket?
</p>
</blockquote>
<p>
My view is that we need to reach a consensus on what represents a good enough solution, without any strong objections to the approach left outstanding.
</p>
<p>
I feel that there is a good case for adding extra structure to this proposal, in order to meet a set of use cases which we have for specifying and working with vector quantities. 
</p>
<p>
I have tried to stress how important it is for our use of this feature that we can precisely define the role of a component within the scope of the vector container, we feel this is a crucial factor in delivering the benefit we seek.
</p>
<p>
I also think it needs careful consideration how this new type of assocation will scale in the future of CF.  The opportunity to semantically group data variables has not been present in CF before, it's posential applications are not yet clear but there may be many.  For this reason I think it will be a very valuable approach for us to take to define a type for the vector container, so that if other containers are required in the future their usage can be clearly separated from what we decide here.
</p>
<p>
For these reasons I have strong objections to the simplified solution and I urge those who favor the simplified solution to reconsider my position.  I do not think that the solution I presented in <a class="ticket" href="./79#comment:55" title="Comment 55">comment:55</a> adds a lot of complexity, it feels clear and self describing to me,  whilst it brings significant benefit to the people I work with.  This is why I am continuing to request that it is implemented by the community. 
</p>

    </div>

              </div>
              <div class="change" id="trac-change-66-1365766855000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:66" class="cnum">
    <a href="#comment:66">comment:66</a>
  </span>
        in reply to:
    <a href="#comment:65">↑ 65</a>
        ;
          <span>follow-up:</span>
    <a href="#comment:68" class="follow-up">↓ 68</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-12T04%3A40%3A55-07%3A00&amp;precision=second" title="See timeline at 04/12/13 04:40:55">8 years ago</a> by lavergne
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Mark,
</p>
<p>
Replying to <a class="ticket" href="./79#comment:65" title="Comment 65">markh</a>:
</p>
<blockquote class="citation">
<p>
Replying to <a class="ticket" href="./79#comment:64" title="Comment 64">lavergne</a>:
</p>
<blockquote class="citation">
<p>
I do not really see where (or how) to put a "break" and conclude. Do we have to reach 100% agreement? or have some voices more weight than others? How to we take the final decision in such a ticket?
</p>
</blockquote>
<p>
My view is that we need to reach a consensus on what represents a good enough solution, without any strong objections to the approach left outstanding.
</p>
<p>
I feel that there is a good case for adding extra structure to this proposal, in order to meet a set of use cases which we have for specifying and working with vector quantities. 
</p>
</blockquote>
<p>
Let's discuss it a bit further, then:
</p>
<p>
Does the problem with the "simple" solution boil down to the standard names being cumbersome to parse by a machine (like sea_ice_x_velocity, u_wind, etc...) ?
</p>
<p>
If yes, I argue the "component" attribute as you propose are a way around an issue with the standard name table. I do not say it rules your approach out, but are we introducing the components attributes because we cannot practically change the standard names?
</p>
<p>
Now imagine the standard names were "easy" to parse, and it was thus easy to decide if a variable was a "x", or a "direction" would there be anything missing from the "simple" implementation?
</p>
<p>
Cheers,
Thomas
</p>

    </div>

              </div>
              <div class="change" id="trac-change-67-1365795346000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:67" class="cnum">
    <a href="#comment:67">comment:67</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-12T12%3A35%3A46-07%3A00&amp;precision=second" title="See timeline at 04/12/13 12:35:46">8 years ago</a> by rhorne@…
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Folks:
</p>
<p>
I have spent some time thinking about how to use (and possibly extend the CF standard) for space weather products, which essentially boil down to data sets derived from sensors with one or more apertures looking off into outer space.
</p>
<p>
As a result, these use cases need 3 dimensional vectors.  In the case of the more structure approach, the conventions will need to specifically include support for 3D vectors.  But this alone does not completely solve my problem.  These space weather product vectors also have a 3D field of view around the sensor aperture's boresight that need to be captured.  With the more structured approach, additional vector component conventions will need to be captured.
</p>
<p>
The point here is that the more structured approach is likely to be enhanced/tweaked repeatedly, if not on an on-going basis, moving forward.
</p>
<p>
Thus, the stability of the conventions is enhanced (not to mention the rate in which progress can be achieved by data producers) with the simpler, less structured approach moving forward.
</p>
<p>
very respectfully,
</p>
<p>
randy
</p>

    </div>

              </div>
              <div class="change" id="trac-change-68-1366030813000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:68" class="cnum">
    <a href="#comment:68">comment:68</a>
  </span>
        in reply to:
    <a href="#comment:66">↑ 66</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-15T06%3A00%3A13-07%3A00&amp;precision=second" title="See timeline at 04/15/13 06:00:13">8 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./79#comment:66" title="Comment 66">lavergne</a>:
</p>
<blockquote class="citation">
<p>
Let's discuss it a bit further, then:
</p>
</blockquote>
<p>
thank you
</p>
<blockquote class="citation">
<p>
Does the problem with the "simple" solution boil down to the standard names being cumbersome to parse by a machine (like sea_ice_x_velocity, u_wind, etc...) ?
</p>
</blockquote>
<p>
This is a challenge, but it is not the core problem.  
</p>
<p>
I know that standard_names are optional and much data is created/provided without a standard_name.
</p>
<p>
As such, the dependency of component identification on standard_names is inherently fragile, it only works in certain, well defined cases.
</p>
<p>
I would also like to use this facility to define vector fields created from scalar fields and other vector fields.  
</p>
<blockquote class="citation">
<p>
If yes, I argue the "component" attribute as you propose are a way around an issue with the  standard name table. I do not say it rules your approach out, but are we introducing the components attributes because we cannot practically change the standard names?
</p>
</blockquote>
<p>
I agree that there is a part of my logic which is wary of further complicating the use of standard names, as I think they are already taking a large amount of the strain of CF and they are a limiting factor in some regards.
</p>
<p>
But this is secondary to my concern that standard names are not able to deliver to the requirements for vector identification.
</p>
<blockquote class="citation">
<p>
Now imagine the standard names were "easy" to parse, and it was thus easy to decide if a variable was a "x", or a "direction" would there be anything missing from the "simple" implementation?
</p>
</blockquote>
<p>
Yes, there would.  Specifically, the ability to derive vector fields from other fields which can be used.
</p>
<p>
If I calculate the gradient of a scalar field, I get a set of vector components.  I have no confidence that someone has already prepared a set of standard names for me, in many cases there will be no valid names, but I have created the fields.  I need to identify them for them to be useful to my downstream software.
</p>
<p>
I can link them together as components, but I have no way of defining what their roles are.  I do not want to pursue the path of inventing my own semantics for this, I want to work within the standard.  But the standard states I must not make up standard names on the fly.
</p>
<p>
At this point I have a vector field with n components and no clue what these vector components represent.  It is guesswork how to provide the correct data to plot, for example, arrows for a 2D slice through my 3D vector field.
</p>
<p>
I feel it is far too much of a burden to place an data analysers to make them request and discuss a new standard_name every time they want to calculate the gradient or curl of another Field.
</p>
<p>
Hence, my preferred solution is to define roles.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-69-1366031788000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:69" class="cnum">
    <a href="#comment:69">comment:69</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2013-04-15T06%3A16%3A28-07%3A00&amp;precision=second" title="See timeline at 04/15/13 06:16:28">8 years ago</a> by markh
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
i would also like to counsel against the use of 
</p>
<p>
cf_role
</p>
<p>
in this context.
</p>
<p>
This attribute is used as part of the definition of discrete sampling geometries and I think the vector container we are discussing here is as applicable to use with discrete sampling geometries as it is with continuous datasets.
</p>
<p>
I think it will lead to problems re-using this attribute in the context of vectors
</p>
<p>
mark
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/trac/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="./79?format=rss" class="rss">RSS Feed</a>
        </li><li>
          <a rel="nofollow" href="./79?format=csv" class="csv">Comma-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="./79?format=tab" class="tab">Tab-delimited Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="https://trac.edgewall.org/"><img src="/trac/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/trac/about"><strong>Trac 1.0.20</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the CF Metadata home page at<br /><a href="http://cf-convention.github.io">http://cf-convention.github.io</a><br><font color="#0000ff" size="3"><b>The CF Metadata Trac issue tracker is read-only and will soon be shut down permanently</b></font></p>
    </div>
  </body>
</html>
