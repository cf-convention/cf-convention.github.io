<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
<meta name="generator" content="hypermail 2.3.0, see http://www.hypermail-project.org/" />
<title>[CF-metadata] Choice of fill value for unpacked data from Jim Biard on 2012-10-10 (cf-metadata-mailman)</title>
<meta name="Author" content="Jim Biard (jim.biard)" />
<meta name="Subject" content="[CF-metadata] Choice of fill value for unpacked data" />
<meta name="Date" content="2012-10-10" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
.period {font-weight: bold}
</style>
</head>
<body>
<div class="head">
<a style="text-decoration:none" href="./4780.html"><img src="./red-arrow-left.jpg" width="50" alt="&lArr;"></a> <a style="text-decoration:none" href="./4782.html"><img src="./red-arrow-right.jpg" width="50" alt="&rArr;"></a><h1>[CF-metadata] Choice of fill value for unpacked data</h1>
<!-- received="Wed Oct 10 06:36:48 2012" -->
<!-- isoreceived="20121010053648" -->
<!-- sent="Wed, 10 Oct 2012 08:36:48 -0400" -->
<!-- isosent="20121010123648" -->
<!-- name="Jim Biard" -->
<!-- email="jim.biard" -->
<!-- subject="[CF-metadata] Choice of fill value for unpacked data" -->
<!-- id="B28034F9-833D-4541-A1E4-4DC1E8860603_at_noaa.gov" -->
<!-- charset="US-ASCII" -->
<!-- inreplyto="507487B4.3040600_at_unidata.ucar.edu" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start4781" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ More options (<a href="#options2">top</a>, <a href="#options3">bottom</a>) ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="./4782.html" accesskey="d" title="Mark Mathewson Consulting: &quot;[CF-metadata] CF-netcdf for Mercator projection - use lat/lon, or xc/yc plus lat/lon&quot;">Next message</a> ]
[ <a href="./4780.html" title="John Caron: &quot;[CF-metadata] Choice of fill value for unpacked data&quot;">Previous message</a> ]
[ <a href="./4780.html" title="John Caron: &quot;[CF-metadata] Choice of fill value for unpacked data&quot;">In reply to</a> ]
<!-- unextthread="start" -->
[ <a href="./4784.html" accesskey="t" title="John Caron: &quot;[CF-metadata] Choice of fill value for unpacked data&quot;">Next in thread</a> ]
 [ <a href="#replies">Replies</a> ]
<!-- ureply="end" -->
</li>
</ul>
</map>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="index.html#msg4781" title="Contemporary messages by date">by date</a> ] [ <a href="thread.html#msg4781" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg4781" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg4781" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Jim Biard &lt;<a href="mailto:jim.biard?Subject=Re%3A%20%5BCF-metadata%5D%20Choice%20of%20fill%20value%20for%20unpacked%20data">jim.biard</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: Wed, 10 Oct 2012 08:36:48 -0400</span><br />
</address>
<br />
John,
<br />
<br />I agree that there is no ambiguity in the original dataset.  I was just pointing out a scenario in which the difficulty mentioned by Phil in his original post would manifest itself.  The methodology referenced by Russ won't handle it.  If you (for reasons beyond your control) have a packed fill value that is inside your valid range, then no guidance is provided by CF to automated client software for how to represent the unpacked fill value, leaving the user with a requirement to dig back through the packed values, find the elements marked as fill, and &quot;manually&quot; mark the unpacked values.
<br />
<br />Grace and peace,
<br />
<br />Jim
<br />
<br />Jim Biard
<br />
Research Scholar
<br />
Cooperative Institute for Climate and Satellites
<br />
Remote Sensing and Applications Division
<br />
National Climatic Data Center
<br />
151 Patton Ave, Asheville, NC 28801-5001
<br />
<br />jim.biard at noaa.gov
<br />
828-271-4900
<br />
<br />On Oct 9, 2012, at 4:23 PM, John Caron &lt;caron at unidata.ucar.edu&gt; wrote:
<br />
<br /><em class="quotelev1">&gt; Hi Jim:
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; _FillValue/missing_value refers to the packed value, so theres no ambiguity in the original dataset. It is best to make sure its outside the range of real values, but even if not, one just has to search for that exact bit pattern.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; If someone rewrites the data, its their responsibility to choose a _FillValue/missing_value that is unambiguous.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; If your use case is important, you could add _UnpackedFillValue, so that your software did the right thing. Dunno if it would be generally useful.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; John
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; On 9/27/2012 7:00 AM, Jim Biard wrote:
</em><br />
<em class="quotelev2">&gt;&gt; Hi.
</em><br />
<em class="quotelev2">&gt;&gt; 
</em><br />
<em class="quotelev2">&gt;&gt; Assuming you have the luxury of specifying your _FillValue and/or
</em><br />
<em class="quotelev2">&gt;&gt; missing_value, I agree that this isn't a big deal.  However, I am
</em><br />
<em class="quotelev2">&gt;&gt; working with data where the project has defined fill/missing values that
</em><br />
<em class="quotelev2">&gt;&gt; are wholly within the range of possible values (NPP satellite data).
</em><br />
<em class="quotelev2">&gt;&gt;  The approach defined below fails in such cases.
</em><br />
<em class="quotelev2">&gt;&gt; 
</em><br />
<em class="quotelev2">&gt;&gt; Grace and peace,
</em><br />
<em class="quotelev2">&gt;&gt; 
</em><br />
<em class="quotelev2">&gt;&gt; Jim
</em><br />
<em class="quotelev2">&gt;&gt; 
</em><br />
<em class="quotelev2">&gt;&gt; Jim Biard
</em><br />
<em class="quotelev2">&gt;&gt; Research Scholar
</em><br />
<em class="quotelev2">&gt;&gt; Cooperative Institute for Climate and Satellites
</em><br />
<em class="quotelev2">&gt;&gt; Remote Sensing and Applications Division
</em><br />
<em class="quotelev2">&gt;&gt; National Climatic Data Center
</em><br />
<em class="quotelev2">&gt;&gt; 151 Patton Ave, Asheville, NC 28801-5001
</em><br />
<em class="quotelev2">&gt;&gt; 
</em><br />
<em class="quotelev2">&gt;&gt; jim.biard at noaa.gov &lt;mailto:jim.biard at noaa.gov&gt;
</em><br />
<em class="quotelev2">&gt;&gt; 828-271-4900
</em><br />
<em class="quotelev2">&gt;&gt; 
</em><br />
<em class="quotelev2">&gt;&gt; On Sep 25, 2012, at 11:08 PM, Russ Rew &lt;russ at unidata.ucar.edu
</em><br />
<em class="quotelev2">&gt;&gt; &lt;mailto:russ at unidata.ucar.edu&gt;&gt; wrote:
</em><br />
<em class="quotelev2">&gt;&gt; 
</em><br />
<em class="quotelev3">&gt;&gt;&gt; Hi Phil,
</em><br />
<em class="quotelev3">&gt;&gt;&gt; 
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; The final para of section 2.5.1 of the CF conventions document describes
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; the use of the _FillValue (or missing_value) attribute in the case of
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; data packed using the scale-and-offset method.  What is not clear - at
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; least to me - is what the preferred application behaviour should be in
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; the case where the data is unpacked and then written out to a new netCDF
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; file. In particular, what fill value should be used for the unpacked
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; data variable?
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; 
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; I presume that one wouldn't normally want to use the original fill value
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; since that value (typically an 8- or 16-bit integer) is quite likely to
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; fall within the normal range of the unpacked data (typically a 32- or
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; 64-bit float).
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; 
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; In the absence of explicitly setting a fill value attribute on the
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; unpacked data variable I assume that the netCDF default fill value will
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; be used for the data type in question. Which may not always be desirable
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; (certainly not for 32-bit floats, where the default fill value can give
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; rise to subtle precision-related problems).
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; 
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; With this in mind, I was wondering if there is any merit in defining a
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; new attribute called, say, _UnpackedFillValue (or
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; unpacked_missing_value)? If client software detected this attribute then
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; the associated value (same data type as the scale_factor and add_offset
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; attributes) would be used as the fill value for the unpacked data
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; variable.
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; 
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; Alternatively, the names _FillValueUnpacked (missing_value_unpacked)
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; might be preferable since they would then appear together pair-wise in
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; CDL-type listings, e.g.
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; 
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; short pkd_var(z, y, x) :
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt;  ...
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt;  pkd_var:_FillValue =3D -32768 ;
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt;  pkd_var:_FillValueUnpacked =3D -1.0e30 ;
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt;  pkd_var:add_offset =3D 42.0 ;
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt;  pkd_var:scale_factor =3D 1234.0 ;
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt;  ...
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; 
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; 
</em><br />
<em class="quotelev4">&gt;&gt;&gt;&gt; Any merit/mileage in this idea?
</em><br />
<em class="quotelev3">&gt;&gt;&gt; 
</em><br />
<em class="quotelev3">&gt;&gt;&gt; A more detailed recommendation for treating special values such as
</em><br />
<em class="quotelev3">&gt;&gt;&gt; _FillValue or missing_value for packed data is described, with
</em><br />
<em class="quotelev3">&gt;&gt;&gt; associated formulas, in the &quot;Packed Data Values&quot; section of a
</em><br />
<em class="quotelev3">&gt;&gt;&gt; best-practices document that we wrote a few years ago:
</em><br />
<em class="quotelev3">&gt;&gt;&gt; 
</em><br />
<em class="quotelev3">&gt;&gt;&gt; <a href="http://www.unidata.ucar.edu/netcdf/docs/BestPractices.html#Packed%20Data%20Values">http://www.unidata.ucar.edu/netcdf/docs/BestPractices.html#Packed%20Data%20Values</a>
</em><br />
<em class="quotelev3">&gt;&gt;&gt; 
</em><br />
<em class="quotelev3">&gt;&gt;&gt; It provides a recommendation for ensuring the unpacked special value is
</em><br />
<em class="quotelev3">&gt;&gt;&gt; not in the range of other unpacked data values.  If that recommendation
</em><br />
<em class="quotelev3">&gt;&gt;&gt; is followed, I think there is no need for an additional
</em><br />
<em class="quotelev3">&gt;&gt;&gt; _FillValueUnpacked (or missing_value_unpacked) attribute.
</em><br />
<em class="quotelev3">&gt;&gt;&gt; 
</em><br />
<em class="quotelev3">&gt;&gt;&gt; If you agree that is an acceptable approach, perhaps we should add it to
</em><br />
<em class="quotelev3">&gt;&gt;&gt; CF ...
</em><br />
<em class="quotelev3">&gt;&gt;&gt; 
</em><br />
<em class="quotelev3">&gt;&gt;&gt; --Russ
</em><br />
<em class="quotelev3">&gt;&gt;&gt; _______________________________________________
</em><br />
<em class="quotelev3">&gt;&gt;&gt; CF-metadata mailing list
</em><br />
<em class="quotelev3">&gt;&gt;&gt; CF-metadata at cgd.ucar.edu &lt;mailto:CF-metadata at cgd.ucar.edu&gt;
</em><br />
<em class="quotelev3">&gt;&gt;&gt; <a href="http://mailman.cgd.ucar.edu/mailman/listinfo/cf-metadata">http://mailman.cgd.ucar.edu/mailman/listinfo/cf-metadata</a>
</em><br />
<em class="quotelev2">&gt;&gt; 
</em><br />
<em class="quotelev2">&gt;&gt; 
</em><br />
<em class="quotelev2">&gt;&gt; 
</em><br />
<em class="quotelev2">&gt;&gt; _______________________________________________
</em><br />
<em class="quotelev2">&gt;&gt; CF-metadata mailing list
</em><br />
<em class="quotelev2">&gt;&gt; CF-metadata at cgd.ucar.edu
</em><br />
<em class="quotelev2">&gt;&gt; <a href="http://mailman.cgd.ucar.edu/mailman/listinfo/cf-metadata">http://mailman.cgd.ucar.edu/mailman/listinfo/cf-metadata</a>
</em><br />
<em class="quotelev2">&gt;&gt; 
</em><br />
<em class="quotelev1">&gt; _______________________________________________
</em><br />
<em class="quotelev1">&gt; CF-metadata mailing list
</em><br />
<em class="quotelev1">&gt; CF-metadata at cgd.ucar.edu
</em><br />
<em class="quotelev1">&gt; <a href="http://mailman.cgd.ucar.edu/mailman/listinfo/cf-metadata">http://mailman.cgd.ucar.edu/mailman/listinfo/cf-metadata</a>
</em><br />
<br />-------------- next part --------------
<br />
An HTML attachment was scrubbed...
<br />
URL: &lt;<a href="http://mailman.cgd.ucar.edu/pipermail/cf-metadata/attachments/20121010/48900a60/attachment-0001.html">http://mailman.cgd.ucar.edu/pipermail/cf-metadata/attachments/20121010/48900a60/attachment-0001.html</a>&gt;
<br />
<span id="received"><dfn>Received on</dfn> Wed Oct 10 2012 - 06:36:48 BST</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start4781">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="./4782.html" title="Next message in the list">Mark Mathewson Consulting: "[CF-metadata] CF-netcdf for Mercator projection - use lat/lon, or xc/yc plus lat/lon"</a></li>
<li><dfn>Previous message</dfn>: <a href="./4780.html" title="Previous message in the list">John Caron: "[CF-metadata] Choice of fill value for unpacked data"</a></li>
<li><dfn>In reply to</dfn>: <a href="./4780.html" title="Message to which this message replies">John Caron: "[CF-metadata] Choice of fill value for unpacked data"</a></li>
<!-- lnextthread="start" -->
<li><dfn>Next in thread</dfn>: <a href="./4784.html" title="Next message in this discussion thread">John Caron: "[CF-metadata] Choice of fill value for unpacked data"</a></li>
<li><a name="replies" id="replies"></a>
<dfn>Reply</dfn>: <a href="./4784.html" title="Message sent in reply to this message">John Caron: "[CF-metadata] Choice of fill value for unpacked data"</a></li>
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options3" id="options3"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="index.html#msg4781" title="Contemporary messages by date">by date</a> ] [ <a href="thread.html#msg4781" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg4781" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg4781" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail-project.org/">hypermail 2.3.0</a>
: Wed Jul 27 2022 - 12:58:10 BST
</em></small></p>
</body>
<p><a style="text-decoration:none" href="./4780.html"><img src="./red-arrow-left.jpg" width="50" alt="&lArr;"></a> <a style="text-decoration:none" href="./4782.html"><img src="./red-arrow-right.jpg" width="50" alt="&rArr;"></a></html>
