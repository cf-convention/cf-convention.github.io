<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
<meta name="generator" content="hypermail 2.3.0, see http://www.hypermail-project.org/" />
<title>[CF-metadata]   weighted time mean vs. conditional time mean. from Jonathan Gregory on 2016-05-25 (cf-metadata-mailman)</title>
<meta name="Author" content="Jonathan Gregory (j.m.gregory)" />
<meta name="Subject" content="[CF-metadata]   weighted time mean vs. conditional time mean." />
<meta name="Date" content="2016-05-25" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
.period {font-weight: bold}
</style>
</head>
<body>
<div class="head">
<a style="text-decoration:none" href="./7642.html"><img src="./red-arrow-left.jpg" width="50" alt="&lArr;"></a> <a style="text-decoration:none" href="./7644.html"><img src="./red-arrow-right.jpg" width="50" alt="&rArr;"></a><h1>[CF-metadata]   weighted time mean vs. conditional time mean.</h1>
<!-- received="Wed May 25 08:37:13 2016" -->
<!-- isoreceived="20160525073713" -->
<!-- sent="Wed, 25 May 2016 15:37:13 +0100" -->
<!-- isosent="20160525143713" -->
<!-- name="Jonathan Gregory" -->
<!-- email="j.m.gregory" -->
<!-- subject="[CF-metadata]   weighted time mean vs. conditional time mean." -->
<!-- id="20160525143713.GA4974_at_met.reading.ac.uk" -->
<!-- charset="US-ASCII" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start7643" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ More options (<a href="#options2">top</a>, <a href="#options3">bottom</a>) ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="./7644.html" accesskey="d" title="alison.pamment at stfc.ac.uk: &quot;[CF-metadata] weighted time mean vs. conditional time mean.&quot;">Next message</a> ]
[ <a href="./7642.html" title="Jonathan Gregory: &quot;[CF-metadata]  Wave periods sub-proposal&quot;">Previous message</a> ]
<!-- unextthread="start" -->
<!-- ureply="end" -->
</li>
</ul>
</map>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="index.html#msg7643" title="Contemporary messages by date">by date</a> ] [ <a href="thread.html#msg7643" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg7643" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg7643" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Jonathan Gregory &lt;<a href="mailto:j.m.gregory?Subject=Re%3A%20%5BCF-metadata%5D%20%20%20weighted%20time%20mean%20vs.%20conditional%20time%20mean.">j.m.gregory</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: Wed, 25 May 2016 15:37:13 +0100</span><br />
</address>
<br />
Dear Martin
<br />
<br />I took the interpretation that &quot;where&quot; means area because that's why it was
<br />
introduced. However I agree that it can be generalised and that the SIMIP
<br />
example is a use-case for it. So it would seem appropriate to make a proposal
<br />
on a trac ticket for the required small (I expect) changes to the wording of
<br />
the convention to make this possibility explicit. The SIMIP case could be
<br />
included as an example. 
<br />
<br />Best wishes
<br />
<br />Jonathan
<br />
<br />----- Forwarded message from martin.juckes at stfc.ac.uk -----
<br />
<br /><em class="quotelev1">&gt; Date: Wed, 25 May 2016 11:47:04 +0000
</em><br />
<em class="quotelev1">&gt; From: martin.juckes at stfc.ac.uk
</em><br />
<em class="quotelev1">&gt; To: cf-metadata at cgd.ucar.edu
</em><br />
<em class="quotelev1">&gt; Subject: [CF-metadata]  weighted time mean vs. conditional time mean.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; Dear Jonathan,
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; yes, it is absolutely clear that &quot;where&quot; can only be used with area types. It is also clear, I thought, that some of these area types may vary with time: the area type list includes &quot;fire&quot; and &quot;cloud&quot;, for example.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; 7.3.3 gives a template for the cell_methods element:
</em><br />
<em class="quotelev1">&gt; dim1: [dim2: [dim3: ...]] method [where type1 [over type2]] [within|over days|years] [(comment)]
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; and goes on to say: &quot;The valid values for dim1 [dim2[dim3 ...] ] are the names of dimensions of the data variable, names ofscalar coordinate variables of the data variable, valid standard names,or the word area.&quot; There is no stated restriction on the values of &quot;dim&quot; which can precede &quot;where ...&quot;.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; You appear to be taking a geographical interpretation of &quot;where&quot; and assuming that it can only apply to spatial information, but have been reading it from a mathematical perspective, in which it can refer to any dimension. In mathematics, statements of the form &quot;sum of A where condition B&quot; carry no implication that &quot;where&quot; has anything to do with area. From this perspective, there is no need to introduce &quot;when&quot; ..
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; The use case that prompted this, from SIMIP, corresponds to your 3rd example, in which we are averaging over all points in the cell and time period covered for which the area type is valid, giving each point equal weight. This can be handled, as you and Karl have pointed out earlier, with a comment in the cell_methods string of the form &quot;(weighted by ....)&quot;, but I feel that the use case is clear enough that there is a need for it to be treated in the conventions.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; regards,
</em><br />
<em class="quotelev1">&gt; Martin
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; ##############################################################
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; Dear Martin
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; In my reading of 7.3.3 and the conformance document, it seems clear that
</em><br />
<em class="quotelev1">&gt; &quot;where&quot; is intended to be used with area types.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev2">&gt; &gt; There is an issue, it appears, about the use of the &quot;where&quot; modifier for cell_methods elements other than &quot;area:&quot;. Jonathan believes &quot;where&quot; should only apply for area on the basis that this where the motivation comes from in the first paragraph of section 7.3.3. The subsequent paragraphs in section 7.3.3. describe the use of &quot;where&quot; with a generic element &quot;name: ....&quot;. The compliance document clearly states that &quot;where&quot; can be used with any string.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; I'm sorry, I can't find that - please could you point it out? In
</em><br />
<em class="quotelev1">&gt; <a href="http://cfconventions.org/Data/cf-documents/requirements-recommendations/requirements-recommendations-1.6.html">http://cfconventions.org/Data/cf-documents/requirements-recommendations/requirements-recommendations-1.6.html</a>
</em><br />
<em class="quotelev1">&gt; regarding
</em><br />
<em class="quotelev1">&gt; method [where type1 [over type2]]
</em><br />
<em class="quotelev1">&gt; it says
</em><br />
<em class="quotelev1">&gt; The valid values for type1 are the name of a string-valued auxiliary or scalar
</em><br />
<em class="quotelev1">&gt; coordinate variable with a standard_name of area_type, or any string value
</em><br />
<em class="quotelev1">&gt; allowed for a variable of standard_name of area_type.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; We could generalise area_types to mean &quot;states&quot; so they can apply in time as
</em><br />
<em class="quotelev1">&gt; well as space. I think all the existing ones could be interpreted in this way
</em><br />
<em class="quotelev1">&gt; i.e. with the sense of &quot;when&quot; rather than &quot;where&quot;. Vegetation is sometimes
</em><br />
<em class="quotelev1">&gt; present and sometimes absent at any given spot, for instance, just as it is
</em><br />
<em class="quotelev1">&gt; present in some spots and not others at any given time.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; Suppose you want to calculate a radiative flux for a grid-box in cloud-free
</em><br />
<em class="quotelev1">&gt; air. You can do this on each instantaneous timestep for the cloud-free fraction
</em><br />
<em class="quotelev1">&gt; of the grid-box, and then calculate a time-mean of these timestep values i.e.
</em><br />
<em class="quotelev1">&gt; &quot;area: mean where clear_sky time: mean&quot;. If the input data supplies a higher
</em><br />
<em class="quotelev1">&gt; spatial resolution than the grid-box, so you have many timeseries, you could
</em><br />
<em class="quotelev1">&gt; alternatively do it the other way round, and first calculate, for each of the
</em><br />
<em class="quotelev1">&gt; points, the value of the flux for those timesteps when there is no cloud, then
</em><br />
<em class="quotelev1">&gt; calculate an area-mean of these local values i.e. &quot;time: mean where clear_sky
</em><br />
<em class="quotelev1">&gt; area: mean&quot;. These aren't the same because they imply different weights.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; For example, suppose you have three points within the grid-box and two times,
</em><br />
<em class="quotelev1">&gt; and the data is as follows:
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; a X X
</em><br />
<em class="quotelev1">&gt; b c X
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; where X means cloudy, and a, b, c are clear-sky values. According to the first
</em><br />
<em class="quotelev1">&gt; method, the value is a/2 + b/4 + c/4, and according to the second method it is
</em><br />
<em class="quotelev1">&gt; a/4 + b/4 + c/2, if I've done my sums right. There is a third method, in which
</em><br />
<em class="quotelev1">&gt; we consider both time and space together: &quot;time: area: mean where clear_sky&quot;.
</em><br />
<em class="quotelev1">&gt; In this case the value is a/3 + b/3 + c/3.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; If I'm right about this, I think we could make this generalisation and it would
</em><br />
<em class="quotelev1">&gt; not be problematic. However, as usual, we should only make the change if there
</em><br />
<em class="quotelev1">&gt; is a use-case which demands it.
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; Best wishes
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; Jonathan
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; _______________________________________________
</em><br />
<em class="quotelev1">&gt; CF-metadata mailing list
</em><br />
<em class="quotelev1">&gt; CF-metadata at cgd.ucar.edu
</em><br />
<em class="quotelev1">&gt; <a href="http://mailman.cgd.ucar.edu/mailman/listinfo/cf-metadata">http://mailman.cgd.ucar.edu/mailman/listinfo/cf-metadata</a>
</em><br />
<br />----- End forwarded message -----
<br />
<span id="received"><dfn>Received on</dfn> Wed May 25 2016 - 08:37:13 BST</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start7643">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="./7644.html" title="Next message in the list">alison.pamment at stfc.ac.uk: "[CF-metadata] weighted time mean vs. conditional time mean."</a></li>
<li><dfn>Previous message</dfn>: <a href="./7642.html" title="Previous message in the list">Jonathan Gregory: "[CF-metadata]  Wave periods sub-proposal"</a></li>
<!-- lnextthread="start" -->
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options3" id="options3"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="index.html#msg7643" title="Contemporary messages by date">by date</a> ] [ <a href="thread.html#msg7643" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg7643" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg7643" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail-project.org/">hypermail 2.3.0</a>
: Wed Jul 27 2022 - 12:59:04 BST
</em></small></p>
</body>
<p><a style="text-decoration:none" href="./7642.html"><img src="./red-arrow-left.jpg" width="50" alt="&lArr;"></a> <a style="text-decoration:none" href="./7644.html"><img src="./red-arrow-right.jpg" width="50" alt="&rArr;"></a></html>
