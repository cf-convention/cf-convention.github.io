<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
<meta name="generator" content="hypermail 2.3.0, see http://www.hypermail-project.org/" />
<title>[CF-metadata] Feedback requested on proposed CF Simple Geometries from Hedley, Mark on 2016-09-26 (cf-metadata-mailman)</title>
<meta name="Author" content="Hedley, Mark (mark.hedley)" />
<meta name="Subject" content="[CF-metadata] Feedback requested on proposed CF Simple Geometries" />
<meta name="Date" content="2016-09-26" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
.period {font-weight: bold}
</style>
</head>
<body>
<div class="head">
<a style="text-decoration:none" href="./7810.html"><img src="./red-arrow-left.jpg" width="50" alt="&lArr;"></a> <a style="text-decoration:none" href="./7812.html"><img src="./red-arrow-right.jpg" width="50" alt="&rArr;"></a><h1>[CF-metadata] Feedback requested on proposed CF Simple Geometries</h1>
<!-- received="Mon Sep 26 04:03:36 2016" -->
<!-- isoreceived="20160926030336" -->
<!-- sent="Mon, 26 Sep 2016 10:03:36 +0000" -->
<!-- isosent="20160926100336" -->
<!-- name="Hedley, Mark" -->
<!-- email="mark.hedley" -->
<!-- subject="[CF-metadata] Feedback requested on proposed CF Simple Geometries" -->
<!-- id="7819C496F4E10E47BCEFBE74551AAC9634816DE4_at_EXXCMPD1DAG3.cmpd1.metoffice.gov.uk" -->
<!-- charset="US-ASCII" -->
<!-- inreplyto="CADckZ8djSj=K0WPwfbAyx525LdvJdXvKfGAqD-qGq8zaBkK6MA_at_mail.gmail.com" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start7811" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ More options (<a href="#options2">top</a>, <a href="#options3">bottom</a>) ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="./7812.html" accesskey="d" title="B&#0228;rring Lars: &quot;[CF-metadata] Metadata/standard names for variables involving thresholds (e.g. climate indices)&quot;">Next message</a> ]
[ <a href="./7810.html" title="Sean Arms: &quot;[CF-metadata] Temporal nitpicks.&quot;">Previous message</a> ]
[ <a href="./7768.html" title="Ben Koziol - NOAA Affiliate: &quot;[CF-metadata] Feedback requested on proposed CF Simple Geometries&quot;">In reply to</a> ]
<!-- unextthread="start" -->
<!-- ureply="end" -->
</li>
</ul>
</map>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="index.html#msg7811" title="Contemporary messages by date">by date</a> ] [ <a href="thread.html#msg7811" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg7811" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg7811" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Hedley, Mark &lt;<a href="mailto:mark.hedley?Subject=Re%3A%20%5BCF-metadata%5D%20Feedback%20requested%20on%20proposed%20CF%20Simple%20Geometries">mark.hedley</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: Mon, 26 Sep 2016 10:03:36 +0000</span><br />
</address>
<br />
Hello Ben
<br />
<br />I think this is fascinating and fantastic work which is likely to prove very useful for a range of domains.
<br />
<br />I am afraid that, just now, I don't have any specific insights with regard to:
<br />
<em class="quotelev1">&gt; Questions for the CF Community
</em><br />
<em class="quotelev1">&gt; 
</em><br />
<em class="quotelev1">&gt; 1. Are our VLEN netCDF-3 and netCDF-4 approaches acceptable? What changes would you recommend?
</em><br />
<em class="quotelev1">&gt; 2. Are the geometry types point, line, polygon, and their multipart equivalents sufficient for the community?
</em><br />
<br />but I do think these are really valuable areas to get feedback on.
<br />
<br />all the best
<br />
mark
<br />
<br /><br /><br />From: CF-metadata [cf-metadata-bounces at cgd.ucar.edu] on behalf of Ben Koziol - NOAA Affiliate [ben.koziol at noaa.gov]
<br />
<br />Sent: 07 September 2016 19:13
<br />
<br />To: CF metadata
<br />
<br />Cc: Bob Simons - NOAA Federal; Whiteaker, Timothy L
<br />
<br />Subject: [CF-metadata] Feedback requested on proposed CF Simple Geometries
<br />
<br /><br /><br /><br /><br /><br /><br />Greetings,
<br />
<br /><br /><br />As part of an EarthCube project for
<br />
&nbsp;advancing netCDF-CF [1], we are developing an approach to represent simple geometries in enhanced netCDF-4 with a variable length array backport for netCDF-3. Simple geometries, for example, may be used to associate stream discharge with river lines or surface
<br />
&nbsp;runoff with watershed polygons. We've drafted an initial approach and reference implementation on the GitHub netCDF-CF-simple-geometry project [2] and would greatly appreciate feedback from the CF community. We'd like to make sure our scope is appropriate
<br />
&nbsp;and our approach is acceptable.
<br />
<br /><br />Scope
<br />
<br /><br /><br /><br />The result of this effort will be a standard that the CF
<br />
timeSeries
<br />
&nbsp;feature type could use to specify spatial coordinates (define a simple geometry) for a
<br />
timeSeries
<br />
&nbsp;variable.
<br />
<br />For those familiar with the OGC WKT standard geometry types [3], we will
<br />
&nbsp;include Point, LineString, Polygon, Multipoint, MultiLineString, and MultiPolygon (WKT primitives and multipart geometries).
<br />
<br /><br /><br /><br />We anticipate that the six chosen geometry
<br />
&nbsp;types will cover the needs of most people generating netCDF data. These types also align with other geospatial data formats such as GeoJSON and ESRI Shapefile. If our approach is well received by the CF community, we may later adapt it to include parametric
<br />
&nbsp;shapes such as circles and ellipses.
<br />
<br /><br />Simple Geometry Encoding
<br />
&nbsp;Method
<br />
<br /><br />Driven by the possibility that different
<br />
&nbsp;features will require different numbers of coordinates to describe their geometries, our approach uses variable length (VLEN) arrays in enhanced netCDF-4 and continuous ragged arrays (CRAs) in netCDF-3. We describe the VLEN netCDF-4 approach first. The netCDF-3
<br />
&nbsp;CRA description follows.
<br />
<br /><br />In our approach, a VLEN
<br />
coordinate_index
<br />
&nbsp;variable which identifies the indices of geometry coordinates in separate coordinate arrays. The
<br />
coordinate_index
<br />
&nbsp;variable includes a coordinates
<br />
&nbsp;attribute which stores the names of the coordinate variables and a geom_type
<br />
&nbsp;attribute to indicate the geometry type.
<br />
<br /><br />For multipart geometries, the coordinate
<br />
&nbsp;index variable may include a negative integer flag(s) indicating the start of each new geometry &quot;part&quot; for the current feature. The first geometry part is not preceded by the negative integer flag. The variable shall include an attribute named
<br />
multipart_break_value
<br />
&nbsp;identifying the flag's value.
<br />
<br /><br />For polygon geometries with holes (also
<br />
&nbsp;called &quot;interiors&quot;), the coordinate index values shall include a negative integer flagging the start of each hole. In this case, the variable shall include a
<br />
hole_break_value
<br />
&nbsp;attribute to indicate the flag value.
<br />
<br /><br />Other attributes on the coordinate index
<br />
&nbsp;variable describe clockwise or anticlockwise node order for polygons and polygon closure convention. For additional details, see the wiki [4]. With these concepts defined, an example for multipolygons with holes is shown below. You can copy the WKT description
<br />
&nbsp;below into Wicket [5] if you'd like to see what the geometry in this example looks like.
<br />
<br /><br />Well-Known Text (WKT):
<br />
MULTIPOLYGON(((0 0, 20 0, 20 20, 0 20, 0 0), (1 1, 10 5, 19 1, 1 1), (5 15, 7 19, 9 15, 5 15),
<br />
&nbsp;(11 15, 13 19, 15 15, 11 15)), ((5 25, 9 25, 7 29, 5 25)), ((11 25, 15 25, 13 29, 11 25)))
<br />
<br /><br />Common Data Language (CDL) for netCDF-4
<br />
&nbsp;VLEN Arrays:
<br />
<br /><br />netcdf multipolygon_example
<br />
&nbsp;{
<br />
types:
<br />
&nbsp;int64(*) geom_VLType ;
<br />
dimensions:
<br />
&nbsp;node = 25 ;
<br />
&nbsp;geom = 1 ;
<br />
variables:
<br />
&nbsp;geom_VLType coordinate_index(geom)
<br />
&nbsp;;
<br />
&nbsp;&nbsp;&nbsp;string coordinate_index:geom_type
<br />
&nbsp;= &quot;multipolygon&quot; ;
<br />
&nbsp;&nbsp;&nbsp;string coordinate_index:coordinates
<br />
&nbsp;= &quot;x y&quot; ;
<br />
&nbsp;&nbsp;&nbsp;coordinate_index:multipart_break_value
<br />
&nbsp;= -1 ;
<br />
&nbsp;&nbsp;&nbsp;coordinate_index:hole_break_value
<br />
&nbsp;= -2 ;
<br />
&nbsp;&nbsp;&nbsp;string coordinate_index:outer_ring_order
<br />
&nbsp;= &quot;anticlockwise&quot; ;
<br />
&nbsp;&nbsp;&nbsp;string coordinate_index:closure_convention
<br />
&nbsp;= &quot;last_node_equals_first&quot; ;
<br />
&nbsp;double x(node) ;
<br />
&nbsp;double y(node) ;
<br />
data:
<br />
<br /><br />coordinate_index =
<br />
<br />&nbsp;&nbsp;&nbsp;{0, 1, 2, 3, 4, -2, 5, 6,
<br />
&nbsp;7, 8, -2, 9, 10, 11, 12, -2, 13, 14, 15, 16, -1, 17, 18, 19, 20, -1, 21, 22, 23, 24} ;
<br />
<br /><br />x = 0, 20, 20, 0, 0, 1, 10,
<br />
&nbsp;19, 1, 5, 7, 9, 5, 11, 13, 15, 11, 5, 9, 7, 5, 11, 15, 13, 11 ;
<br />
<br /><br />y = 0, 0, 20, 20, 0, 1, 5, 1,
<br />
&nbsp;1, 15, 19, 15, 15, 15, 19, 15, 15, 25, 25, 29, 25, 25, 25, 29, 25 ;
<br />
}
<br />
<br /><br />You'll find additional examples for
<br />
&nbsp;VLEN geometry storage on our wiki [6]. 
<br />
<br /><br />Variable Length (VLEN)
<br />
&nbsp;Arrays in NetCDF-3
<br />
<br /><br />To support netCDF-3, we created a VLEN
<br />
&nbsp;approach for netCDF-3 [7]. Inspired by CF continuous ragged arrays (CRAs), our approach drops the CRA
<br />
count
<br />
&nbsp;variable in favor of a stop
<br />
&nbsp;variable that stores the stop index for each geometry within an array of geometry coordinates. This improves random accessibility of the CRA &quot;elements&quot; avoiding the need to sum counts preceding the target element index. The
<br />
stop
<br />
&nbsp;variable includes a contiguous_ragged_dimension
<br />
&nbsp;attribute whose value is the name of the dimension for which stop indices apply (similar to the CRA
<br />
sample_dimension
<br />
&nbsp;attribute). An example showing how strings can be stored with this approach is shown below.
<br />
<br /><br />Common Data Language (CDL) for netCDF-3
<br />
&nbsp;CRAs:
<br />
<br /><br />netcdf dwarf_planets {
<br />
dimensions:
<br />
dwarf_planet
<br />
&nbsp;= 5 ;  // number of dwarf planets described in this file
<br />
dwarf_planet_chars
<br />
&nbsp;= 28 ;  // total number of characters for all planet names
<br />
variables:
<br />
char
<br />
&nbsp;dwarf_planet_name(dwarf_planet_chars) ;
<br />
int
<br />
&nbsp;dwarf_planet_name_stop(dwarf_planet) ;
<br />
dwarf_planet_name_stop:contiguous_ragged_dimension
<br />
&nbsp;= &quot;dwarf_planet_chars&quot; ;
<br />
data:
<br />
dwarf_planet_name = &quot;PlutoCeresErisHaumeaMakemake&quot;
<br />
&nbsp;;
<br />
dwarf_planet_name_stop = 5,
<br />
&nbsp;10, 14, 20, 28 ;
<br />
}
<br />
<br /><br />For the above geometry example, the
<br />
&nbsp;VLEN coordinate_index
<br />
&nbsp;netCDF-4 array is replaced by a netCDF-3 CRA. 
<br />
<br /><br />netcdf multipolygon_example
<br />
&nbsp;{
<br />
dimensions:
<br />
&nbsp;&nbsp;&nbsp;node = 25 ;
<br />
&nbsp;&nbsp;&nbsp;indices = 30;
<br />
&nbsp;&nbsp;&nbsp;geom = 1 ;
<br />
variables:
<br />
&nbsp;int coordinate_index(indices)
<br />
&nbsp;;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coordinate_index:geom_type
<br />
&nbsp;= &quot;multipolygon&quot; ;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coordinate_index:coordinates
<br />
&nbsp;= &quot;x y&quot; ;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coordinate_index:multipart_break_value
<br />
&nbsp;= -1 ;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coordinate_index:hole_break_value
<br />
&nbsp;= -2 ;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coordinate_index:outer_ring_order
<br />
&nbsp;= &quot;anticlockwise&quot; ;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coordinate_index:closure_convention
<br />
&nbsp;= &quot;last_node_equals_first&quot; ;
<br />
&nbsp;int coordinate_index_stop(geom)
<br />
&nbsp;;
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coordinate_index_stop:contiguous_ragged_dimension
<br />
&nbsp;= &quot;indices&quot; ;
<br />
&nbsp;double x(node) ;
<br />
&nbsp;double y(node) ;
<br />
data:
<br />
coordinate_index = 0, 1, 2,
<br />
&nbsp;3, 4, -2, 5, 6, 7, 8, -2, 9, 10, 11, 12, -2, 13, 14, 15, 16, -1, 17, 18, 19, 20, -1, 21, 22, 23, 24 ;
<br />
coordinate_index_stop = 30 ;
<br />
x = 0, 20, 20, 0, 0, 1, 10,
<br />
&nbsp;19, 1, 5, 7, 9, 5, 11, 13, 15, 11, 5, 9, 7, 5, 11, 15, 13, 11 ;
<br />
y = 0, 0, 20, 20, 0, 1, 5, 1,
<br />
&nbsp;1, 15, 19, 15, 15, 15, 19, 15, 15, 25, 25, 29, 25, 25, 25, 29, 25 ;
<br />
}
<br />
<br /><br />The CRA method could of course be used
<br />
&nbsp;in place of VLEN in netCDF-4. See our wiki page on GitHub [7] for more details and examples.
<br />
<br /><br />Questions for the CF
<br />
&nbsp;Community
<br />
<br /><br /><br /><br />Are our VLEN netCDF-3 and netCDF-4 approaches acceptable? What changes would
<br />
&nbsp;you recommend?
<br />
<br />Are the geometry types point, line, polygon, and their multipart equivalents
<br />
&nbsp;sufficient for the community?
<br />
<br /><br /><br />Thank you very much for considering
<br />
&nbsp;our ideas and helping us with your valuable feedback!
<br />
<br /><br />[1]
<br />
<a href="http://earthcube.org/group/advancing-netcdf-cf">http://earthcube.org/group/advancing-netcdf-cf</a>
<br />
[2]
<br />
<a href="https://github.com/bekozi/netCDF-CF-simple-geometry">https://github.com/bekozi/netCDF-CF-simple-geometry</a>
<br />
[3]
<br />
<a href="https://en.wikipedia.org/wiki/Well-known_text">https://en.wikipedia.org/wiki/Well-known_text</a>
<br />
[4]
<br />
<a href="https://github.com/bekozi/netCDF-CF-simple-geometry/wiki">https://github.com/bekozi/netCDF-CF-simple-geometry/wiki</a>
<br />
[5]
<br />
<a href="https://arthur-e.github.io/Wicket/sandbox-gmaps3.html">https://arthur-e.github.io/Wicket/sandbox-gmaps3.html</a>
<br />
[6]
<br />
<a href="https://github.com/bekozi/netCDF-CF-simple-geometry/wiki/Examples---VLen-Ragged-Arrays">https://github.com/bekozi/netCDF-CF-simple-geometry/wiki/Examples---VLen-Ragged-Arrays</a>
<br />
[7]
<br />
<br /><a href="https://github.com/bekozi/netCDF-CF-simple-geometry/wiki/VLEN-Arrays-in-NetCDF-3">https://github.com/bekozi/netCDF-CF-simple-geometry/wiki/VLEN-Arrays-in-NetCDF-3</a>
<br />
<br /><br /><br /><pre>
-- 
Ben Koziol
NESII/CIRES/NOAA Earth System Research Laboratory
ben.koziol at noaa.gov
802.392.4522
<a href="http://www.esrl.noaa.gov/nesii/">http://www.esrl.noaa.gov/nesii/</a>
</pre>
<span id="received"><dfn>Received on</dfn> Mon Sep 26 2016 - 04:03:36 BST</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start7811">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="./7812.html" title="Next message in the list">B&#0228;rring Lars: "[CF-metadata] Metadata/standard names for variables involving thresholds (e.g. climate indices)"</a></li>
<li><dfn>Previous message</dfn>: <a href="./7810.html" title="Previous message in the list">Sean Arms: "[CF-metadata] Temporal nitpicks."</a></li>
<li><dfn>In reply to</dfn>: <a href="./7768.html" title="Message to which this message replies">Ben Koziol - NOAA Affiliate: "[CF-metadata] Feedback requested on proposed CF Simple Geometries"</a></li>
<!-- lnextthread="start" -->
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options3" id="options3"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="index.html#msg7811" title="Contemporary messages by date">by date</a> ] [ <a href="thread.html#msg7811" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg7811" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg7811" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail-project.org/">hypermail 2.3.0</a>
: Wed Jul 27 2022 - 12:59:06 BST
</em></small></p>
</body>
<p><a style="text-decoration:none" href="./7810.html"><img src="./red-arrow-left.jpg" width="50" alt="&lArr;"></a> <a style="text-decoration:none" href="./7812.html"><img src="./red-arrow-right.jpg" width="50" alt="&rArr;"></a></html>
