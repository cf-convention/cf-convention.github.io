<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
<meta name="generator" content="hypermail 2.3.0, see http://www.hypermail-project.org/" />
<title>[CF-metadata] Feedback requested on proposed CF Simple Geometries from Ben Koziol - NOAA Affiliate on 2016-09-27 (cf-metadata-mailman)</title>
<meta name="Author" content="Ben Koziol - NOAA Affiliate (ben.koziol)" />
<meta name="Subject" content="[CF-metadata] Feedback requested on proposed CF Simple Geometries" />
<meta name="Date" content="2016-09-27" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
.period {font-weight: bold}
</style>
</head>
<body>
<div class="head">
<a style="text-decoration:none" href="./7816.html"><img src="./red-arrow-left.jpg" width="50" alt="&lArr;"></a> <a style="text-decoration:none" href="./7818.html"><img src="./red-arrow-right.jpg" width="50" alt="&rArr;"></a><h1>[CF-metadata] Feedback requested on proposed CF Simple Geometries</h1>
<!-- received="Tue Sep 27 11:28:36 2016" -->
<!-- isoreceived="20160927102836" -->
<!-- sent="Tue, 27 Sep 2016 11:28:36 -0600" -->
<!-- isosent="20160927172836" -->
<!-- name="Ben Koziol - NOAA Affiliate" -->
<!-- email="ben.koziol" -->
<!-- subject="[CF-metadata] Feedback requested on proposed CF Simple Geometries" -->
<!-- id="CADckZ8f=sZi3EQT64P-b8a-AoOh0zcPq3+rm5qsVG3N0UL+DFg_at_mail.gmail.com" -->
<!-- charset="US-ASCII" -->
<!-- inreplyto="3B996DC3-2840-4349-A40A-A13E578562B9_at_usgs.gov" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start7817" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ More options (<a href="#options2">top</a>, <a href="#options3">bottom</a>) ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="./7818.html" accesskey="d" title="Chris Barker: &quot;[CF-metadata] Feedback requested on proposed CF Simple Geometries&quot;">Next message</a> ]
[ <a href="./7816.html" title="Jonathan Gregory: &quot;[CF-metadata] New LUMIP variables&quot;">Previous message</a> ]
[ <a href="./7814.html" title="David Blodgett: &quot;[CF-metadata] Feedback requested on proposed CF Simple	Geometries&quot;">In reply to</a> ]
<!-- unextthread="start" -->
[ <a href="./7818.html" accesskey="t" title="Chris Barker: &quot;[CF-metadata] Feedback requested on proposed CF Simple Geometries&quot;">Next in thread</a> ]
<!-- ureply="end" -->
</li>
</ul>
</map>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="index.html#msg7817" title="Contemporary messages by date">by date</a> ] [ <a href="thread.html#msg7817" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg7817" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg7817" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Ben Koziol - NOAA Affiliate &lt;<a href="mailto:ben.koziol?Subject=Re%3A%20%5BCF-metadata%5D%20Feedback%20requested%20on%20proposed%20CF%20Simple%20Geometries">ben.koziol</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: Tue, 27 Sep 2016 11:28:36 -0600</span><br />
</address>
<br />
Jonathan and CF-Metadata List,
<br />
<br />Thanks for the suggestions and discussion. We?ve attempted to respond to
<br />
the major questions and concerns using Jonathan's mail as a template.
<br />
Apologies in advance if we missed anything outstanding or did not
<br />
appropriately acknowledge contributions in this thread.
<br />
<br />You explain that the need is to specify spatial coordinates with a simple
<br />
<em class="quotelev1">&gt; geometry for a timeSeries variable. For example, this could be for the
</em><br />
<em class="quotelev1">&gt; discharge as a function of time across some line in a river (your example),
</em><br />
<em class="quotelev1">&gt; or I suppose it could be an average temperature as a function of time for
</em><br />
<em class="quotelev1">&gt; the Atlantic Ocean, where you wanted to supply the polygon which drew the
</em><br />
<em class="quotelev1">&gt; outline of the basin. Have I got the idea?
</em><br />
<br /><br />Yes, you have this mostly right. It?s common to have a collection of points
<br />
(weather stations), lines (stream reaches), or polygons (hydrologic
<br />
catchments) with an associated time series.
<br />
<br />Timeseries like this can be stored in CF, but their geographical extent is
<br />
<em class="quotelev1">&gt; usually described only in words e.g. a region name of atlantic_ocean, and
</em><br />
<em class="quotelev1">&gt; this is fine for applications like CMIP where you want to compare data from
</em><br />
<em class="quotelev1">&gt; different data sources in which the Atlantic Ocean may have different exact
</em><br />
<em class="quotelev1">&gt; shapes (different AOGCMs, in particular). An array of region names is also
</em><br />
<em class="quotelev1">&gt; possible, so I don't think we need a new convention to contain your dwarf
</em><br />
<em class="quotelev1">&gt; planet example.
</em><br />
<br /><br />The dwarf planet example is intended to describe our generalized approach
<br />
to continuous ragged arrays that may be used for arbitrarily-sized data
<br />
arrays. For some (including me), using a string instead of a numeric
<br />
example helps illustrate the concept. It is an idiosyncratic example in
<br />
many ways. Sorry for the confusion.
<br />
<br />Sect 9.1 on discrete sampling geometries says it cannot yet be used for
<br />
<em class="quotelev1">&gt; cases &quot;where geo-positioning cannot be described as a discrete point
</em><br />
<em class="quotelev1">&gt; location. Problematic examples include time series that refer to a
</em><br />
<em class="quotelev1">&gt; geographical region (e.g. the northern hemisphere) ...&quot;. Actually I think
</em><br />
<em class="quotelev1">&gt; that's not quite right. The existing convention *can* describe regions
</em><br />
<em class="quotelev1">&gt; which are contiguous, and rectangular or polygonal, using its usual bounds
</em><br />
<em class="quotelev1">&gt; convention (Sect 7.1). I think we should consider changing this text,
</em><br />
<em class="quotelev1">&gt; because it seems unnecessarily restrictive.
</em><br />
<br /><br />Your explanation makes sense, and this should be captured in the DSG
<br />
convention text.
<br />
<br /><br /><em class="quotelev1">&gt; If the regions were irregular polygons in latitude and longitude, nv would
</em><br />
<em class="quotelev1">&gt; be the number of vertices and the lat and lon bounds would trace the
</em><br />
<em class="quotelev1">&gt; outline of the polygon e.g. nv=3, lat=0,90,0 and lon=0,0,90 describes the
</em><br />
<em class="quotelev1">&gt; eighth of the sphere which is bounded by the meridians at 0E and 90E and
</em><br />
<em class="quotelev1">&gt; the Equator. I think, therefore, we do not need an additional convention
</em><br />
<em class="quotelev1">&gt; for points or polygonal regions.
</em><br />
<br /><br />Many earth science datasets (excluding triangular, hexagonal, etc. meshes)
<br />
representable as polygons and lines have differing node counts. &quot;nv&quot; could
<br />
not efficiently capture watershed A with 5 nodes and watershed B with 100.
<br />
Additionally, the cell bounds concept does not include the structure and
<br />
semantics needed to support MultiLines, MultiPolygons, or polygons with
<br />
holes/interiors.
<br />
<br />However, we would need new conventions for a timeseries where each value
<br />
<em class="quotelev1">&gt; applies to a set of discontiguous regions or regions with holes in them, a
</em><br />
<em class="quotelev1">&gt; set of points, a line or a set of lines. I guess that these are included in
</em><br />
<em class="quotelev1">&gt; the geometry types you list (LineString, Multipoint, MultiLineString, and
</em><br />
<em class="quotelev1">&gt; MultiPolygon).
</em><br />
<br /><br />Yes.
<br />
<br />Do you have definite use-cases for all of these?  (I ask this because we
<br />
<em class="quotelev1">&gt; don't add new functionality to CF until there is a definite and common need
</em><br />
<em class="quotelev1">&gt; for it in practice.)
</em><br />
<br /><br />David Arctur described the primary motivation for developing the simple
<br />
geometries approach: &quot;Among other applications, NetCDF-CF is now being used
<br />
as an intermediate &amp; output data format in the US National Weather
<br />
Service?s National Water Model (NWM). This forecasts streamflow rates in
<br />
about 2.7 million stream segments averaging 2km, throughout the continental
<br />
US, at multiple time horizons (3 hr, 18 hr, 10 days) every hour, and an
<br />
ensemble for 30-day forecast less frequently.&quot; These data also contain
<br />
multi-geometries primarily in the form of MultiLineStrings and
<br />
MultiPolgyons.
<br />
<br />To this we would add that working with GIS datasets of this magnitude is
<br />
difficult with current NetCDF metadata conventions, often yielding an
<br />
unwieldy hybrid of NetCDF data and other softwares like ESRI ArcGIS and
<br />
PostGIS. ESRI ArcGIS and PostGIS are not usable on many HPC platforms where
<br />
models like the NWM reside.
<br />
<br />I suspect that geometries of this kind can be described by the ugrid
<br />
<em class="quotelev1">&gt; convention <a href="http://ugrid-conventions.github.io/ugrid-conventions">http://ugrid-conventions.github.io/ugrid-conventions</a>, which is
</em><br />
<em class="quotelev1">&gt; compliant with CF. Their purpose is to describe a set of connected points,
</em><br />
<em class="quotelev1">&gt; edges or faces at which values are given, whereas in your case you'd give a
</em><br />
<em class="quotelev1">&gt; single value for the whole set, but the description of the geometry itself
</em><br />
<em class="quotelev1">&gt; might be similar. Have you had a look at whether ugrid could meet your
</em><br />
<em class="quotelev1">&gt; needs? If it almost does so, perhaps a better thing to do would be to
</em><br />
<em class="quotelev1">&gt; propose additions to ugrid. We would like to avoid having more than one way
</em><br />
<em class="quotelev1">&gt; to describe such geometries.
</em><br />
<br /><br />Bert Jagers and Chris Barker have already commented on this. It is
<br />
important to note that UGRID is the *primary* inspiration behind this
<br />
proposed approach. That should have been mentioned in the original mail.
<br />
The genesis of this work was with full knowledge of UGRID.
<br />
<br />This proposed CF addition is meant to align more closely with the community
<br />
standards behind GIS features types used by the OGC community. To
<br />
accommodate the feature types described by this proposal UGRID would need
<br />
to incorporate:
<br />
<br />&nbsp;&nbsp;&nbsp;1. Ragged arrays for coordinate index vectors.
<br />
&nbsp;&nbsp;&nbsp;2. Encoding method for multi-geometries.
<br />
&nbsp;&nbsp;&nbsp;3. Support for point geometries.
<br />
<br />The simple features proposal does not expect node sharing amongst
<br />
adjacent/contiguous elements and, in all fairness, this is not a
<br />
requirement of UGRID but rather a recommendation. The simple features
<br />
approach does inherit from UGRID as Bert indicated in that it is possible
<br />
to implement node sharing via coordinate index indirection.
<br />
<br />We agree with David Arctur that the simple features approach is easier to
<br />
implement than UGRID. No offense intended to UGRID which is a powerful
<br />
convention indeed.
<br />
<br />It really is up to the community if they would rather see simple features
<br />
represented in an amended CF-compatible UGRID or an addition to CF. We are
<br />
of the opinion that a simple features specification would be very useful.
<br />
<br />So far CF does not say anything about the use of netCDF-4 features (i.e.
<br />
<em class="quotelev1">&gt; not the classic model). We have often discussed allowing them but the
</em><br />
<em class="quotelev1">&gt; general argument is also made that there has to be a compelling case for
</em><br />
<em class="quotelev1">&gt; providing a new way to do something which can already be done. (Steve
</em><br />
<em class="quotelev1">&gt; Hankin often made this argument, but since he's mostly retired I'll make it
</em><br />
<em class="quotelev1">&gt; now in his name :-) If there are two ways to do something, software has to
</em><br />
<em class="quotelev1">&gt; support both of them. We already have ways to encode ragged arrays, so is
</em><br />
<em class="quotelev1">&gt; there a compelling case for needing the netCDF-4 vlen array as well? We
</em><br />
<em class="quotelev1">&gt; already have a way to encode strings too, as character arrays. I think this
</em><br />
<em class="quotelev1">&gt; is probably a discussion we should have again in a different thread, so
</em><br />
<em class="quotelev1">&gt; I'll just talk about your classic encoding. The same points apply to both
</em><br />
<em class="quotelev1">&gt; encodings.
</em><br />
<br /><br />Yes, let?s leave that conversation for another time. We mostly want to be
<br />
forward compatible understanding that vlen provides a more simple and some
<br />
would say more elegant way of handling ragged array data.
<br />
<br />Your approach uses a coordinate_index variable to identify indices of
<br />
<em class="quotelev1">&gt; geometry coordinates where the -1 and -2 indices indicates where exterior
</em><br />
<em class="quotelev1">&gt; and interior polygons begin, and the first polygon has an implied -1 at the
</em><br />
<em class="quotelev1">&gt; start. Is that right? Given this example, I wonder why you need the index
</em><br />
<em class="quotelev1">&gt; array, because none of the coordinates indices (values &gt;=0) is repeated, so
</em><br />
<em class="quotelev1">&gt; no space is saved in the x and y arrays. I guess this would be the usual
</em><br />
<em class="quotelev1">&gt; case. If polygons did touch or lines crossed, a few points would be in
</em><br />
<em class="quotelev1">&gt; common, but not so many that seems to need the complication of the index
</em><br />
<em class="quotelev1">&gt; array. A simpler way to do it would be ... which needs only one dimension,
</em><br />
<em class="quotelev1">&gt; or you could use the CF ragged array convention (Sect 9.3.3)...
</em><br />
<br /><br />Our example may not be complete enough to fully demonstrate the use case we
<br />
are trying to describe. The example given, inspired by the DSG Continuous
<br />
Ragged Array encoding, uses a 'stop' variable rather than a ?count?
<br />
variable. It may not be apparent that each ?simple feature? may actually be
<br />
multiple polygons (with or without hole polygons) or lines. Regarding the
<br />
?outside_inside? example you provided, we should show an example where the
<br />
geometry count (dimension) is more than 1 and a geometry has multiple
<br />
polygons prior to the 'stop' coordinate. The word encoding example was
<br />
meant to convey this, but may not have been sufficient. Here is an example
<br />
with three geometries:
<br />
<a href="https://github.com/bekozi/netCDF-CF-simple-geometry/wiki/VLEN-Arrays-in-NetCDF-3#multipolygon-example">https://github.com/bekozi/netCDF-CF-simple-geometry/wiki/VLEN-Arrays-in-NetCDF-3#multipolygon-example</a>
<br />
.
<br />
<br />We are hesitant to add an additional integer variable to indicate
<br />
'inside_outside' as it will introduce (in our minds) extraneous, duplicated
<br />
value variables. Why repeat -1 5,000 times when introducing a -1 at
<br />
multi-geometry breaks accomplishes the same task? One could also argue for
<br />
additional variables containing multi-geometry breaks, but again, this is
<br />
extraneous. As an example, using break values and ragged arrays similar to
<br />
what we describe, the 2.7 million catchment dataset mentioned by Dave
<br />
Arctur (which contains MultiPolygons) results in a ~10 GB uncompressed,
<br />
netCDF-4 file. Adding 'inside_outside' variables to describe the breaks
<br />
and/or holes will make this file larger. We could reduce the file size by
<br />
removing repeated nodes via the coordinate indexing method.
<br />
<br />You provide the attributes multipart_break_value and hole_break_value to
<br />
<em class="quotelev1">&gt; specify the values (-1 and -2 above) for the outside vs inside
</em><br />
<em class="quotelev1">&gt; distinction.  Do you need the generality of being able to choose these
</em><br />
<em class="quotelev1">&gt; values? It would seem simpler to use a character array and specify in the
</em><br />
<em class="quotelev1">&gt; convention which letters should be used e.g. ... That makes it more
</em><br />
<em class="quotelev1">&gt; readable, perhaps.
</em><br />
<br /><br />Those values could be fixed. We would recommend they always be appended to
<br />
the variable as attributes, however. We also tend to think of them as fill
<br />
values which are customizable in CF. In regards to the character array, it
<br />
again seems like a lot of repetition.
<br />
<br />Similarly, you propose attributes for clockwise/anticlockwise node order
<br />
<em class="quotelev1">&gt; and for the polygon closure convention.  Do these need to be freely
</em><br />
<em class="quotelev1">&gt; choosable? You could specify clockwise, like the existing CF bounds
</em><br />
<em class="quotelev1">&gt; convention, and that the polygons are closed. In the latter case, you could
</em><br />
<em class="quotelev1">&gt; omit the last vertex of each polygon since it must be the same as the
</em><br />
<em class="quotelev1">&gt; first, and that would save a bit of space. If you specify these choices,
</em><br />
<em class="quotelev1">&gt; the attributes aren't needed.
</em><br />
<br /><br />These attributes would be considered optional. If controls are in place for
<br />
ordering, it may be specified on the polygon variables. Many GIS software
<br />
packages don't care about ordering and repeated nodes, but modelling and
<br />
regridding codes tend to be more picky.
<br />
<br />If this convention is going to be used for discrete sampling geometries, an
<br />
<em class="quotelev1">&gt; additional dimension is needed, because in a single data variable you might
</em><br />
<em class="quotelev1">&gt; have data for several of these geometries. That is, you need an array of
</em><br />
<em class="quotelev1">&gt; ragged arrays. Again, I wonder whether this suggests trying to use ugrid.
</em><br />
<em class="quotelev1">&gt; It might be you could name each one as a mesh, and specify the geometry of
</em><br />
<em class="quotelev1">&gt; for the set of timeSeries as an array of mesh names. That would be a very
</em><br />
<em class="quotelev1">&gt; easy change to the existing Sect 9.
</em><br />
<br /><br />The multiple geometry example may help:
<br />
<a href="https://github.com/bekozi/netCDF-CF-simple-geometry/wiki/VLEN-Arrays-in-NetCDF-3#multipolygon-example">https://github.com/bekozi/netCDF-CF-simple-geometry/wiki/VLEN-Arrays-in-NetCDF-3#multipolygon-example</a>
<br />
.
<br />
<br />Again, thanks all for the feedback and looking forward to continued
<br />
discussion.
<br />
<br /><pre>
-- 
Ben Koziol
NESII/CIRES/NOAA Earth System Research Laboratory
ben.koziol at noaa.gov
&lt;<a href="https://mail.google.com/mail/u/0/?view=cm&amp;fs=1&amp;tf=1&amp;to=ben.koziol">https://mail.google.com/mail/u/0/?view=cm&amp;fs=1&amp;tf=1&amp;to=ben.koziol</a> at noaa.gov&gt;
802.392.4522
<a href="http://www.esrl.noaa.gov/nesii/">http://www.esrl.noaa.gov/nesii/</a>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<a href="http://mailman.cgd.ucar.edu/pipermail/cf-metadata/attachments/20160927/dcfa3a7c/attachment-0001.html">http://mailman.cgd.ucar.edu/pipermail/cf-metadata/attachments/20160927/dcfa3a7c/attachment-0001.html</a>&gt;
</pre>
<span id="received"><dfn>Received on</dfn> Tue Sep 27 2016 - 11:28:36 BST</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start7817">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="./7818.html" title="Next message in the list">Chris Barker: "[CF-metadata] Feedback requested on proposed CF Simple Geometries"</a></li>
<li><dfn>Previous message</dfn>: <a href="./7816.html" title="Previous message in the list">Jonathan Gregory: "[CF-metadata] New LUMIP variables"</a></li>
<li><dfn>In reply to</dfn>: <a href="./7814.html" title="Message to which this message replies">David Blodgett: "[CF-metadata] Feedback requested on proposed CF Simple	Geometries"</a></li>
<!-- lnextthread="start" -->
<li><dfn>Next in thread</dfn>: <a href="./7818.html" title="Next message in this discussion thread">Chris Barker: "[CF-metadata] Feedback requested on proposed CF Simple Geometries"</a></li>
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options3" id="options3"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="index.html#msg7817" title="Contemporary messages by date">by date</a> ] [ <a href="thread.html#msg7817" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg7817" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg7817" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail-project.org/">hypermail 2.3.0</a>
: Wed Jul 27 2022 - 12:59:06 BST
</em></small></p>
</body>
<p><a style="text-decoration:none" href="./7816.html"><img src="./red-arrow-left.jpg" width="50" alt="&lArr;"></a> <a style="text-decoration:none" href="./7818.html"><img src="./red-arrow-right.jpg" width="50" alt="&rArr;"></a></html>
