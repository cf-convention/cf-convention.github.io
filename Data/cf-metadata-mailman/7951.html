<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
<meta name="generator" content="hypermail 2.3.0, see http://www.hypermail-project.org/" />
<title>[CF-metadata] Feedback requested on proposed CF Simple Geometries from Ben Koziol - NOAA Affiliate on 2016-12-21 (cf-metadata-mailman)</title>
<meta name="Author" content="Ben Koziol - NOAA Affiliate (ben.koziol)" />
<meta name="Subject" content="[CF-metadata] Feedback requested on proposed CF Simple Geometries" />
<meta name="Date" content="2016-12-21" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
.period {font-weight: bold}
</style>
</head>
<body>
<div class="head">
<a style="text-decoration:none" href="./7950.html"><img src="./red-arrow-left.jpg" width="50" alt="&lArr;"></a> <a style="text-decoration:none" href="./7952.html"><img src="./red-arrow-right.jpg" width="50" alt="&rArr;"></a><h1>[CF-metadata] Feedback requested on proposed CF Simple Geometries</h1>
<!-- received="Wed Dec 21 10:41:04 2016" -->
<!-- isoreceived="20161221104104" -->
<!-- sent="Wed, 21 Dec 2016 10:41:04 -0700" -->
<!-- isosent="20161221174104" -->
<!-- name="Ben Koziol - NOAA Affiliate" -->
<!-- email="ben.koziol" -->
<!-- subject="[CF-metadata] Feedback requested on proposed CF Simple Geometries" -->
<!-- id="CADckZ8dwjwOt+em_z46y_kx1jvA5MnsMs=qdj3P4nX+Rth4HMA_at_mail.gmail.com" -->
<!-- charset="US-ASCII" -->
<!-- inreplyto="CALGmxEKxgz-r6UVHW607946sVGqzNydpUU6k93GVpO9qHWheBw_at_mail.gmail.com" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start7951" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ More options (<a href="#options2">top</a>, <a href="#options3">bottom</a>) ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="./7952.html" accesskey="d" title="Little, Chris: &quot;[CF-metadata] CF-metadata Digest, Vol 164, Issue 12&quot;">Next message</a> ]
[ <a href="./7950.html" title="Lowry, Roy K.: &quot;[CF-metadata] standard name for CDOM&quot;">Previous message</a> ]
[ <a href="./7895.html" title="Chris Barker: &quot;[CF-metadata] Feedback requested on proposed CF Simple Geometries&quot;">In reply to</a> ]
<!-- unextthread="start" -->
[ <a href="./7981.html" accesskey="t" title="Jonathan Gregory: &quot;[CF-metadata] Feedback requested on proposed CF Simple Geometries&quot;">Next in thread</a> ]
 [ <a href="#replies">Replies</a> ]
<!-- ureply="end" -->
</li>
</ul>
</map>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="index.html#msg7951" title="Contemporary messages by date">by date</a> ] [ <a href="thread.html#msg7951" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg7951" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg7951" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Ben Koziol - NOAA Affiliate &lt;<a href="mailto:ben.koziol?Subject=Re%3A%20%5BCF-metadata%5D%20Feedback%20requested%20on%20proposed%20CF%20Simple%20Geometries">ben.koziol</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: Wed, 21 Dec 2016 10:41:04 -0700</span><br />
</address>
<br />
Jonathan, Chris, and CF-Metadata,
<br />
<br />Thank you kindly for the replies and apologies for the delay on the
<br />
response. Please see responses below. The comments were very useful in
<br />
introducing some conceptual hangups and will help us moving forward. As
<br />
usual, looking forward to continued discussion.
<br />
<br />A quick note. We?ve revised our thinking a bit and recorded our current
<br />
design in an AGU poster: <a href="http://goo.gl/0NI4Sd">http://goo.gl/0NI4Sd</a>. Based on the feedback in
<br />
this thread and what we?ve learned in the process of preparing the poster
<br />
and software, we need to discuss a bit more and will prepare a proposal for
<br />
the community to review soon.
<br />
<br />I was asking whether this means that for each *collection* (of points,
<br />
lines or polygons) there is a *single* timeseries. For instance, in your
<br />
example of a single geometry composed of several polygons, there is a
<br />
single number for each time. But that is not the case for weather stations;
<br />
for each weather station there is a timeseries, and at each time there is a
<br />
different number (value of temperature, precipitation or whatever) for each
<br />
weather station. You also write, ?The US National Weather Service?s
<br />
National Water Model (NWM) ? forecasts streamflow rates in about 2.7
<br />
million stream segments averaging 2km.? The stream network is a
<br />
MultiLineString geometry, but I don?t think there is just one value of
<br />
streamflow applying to the entire network at any given time; I guess there
<br />
is a different timeseries for each stream segment. But in my example above,
<br />
the Atlantic Ocean is a single polygon with a single timeseries for its
<br />
average temperature, not a different timeseries for each node. Thus I am
<br />
unclear about the dimensions of the data. In terms of your original
<br />
example, does the data have dimensions (time,geometry, where geometry=1) or
<br />
(time,node)?
<br />
<br />Before diving in, it?s critical to define some terminology. A geometry is
<br />
meant to refer to a potentially multipart geometric entity that might
<br />
otherwise be called a feature. A geometry is made up of one or more points,
<br />
lines, or polygons.
<br />
<br />That said, we are thinking the dimensions of time-varying data would be (time,
<br />
geometry) where time and geometry may have arbitrary lengths. Hence,
<br />
multiple time-varying variables could be associated with each geometry.
<br />
Chris addressed this in his response.
<br />
<br />How geometry data is ?exploded? is up to the client-software. The 2.7
<br />
million stream segments would likely not be a single MultiLineString
<br />
geometry. The geometry counts could be 2.7 million Linestrings and 2.7
<br />
million Polygons. One could collapse all this geometry data into single
<br />
multi-geometries, but this would prove unwieldy. Some of the LineStrings
<br />
could be discontinuous multilinestring geometries (only requiring one index
<br />
on the geometry dimension but consisting of two physical LineStrings).
<br />
<br />This seems to me to be a crucial difference. In the former case the simple
<br />
geometry can be regarded as a more complex alternative to cells bounds -
<br />
the cell has a complicated geometry of nodes and lines, but it?s still a
<br />
single cell. In the latter case you?re providing many timeseries in an
<br />
unstructured geometry, which is what ugrid describes. Which do you have in
<br />
mind?
<br />
<br />We intend for this proposal to fit in the Discrete Sampling Geometry
<br />
timeSeries featureType. So this proposal does not contain any new mechanism
<br />
to link a time-varying data variable with a network composed of polygons,
<br />
points, and lines (a whole hydrologic system for example). UGRID provides
<br />
some mechanisms for this similar to other CF conventions (data is
<br />
associated with a grid center point and its bounds for example - or a
<br />
?face? has a center point in UGRID).
<br />
<br />It?s possible your question is still not being addressed. ?Nodes? are used
<br />
in all geometries. We would never associate time-varying data with nodes or
<br />
the edges between them. Data would always be associated with the geometry
<br />
(a feature comprised of nodes).
<br />
<br />You propose the index variable in order for the convention to be like
<br />
ugrid. However this still seems to me to be an unnecessary complexity and
<br />
use of space if you aren?t going to have many shared nodes. I think the
<br />
case for having another convention, distinct from ugrid, is stronger if it
<br />
is *unlike* ugrid in this respect, and therefore simpler as well.
<br />
<br />Sharing nodes should be possible within the spec in our opinion. There may
<br />
be overhead for some dataset encodings, but if one is willing to sacrifice
<br />
computational time when writing complex geometric datasets with
<br />
shared-node-topology, considerable disk space and memory may be saved.
<br />
<br />Reusing coordinate indexing indirection does not seem like a duplication of
<br />
UGRID. In fact, it makes sense to align with UGRID as much as possible to
<br />
facilitate data exchange.
<br />
<br />I agree that repeating the inside/outside flag many times is wasteful.
<br />
That, coupled with your clarification that you may have several geometries,
<br />
each consisting of several elements (points, lines, polygons), means that
<br />
you need, in effect, a ragged array of ragged arrays
<br />
(geometry,element,node). This is more complicated than DSGs, but it seems
<br />
to me it would be reasonably easy to understand if your multi-geometry
<br />
example
<br />
<a href="https://github.com/bekozi/netCDF-CF-simple-geometry/wiki/VLEN-Arrays-in-NetCDF-3#multipolygon-example">https://github.com/bekozi/netCDF-CF-simple-geometry/wiki/VLEN-Arrays-in-NetCDF-3#multipolygon-example</a>
<br />
was stored something like this:
<br />
<br />geom=3;
<br />
part=11;
<br />
node=36;
<br />
int number_of_parts(geom);
<br />
&nbsp;&nbsp;number_of_parts:parts=&quot;number_of_nodes&quot;;
<br />
int number_of_nodes(part);
<br />
&nbsp;&nbsp;number_of_nodes:inout=&quot;inout&quot;;
<br />
char inout(part);
<br />
float x(node);
<br />
float y(node);
<br />
number_of_parts=6, 3, 2;
<br />
number_of_nodes=4, 3, 3, 3, 3, 3, 3, 5, 3, 3, 3;
<br />
inout=&quot;OIIIOOOOIOO&quot;;
<br />
x=0, 20, 20, 0, 1, 10, 19, 5, 7, 9, 11, 13, 15, 5, 9, 7, 11, 15, 13, -40,
<br />
-20, -45, -20, -10, -10, -30, -45, -30, -20, -20, 30, 45, 10, 25, 50, 30;
<br />
y = 0, 0, 20, 20, 1, 5, 1, 15, 19, 15, 15, 19, 15, 25, 25, 29, 25, 25, 29,
<br />
-40, -45, -30, -35, -30, -10, -5, -20, -20, -15, -25, 20, 40, 40, 5, 10, 15;
<br />
<br />where I assume that all polygons are closed. What do you think?
<br />
<br />This is not a bad approach and, with some modifications, it could be used.
<br />
A few thoughts:
<br />
<br />&nbsp;&nbsp;&nbsp;- In regards to ?ragged array of ragged arrays?, this is solved in our
<br />
&nbsp;&nbsp;&nbsp;proposal by using multiple coordinate index / geometry variables indicating
<br />
&nbsp;&nbsp;&nbsp;a ?geom/instance? dimension to identify associated data variables. These
<br />
&nbsp;&nbsp;&nbsp;variables may use their own coordinate vectors or index into shared
<br />
&nbsp;&nbsp;&nbsp;coordinate vectors. Some more discussion on this when responding to Chris?s
<br />
&nbsp;&nbsp;&nbsp;comments.
<br />
&nbsp;&nbsp;&nbsp;- This approach is more complex, in our opinion, than the indexing
<br />
&nbsp;&nbsp;&nbsp;approach. In the case of multiple geometries in a single file, it is not
<br />
&nbsp;&nbsp;&nbsp;clear how these variables are all linked together. The coordinate index
<br />
&nbsp;&nbsp;&nbsp;variable hosts the attributes necessary for self-description.
<br />
&nbsp;&nbsp;&nbsp;- We had considered adopting something along these lines to avoid the
<br />
&nbsp;&nbsp;&nbsp;use of ?break values?. We wanted to avoid variables where possible. The
<br />
&nbsp;&nbsp;&nbsp;contiguous ragged approach requires only stop indexing (one additional
<br />
&nbsp;&nbsp;&nbsp;variable). For NetCDF4 ragged arrays, no ragged indexing is required
<br />
&nbsp;&nbsp;&nbsp;keeping the schema clean. Geometries lend themselves naturally to NetCDF4
<br />
&nbsp;&nbsp;&nbsp;ragged arrays. We agree break values are confusing. Break values present a
<br />
&nbsp;&nbsp;&nbsp;reasonable solution without adding considerable instrumentation for
<br />
&nbsp;&nbsp;&nbsp;multi-part geometries which will generally be an exception.
<br />
&nbsp;&nbsp;&nbsp;- The nice thing about the coordinate index approach is that one
<br />
&nbsp;&nbsp;&nbsp;approach basically works for all geometry types. In your example,
<br />
&nbsp;&nbsp;&nbsp;number_of_parts and inout are only present for multi-geometries
<br />
&nbsp;&nbsp;&nbsp;(multipolygons).
<br />
&nbsp;&nbsp;&nbsp;- It is more difficult to extract a single geometry using this approach.
<br />
&nbsp;&nbsp;&nbsp;Not that big of deal necessarily, but the contiguous ragged and NetCDF4
<br />
&nbsp;&nbsp;&nbsp;variable length make the process relatively simple. With geometries, we
<br />
&nbsp;&nbsp;&nbsp;view single element / random access as an important schema characteristic.
<br />
<br />For comparison, your CDL would look something like the following when
<br />
transformed into our proposal. Note, the ragged index and nodes have been
<br />
broken onto one line per geometry:
<br />
<br />geom=3;
<br />
index=44;
<br />
node=36;
<br />
int start_of_geom(geom);
<br />
&nbsp;&nbsp;start_of_geom:contiguous_ragged_dimension = &quot;index&quot;
<br />
int coordinate_index(index);
<br />
&nbsp;&nbsp;coordinate_index:geom_type=&quot;multipolygon&quot;;
<br />
&nbsp;&nbsp;coordinate_index:geom_coordinates=&quot;x y&quot;;
<br />
&nbsp;&nbsp;coordinate_index:geom_dimension=&quot;geom&quot;;
<br />
&nbsp;&nbsp;coordinate_index:stop_encoding=&quot;cra&quot;;
<br />
&nbsp;&nbsp;coordinate_index:multipart_break_value=-1;
<br />
&nbsp;&nbsp;coordinate_index:hole_break_value=-2;
<br />
&nbsp;&nbsp;coordinate_index:outer_ring_order=&quot;anticlockwise&quot;;
<br />
&nbsp;&nbsp;coordinate_index:closure_convention=&quot;last_node_equals_first&quot;;
<br />
float x(node);
<br />
float y(node);
<br />
<br />start_of_geom=0, 24, 37 ;
<br />
coordinate_index=0,1,2,3,-2,4,5,6,-2,7,8,9,-2,10,11,12,-1,13,14,15,-1,16,17,18,
<br />
19,20,21,-1,22,23,24,25,26,-2,27,28,29,
<br />
30,31,32,-1,33,34,35 ;
<br />
x=0, 20, 20, 0, 1, 10, 19, 5, 7, 9, 11, 13, 15, 5, 9, 7, 11, 15, 13,
<br />
-40, -20, -45, -20, -10, -10, -30, -45, -30, -20, -20,
<br />
30, 45, 10, 25, 50, 30;
<br />
y = 0, 0, 20, 20, 1, 5, 1, 15, 19, 15, 15, 19, 15, 25, 25, 29, 25, 25, 29,
<br />
-40, -45, -30, -35, -30, -10, -5, -20, -20, -15, -25,
<br />
20, 40, 40, 5, 10, 15;
<br />
<br />On to Chris?s comments.
<br />
<br />I think it may be helpful to borrow terminology (and the data model) from
<br />
the GIS world here. In this case, I am referencing the geoJSON spec, as I
<br />
happen to be working with that at the moment, but the basic data model is
<br />
pretty consistent.
<br />
<br />Agreed. We want to, at the very least, maintain consistency with geometry
<br />
types (not case sensitive). The ?break values? are a poor man?s parentheses
<br />
corresponding to their uses in arrays used by GeoJSON and WKT.
<br />
<br />Note that they have ?geometries? which can be things like points, polygons,
<br />
polyllines. IIUC (and I?m no osgeo mavin) geometries represent a ?single?
<br />
entity. Then there are ?Features?: a Feature is essentially data associated
<br />
with a particular geometry. But note: there are ?Collections? ? both
<br />
Geometry and Feature Collections ? that is what you use to ?bundle? various
<br />
data together.
<br />
<br />I think we may be well served by thinking in terms of mapping the GIS data
<br />
model to CF/netcdf ? for instance it would be great to be able to write a
<br />
netcdf&lt;-&gt;geoJSON converter that was lossless, AND would be fairly ?native?
<br />
in both cases.
<br />
<br />Agree in principle. In practice, this proves difficult of course. :-) A
<br />
FeatureCollection may contain features with different geometry types. We
<br />
would need to add an additional dimension variable describing the geometry
<br />
type. A GeometryCollection itself may nest inside a FeatureCollection. We
<br />
think of simple geometry variables as FeatureCollections with a static
<br />
geometry type. NetCDF groups may help provide a crosswalk, but I am not
<br />
sure we are ready to go there.
<br />
<br />GeoJSON also tends to break down with time series - repeating geometries
<br />
coordinates ad nauseum for each time coordinate. TopoJSON offers some
<br />
solutions in this regard. TopoJSON also incorporates node sharing. Chris
<br />
did link to this JSON spec already.
<br />
<br />Also, how do NetCDF attributes, dimensions, and data types fit into
<br />
GeoJSON? No good answer for this one.
<br />
<br />What?s important is that we establish a way to encode simple/basic geometry
<br />
types. Collections can be created using indexing or hierarchies. The basic
<br />
static geometry-typed FeatureCollection should be sufficient for most
<br />
applications.
<br />
<br />(though I?m still confused, maybe you can have an ?array? of data
<br />
associated with a GeometryCollection?)
<br />
<br />as for MultiLineString ? you could associate an array of data with the
<br />
Multilinestring ? so one value per segment. But I think that violates the
<br />
intent of the data model ? you should have a GeometryCollection of
<br />
linestrings instead. and then each segment has its own geometry and you can
<br />
associate an array of data with that. (or it should be a FeatureCollection?
<br />
I?m getting confused now!
<br />
<br />Yup, makes your head hurt. No good answer for this. This leads back to the
<br />
?ragged array of ragged arrays? comment by Jonathan earlier. It is likely
<br />
beyond the scope of our proposal. The solution may lie in turning geometry
<br />
variable attributes and names into arrays themselves adding another layer
<br />
of indexing in the process. We hope that the simple geometry encoding
<br />
methods could be reused in an effort like this.
<br />
<br />Of course, CF doesn?t need to follow this data model, but it?s a good idea
<br />
to be informed by it.
<br />
<br />Yes, absolutely. Your descriptions of geometry types and collections is
<br />
correct. GeometryCollections can also be used for the *same* types of
<br />
geometries - a minor point.
<br />
<br />In the GIS data model, nodes are not shared between geometries, and you are
<br />
quite right that keeping nodes separate with geometries indexing into it is
<br />
an added complication and would not be space-efficient.
<br />
<br />However, there is another reason to do it ? it makes it definitive that two
<br />
(or more) geometries share the exact same node, rather than them being
<br />
distinct points that happened to be at the same location (Or worse, with FP
<br />
error and all, two points that are very close)
<br />
<br />Yes, this is why we are for the coordinate indexing approach used in UGRID.
<br />
<br />This is actually a major limitation in the standard GIS model.
<br />
<br />Also yes!
<br />
?
<br />
-------------- next part --------------
<br />
An HTML attachment was scrubbed...
<br />
URL: &lt;<a href="http://mailman.cgd.ucar.edu/pipermail/cf-metadata/attachments/20161221/28c0b6e9/attachment-0001.html">http://mailman.cgd.ucar.edu/pipermail/cf-metadata/attachments/20161221/28c0b6e9/attachment-0001.html</a>&gt;
<br />
<span id="received"><dfn>Received on</dfn> Wed Dec 21 2016 - 10:41:04 GMT</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start7951">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="./7952.html" title="Next message in the list">Little, Chris: "[CF-metadata] CF-metadata Digest, Vol 164, Issue 12"</a></li>
<li><dfn>Previous message</dfn>: <a href="./7950.html" title="Previous message in the list">Lowry, Roy K.: "[CF-metadata] standard name for CDOM"</a></li>
<li><dfn>In reply to</dfn>: <a href="./7895.html" title="Message to which this message replies">Chris Barker: "[CF-metadata] Feedback requested on proposed CF Simple Geometries"</a></li>
<!-- lnextthread="start" -->
<li><dfn>Next in thread</dfn>: <a href="./7981.html" title="Next message in this discussion thread">Jonathan Gregory: "[CF-metadata] Feedback requested on proposed CF Simple Geometries"</a></li>
<li><a name="replies" id="replies"></a>
<dfn>Reply</dfn>: <a href="./7981.html" title="Message sent in reply to this message">Jonathan Gregory: "[CF-metadata] Feedback requested on proposed CF Simple Geometries"</a></li>
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options3" id="options3"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="index.html#msg7951" title="Contemporary messages by date">by date</a> ] [ <a href="thread.html#msg7951" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg7951" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg7951" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail-project.org/">hypermail 2.3.0</a>
: Wed Jul 27 2022 - 12:59:08 BST
</em></small></p>
</body>
<p><a style="text-decoration:none" href="./7950.html"><img src="./red-arrow-left.jpg" width="50" alt="&lArr;"></a> <a style="text-decoration:none" href="./7952.html"><img src="./red-arrow-right.jpg" width="50" alt="&rArr;"></a></html>
