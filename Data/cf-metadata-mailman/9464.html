<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
<meta name="generator" content="hypermail 2.3.0, see http://www.hypermail-project.org/" />
<title>[CF-metadata] Using units with a scale factor from Martin Juckes - UKRI STFC on 2018-11-02 (cf-metadata-mailman)</title>
<meta name="Author" content="Martin Juckes - UKRI STFC (martin.juckes)" />
<meta name="Subject" content="[CF-metadata] Using units with a scale factor" />
<meta name="Date" content="2018-11-02" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
.period {font-weight: bold}
</style>
</head>
<body>
<div class="head">
<a style="text-decoration:none" href="./9463.html"><img src="./red-arrow-left.jpg" width="50" alt="&lArr;"></a> <a style="text-decoration:none" href="./9465.html"><img src="./red-arrow-right.jpg" width="50" alt="&rArr;"></a><h1>[CF-metadata] Using units with a scale factor</h1>
<!-- received="Fri Nov  2 15:54:21 2018" -->
<!-- isoreceived="20181102155421" -->
<!-- sent="Fri, 2 Nov 2018 21:54:21 +0000" -->
<!-- isosent="20181102215421" -->
<!-- name="Martin Juckes - UKRI STFC" -->
<!-- email="martin.juckes" -->
<!-- subject="[CF-metadata] Using units with a scale factor" -->
<!-- id="bdd960ab3faa4fa9a1310bef08941c4c_at_stfc.ac.uk" -->
<!-- charset="US-ASCII" -->
<!-- inreplyto="CALqwTFONOmgKGjkYYod+5J3suQOMbmaCtM_e-Wyy9cb4KUjDuQ_at_mail.gmail.com" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start9464" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ More options (<a href="#options2">top</a>, <a href="#options3">bottom</a>) ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="./9465.html" accesskey="d" title="Jonathan Gregory: &quot;[CF-metadata] Decibel units in CF standard names&quot;">Next message</a> ]
[ <a href="./9463.html" title="Dave Allured - NOAA Affiliate: &quot;[CF-metadata] Using units with a scale factor&quot;">Previous message</a> ]
[ <a href="./9463.html" title="Dave Allured - NOAA Affiliate: &quot;[CF-metadata] Using units with a scale factor&quot;">In reply to</a> ]
<!-- unextthread="start" -->
<!-- ureply="end" -->
</li>
</ul>
</map>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="index.html#msg9464" title="Contemporary messages by date">by date</a> ] [ <a href="thread.html#msg9464" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg9464" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg9464" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Martin Juckes - UKRI STFC &lt;<a href="mailto:martin.juckes?Subject=Re%3A%20%5BCF-metadata%5D%20Using%20units%20with%20a%20scale%20factor">martin.juckes</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: Fri, 2 Nov 2018 21:54:21 +0000</span><br />
</address>
<br />
Hello Dave,
<br />
<br /><br />I am not aware of any conformance checkers which do not accommodate units of the form &quot;1e3 km3&quot;, though they may exist. So we don't need to make any adjustments there. The use of such coordinates is consistent with current CF conformance document, though not with the convention itself. So there is no need to change anything ... but I did raise the question below as to whether we want to remove this discrepancy between the CF checker and the standard. It would be simpler, from the CMIP6 perspective, if this was not done in a hurry.
<br />
<br />regards,
<br />
Martin
<br />
<br />________________________________
<br />
From: CF-metadata &lt;cf-metadata-bounces at cgd.ucar.edu&gt; on behalf of Dave Allured - NOAA Affiliate &lt;dave.allured at noaa.gov&gt;
<br />
Sent: 02 November 2018 20:39
<br />
To: cf-metadata at cgd.ucar.edu
<br />
Subject: Re: [CF-metadata] Using units with a scale factor
<br />
<br />Martin,
<br />
<br /><em class="quotelev1">&gt; Units of this form [&quot;1e3 km3&quot;] are used when the community
</em><br />
<em class="quotelev1">&gt; requests them, usually because that is the common practice
</em><br />
<em class="quotelev1">&gt; within their community -- they probably exist in many NetCDF
</em><br />
<em class="quotelev1">&gt; files outside CMIP.
</em><br />
<br /><em class="quotelev1">&gt; Is it reasonable to refuse units which are widely used in the
</em><br />
<em class="quotelev1">&gt; community?  I think it is worth taking some time to consider
</em><br />
<em class="quotelev1">&gt; this, and I suggest that we allow this anomalous unit for CMIP6.
</em><br />
<br />A fair question.  Please clarify.  Are you proposing to change the prohibition of scaled unit strings in CF section 3.1?  Or do you just want to modify one of the conformance checkers to accommodate the CMIP6 case alone?  I am opposed to the first, but the second would be okay if it was guarded by a software switch that is not advertised for general application.
<br />
<br />I am concerned about backpedaling on a long standing CF restriction and precedent that I think is good as is.  OTOH, if there really is wide support for scaled unit strings, I will drop my objection.
<br />
<br />--Dave
<br />
<br /><br />On Fri, Nov 2, 2018 at 3:47 AM, Martin Juckes - UKRI STFC &lt;martin.juckes at stfc.ac.uk&lt;mailto:martin.juckes at stfc.ac.uk&gt;&gt; wrote:
<br />
Dear All,
<br />
<br />&quot;micron&quot; (recognised by Udunits) might be a good alternative to &quot;um&quot;.
<br />
<br />There is a typo in the last line of my message below -- question if whether to replace &quot;1e6 km2&quot; (not m2) with &quot;Mm2&quot;,
<br />
<br />regards,
<br />
<br />Martin
<br />
<br /><br />From: Juckes, Martin (STFC,RAL,RALSP)
<br />
Sent: 02 November 2018 08:55
<br />
<br />Dear Karl, Dave,
<br />
<br />thanks, those are good suggestions.
<br />
<br />As Karl says, 1e3 km3 is not hm3 and can't be represented with prefixes (Udunits does accept
<br />
<br />As a compromise, I suggest the following changes for the CMIP6 data request:
<br />
1e-3 kg --&gt; g
<br />
1e6 J --&gt; MJ
<br />
<br />and retain 1e-6 m, 1e3 km3, 1e6 km2 with a comment. For the standard names we can just drop the scale factor as Karl suggests.
<br />
<br />The reason these are in there is because people were not aware of the restriction. As I noted below, the restriction is also omitted from the conformance document and from the compliance checker. Units of this form are used when the community requests them, usually because that is the common practice within their community -- they probably exist in many NetCDF files outside CMIP.
<br />
<br />I believe that the statement in the convention to the effect that scale_factor and add_offset attributes can be used instead is misleading. These factors can be used, but they only affect the internal storage of the data, they to not modify what the user sees -- I think the truth is that packing is the only application of these attributes. The units attribute needs to be consistent with what the user sees, and will not be affected by us of a scale factor. If the motivation for a particular choice of units is to avoid issues with numerical precision by adding an offset, this underlying problem can be dealt with using the offset attribute, but if the choice of units has different motivation these attributes don't help.
<br />
<br />This leaves us with a problem that people want to store data in units of &quot;1e3 km3&quot; and we cannot express this in CF (except by &quot;Mm km2&quot;, which looks obscure to me). Is it reasonable to refuse units which are widely used in the community? I think it is worth taking some time to consider this, and I suggest that we allow this anomalous unit for CMIP6.
<br />
<br />1e-6 m and 1e6 m2 we could use &quot;um&quot; and &quot;Mm2&quot;, but I think the results would be unsatisfactory for the users. Although the unit micro-meter is in reasonably common use, the ascii representation &quot;um&quot; is a little obscure, and &quot;Mm&quot; also looks obscure to me. I'm happy to take other views on these.
<br />
<br />regards,
<br />
<br />Martin
<br />
<br /><br />From: CF-metadata &lt;cf-metadata-bounces at cgd.ucar.edu&lt;mailto:cf-metadata-bounces at cgd.ucar.edu&gt;&gt; on behalf of Dave Allured - NOAA Affiliate &lt;dave.allured at noaa.gov&lt;mailto:dave.allured at noaa.gov&gt;&gt;
<br />
Sent: 01 November 2018 20:43
<br />
<br />It sounds like consistency is more important than CF perfection in a particular use case.  In that case, I suggest continuing use of CMIP6 prescribed unit strings for CMIP6 purposes only, and let the CMIP6 community know of this inconsistency with CF 3.1.  This will probably be the least confusing for all concerned.  People and software that understand UDUNITS will understand those scaled unit strings without help from CF.
<br />
<br />--Dave
<br />
<br /><br />On Thu, Nov 1, 2018 at 1:39 PM, Taylor, Karl E. &lt;taylor13 at llnl.gov&lt;mailto:taylor13 at llnl.gov&gt;&lt;mailto:taylor13 at llnl.gov&lt;mailto:taylor13 at llnl.gov&gt;&gt;&gt; wrote:
<br />
Hi again,
<br />
<br />I think some groups may have already written CMIP6 fields with  the currently specified units that violate the CF standard, but I'd rather have all CMIP6 datasets have comparable numeric values, so we shouldn't change the units themselves, just the units attribute, as suggested originally.  This is possible, as Martin already indicated with one exception:
<br />
<br />1e3 km3 --&gt; hm3
<br />
<br />I think this may be incorrect.  Wouldn't 1e3 km3 be interpreted as 1e3 (km)^3  If so, then
<br />
1e3 km3 = (10 km)^3
<br />
<br />and there is no prefix equivalent to &quot;10 km&quot;, so I think we're in a fix for this one variable.
<br />
<br />Karl
<br />
<br /><br /><br />On 11/1/18 11:03 AM, Dave Allured - NOAA Affiliate wrote:
<br />
Martin, thanks for a well stated summation of this problem.
<br />
<br />My opinion is there are good reasons for prohibiting numeric scale and offset in the units string, as indicated in section 3.1.  (Decimal prefixes are fine, as always.)  Therefore I agree with Karl's #1 and #3, keep the prohibition and do not change 3.1.
<br />
<br />The CMIP6 data request itself is a problem because it actually violates CF 3.1.  Best remedy would be to get CMIP6 authority to agree to alternate units that do not use numeric scale factors.  I would modify Karl's #2 like this:
<br />
<br />2)  Replace the scaled units in the CMIP6 data request with unscaled units and equivalent decimal prefix (e.g., replace  &quot;1e6 J&quot; with &quot;MJ&quot;).  However, if the result is deemed not user friendly in some way, then decide on some user friendly unscaled units, e.g. &quot;J&quot;, and consumers will need to re-scale data later, for some purposes.
<br />
<br />Does anyone know why CMIP6 requested units in violation of CF 3.1?
<br />
<br />--Dave
<br />
<br /><br />On Thu, Nov 1, 2018 at 10:58 AM, Taylor, Karl E. &lt;taylor13 at llnl.gov&lt;mailto:taylor13 at llnl.gov&gt;&lt;mailto:taylor13 at llnl.gov&lt;mailto:taylor13 at llnl.gov&gt;&gt;&gt; wrote:
<br />
Hi Martin,
<br />
<br />I think the main point of the relevant paragraph in section 3.1, which reads
<br />
<br />&quot;The Udunits syntax that allows scale factors and offsets to be applied to a unit is not supported by this standard. The application of any scale factors or offsets to data should be indicated by the scale_factor and add_offset attributes. Use of these attributes for data packing, which is their most important application, is discussed in detail in Section 8.1, &quot;Packed Data&quot;&lt;<a href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#packed-data">http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#packed-data</a>&gt;.&quot;
<br />
<br />is that if you want to pack the data, the proper way to do that is through scale_factor and add_offset, not through the scale and offset options allowed by udunits in the units attribute. In general I find the &quot;scale_factor&quot; and &quot;add_offset&quot; attributes much easier to interpret than the scale and offset udunits options.    I would therefore:
<br />
<br />1) continue to forbid (or strongly discourage?) use of offset and scale in the units attribute (and modify the conformance document to be consistent with this).
<br />
<br />2)  replace the scaled units in the CMIP6 data request with units that might be less user friendly, but include equivalent prefix (e.g., replace  &quot;1e6 J&quot; with &quot;MJ&quot;)
<br />
<br />3)  replace in the standard names table all non-conforming units with conforming units.  I don't think the new units need to be identical to the old (e.g., I would replace &quot;1e-3 kg m-2&quot; with &quot;kg m-2&quot;, not &quot;g m-2&quot;).
<br />
<br />Regarding this last point, note that the so-called &quot;Canonical units&quot; in the standard names table are there to provide guidance on what the quantity represents (e.g., W m-2 indicates the quantity is a flux density, not a flux).  CF does not recommend a particular unit among all equivalent (e.g., &quot;kg&quot; might appear in the canonical units, but &quot;g&quot; would be just as acceptable).
<br />
<br />Do others have opinions about this?
<br />
<br />best regards,
<br />
Karl
<br />
<br /><br />On 10/29/18 7:45 AM, Martin Juckes - UKRI STFC wrote:
<br />
<br />Hello Karl, Alison,
<br />
<br />As part of a separate discussion on 'months since' and 'years since' in time units&lt;<a href="http://mailman.cgd.ucar.edu/pipermail/cf-metadata/2018/020648.html">http://mailman.cgd.ucar.edu/pipermail/cf-metadata/2018/020648.html</a>&gt;&lt;<a href="http://mailman.cgd.ucar.edu/pipermail/cf-metadata/2018/020648.html">http://mailman.cgd.ucar.edu/pipermail/cf-metadata/2018/020648.html</a>&gt;, Klaus pointed out the use of numerical scale factors in units strings, although allowed by Udunits, is prohibited by the CF convention in section 3.1. I'm raising this here because there are 3 standard names which make use of such scale factors in their canonical units, and a number of CMIP6 variables. The CF conformance document diverges from the standard and allows any string which is accepted by Udunits, and hence accepts such factors. The CF checker implements the version according to the conformance document, as does the cf-python code (and hence checks on the CMIP6 variables using cf-python didn't detect this problem).
<br />
<br /><br />The CF standard names are:
<br />
<br />integral_wrt_depth_of_product_of_sea_water_density_and_salinity  : 1e-3 kg m-2
<br />
<br />ocean_salt_x_transport, ocean_salt_y_transport: 1e-3 kg s-1
<br />
<br /><br />In the CMIP6 data request, we have:
<br />
<br />1.e6 J m-1 s-1 for atmospheric energy transport (intuadse, intvadse);
<br />
<br />1e-3 kg m-2 for integral wrt depth of density and salinity (somint);
<br />
<br />1e-6 m s-1 for saturated hydraulic conductivity;
<br />
<br />1e3 km3 for sea ice volumes (sivoln, sivols);
<br />
<br />1e6 km2 for sea ice areas (siarean, siareas, siextentn, siextents);
<br />
<br /><br />Should we stick to the statement in the standards document ... and bring the conformance document etc into line, or could the standards document be interpreted more loosely?
<br />
<br /><br />These scale factors could be replaced by prefixes, but I think there is some loss of legibility in some cases:
<br />
<br />1e-3 kg --&gt; g
<br />
<br />1e6 J --&gt; MJ
<br />
<br />1e-6 m --&gt; um
<br />
<br />1e3 km3 --&gt; hm3
<br />
<br />1e6 km2 --&gt; Mm2
<br />
<br /><br />(here &quot;um&quot; is a micrometer, &quot;hm&quot; a hectometer and &quot;Mm&quot; a megameter).
<br />
<br /><br />regards,
<br />
<br />Martin
<br />
<span id="received"><dfn>Received on</dfn> Fri Nov 02 2018 - 15:54:21 GMT</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start9464">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="./9465.html" title="Next message in the list">Jonathan Gregory: "[CF-metadata] Decibel units in CF standard names"</a></li>
<li><dfn>Previous message</dfn>: <a href="./9463.html" title="Previous message in the list">Dave Allured - NOAA Affiliate: "[CF-metadata] Using units with a scale factor"</a></li>
<li><dfn>In reply to</dfn>: <a href="./9463.html" title="Message to which this message replies">Dave Allured - NOAA Affiliate: "[CF-metadata] Using units with a scale factor"</a></li>
<!-- lnextthread="start" -->
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options3" id="options3"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="index.html#msg9464" title="Contemporary messages by date">by date</a> ] [ <a href="thread.html#msg9464" title="Contemporary discussion threads">by thread</a> ] [ <a href="subject.html#msg9464" title="Contemporary messages by subject">by subject</a> ] [ <a href="author.html#msg9464" title="Contemporary messages by author">by author</a> ] [ <a href="attachment.html" title="Contemporary messages by attachment">by messages with attachments</a> ]</li>
</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail-project.org/">hypermail 2.3.0</a>
: Wed Jul 27 2022 - 12:59:31 BST
</em></small></p>
</body>
<p><a style="text-decoration:none" href="./9463.html"><img src="./red-arrow-left.jpg" width="50" alt="&lArr;"></a> <a style="text-decoration:none" href="./9465.html"><img src="./red-arrow-right.jpg" width="50" alt="&rArr;"></a></html>
